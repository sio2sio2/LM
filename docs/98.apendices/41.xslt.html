




<!DOCTYPE html>

<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>XSLT &#8212; documentación de Lenguajes de Marcas - rolling</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/cloud.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.5ea377869091fd0449014c60fc090103.min.css" />
    <link rel="stylesheet" href="../_static/general.css" type="text/css" />
    <link rel="stylesheet" href="../_static/particular.css" type="text/css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noticia+Text:400,i,b,bi|Open+Sans:400,i,b,bi|Roboto+Mono:400,i,b,bi&amp;display=swap" type="text/css" />
    
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/translations.js"></script>
    <script src="../_static/design-tabs.js"></script>

    
    
     
        <script src="../_static/jquery.cookie.js"></script>
    

    
     
        <script src="../_static/cloud.base.js"></script>
    

    
     
        <script src="../_static/cloud.js"></script>
    

    <link rel="index" title="Índice" href="../genindex.html" />
    <link rel="search" title="Búsqueda" href="../search.html" />
    <link rel="next" title="Herramientas" href="99.tools.html" />
    <link rel="prev" title="Relax-NG Compact" href="22.rnc.html" /> 
        <meta name="viewport" content="width=device-width, initial-scale=1">
  </head><body>
    <div class="relbar-top">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="Índice General"
             accesskey="I">índice</a></li>
        <li class="right" >
          <a href="99.tools.html" title="Herramientas"
             accesskey="N">siguiente</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="22.rnc.html" title="Relax-NG Compact"
             accesskey="P">anterior</a> &nbsp; &nbsp;</li>
    <li><a href="../index.html">documentación de Lenguajes de Marcas - rolling</a> &#187;</li>

        <li class="nav-item nav-item-this"><a href=""><abbr title="eXtensible Stylesheet Language Transformations">XSLT</abbr></a></li> 
      </ul>
    </div>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="xslt">
<span id="id1"></span><h1><abbr title="eXtensible Stylesheet Language Transformations">XSLT</abbr><a class="headerlink" href="#xslt" title="Enlace permanente a este encabezado">¶</a></h1>
<section id="introduccion">
<h2>Introducción<a class="headerlink" href="#introduccion" title="Enlace permanente a este encabezado">¶</a></h2>
<section id="que-es-xslt">
<h3>¿Qué es <abbr title="eXtensible Stylesheet Language Transformations">XSLT</abbr>?<a class="headerlink" href="#que-es-xslt" title="Enlace permanente a este encabezado">¶</a></h3>
<p><abbr title="eXtensible Stylesheet Language Transformations">XSLT</abbr> (en castellano, algo así como lenguaje para transformaciones basadas en
hojas de estilos extensibles) es un lenguaje de programación basado en <abbr title="eXtensible  Markup Language">XML</abbr>
que permite traducir entre distintos dialectos <abbr title="eXtensible  Markup Language">XML</abbr> o entre un dialecto <abbr title="eXtensible  Markup Language">XML</abbr>
y texto plano. Por lo general, la transformación se lleva a cabo hacia un
formato que tenga definida una visualización (p.e. <abbr title="HyperText Markup Language">HTML</abbr>). También puede
generarse un documento <abbr title="Portable Document Format">PDF</abbr>, pero en este caso la conversión que obra <abbr title="eXtensible Stylesheet Language Transformations">XSLT</abbr>
se lleva a cabo hacia <abbr title="XSL Formatting Object">XSL-FO</abbr> y es desde este dialecto donde se hace una
última transformación hacia <abbr title="Portable Document Format">PDF</abbr>.</p>
<p><abbr title="eXtensible Stylesheet Language Transformations">XSLT</abbr> es un dialecto <abbr title="eXtensible  Markup Language">XML</abbr>, pero también un lenguaje de programación, puesto
que se escribe para definir las reglas de transformación que deben aplicarse
para realizar la conversión entre dos dialectos <abbr title="eXtensible  Markup Language">XML</abbr> distintos. Así pues, una
vez escrito, se toma este mismo documento <abbr title="eXtensible Stylesheet Language Transformations">XSLT</abbr>, el documento <abbr title="eXtensible  Markup Language">XML</abbr> a
transformar y un procesador <abbr title="eXtensible Stylesheet Language Transformations">XSLT</abbr>, que se encarga de hacer la transformación
del <abbr title="eXtensible  Markup Language">XML</abbr> según las reglas del <abbr title="eXtensible Stylesheet Language Transformations">XSLT</abbr> para obtener la salida:</p>
<img alt="../_images/xslt-proceso.png" src="../_images/xslt-proceso.png" />
<p>Establecido que <abbr title="eXtensible Stylesheet Language Transformations">XSLT</abbr> es un lenguaje de programación, queda reseñar cuáles son
sus características:</p>
<ul class="simple">
<li><p>Tiene una sintaxis <abbr title="eXtensible  Markup Language">XML</abbr>, de manera que sus instrucciones (estructuras de
flujo, funciones, etc.) son elementos <abbr title="eXtensible  Markup Language">XML</abbr>.</p></li>
<li><p>Sigue, más o menos, el paradigma de la programación declarativa funcional, de
modo que no hay variables y los bucles están muy restringidos. Sin embargo,
carece de la propiedad fundamental de que las <a class="reference external" href="https://developer.mozilla.org/es/docs/Glossary/Funcion_de_primera_clase">funciones sean ciudadanos de
primera clase</a>.</p></li>
<li><p>Es un lenguaje basado en la coincidencia de patrones de texto, como <a class="reference external" href="https://es.wikipedia.org/wiki/AWK">awk</a> por ejemplo.  Dicho más extensamente, a
diferencia de un lenguaje de programación imperativa, el flujo natural del
programa no es un listado de instrucciones que se ejecuta de modo secuencial,
sino que el programa se compone de bloques de código (elementos) que declaran
cómo se debe transformar cada elemento del <abbr title="eXtensible  Markup Language">XML</abbr> original. El procesador se
encarga de comprobar qué bloque es aplicable a cada nodo <abbr title="eXtensible  Markup Language">XML</abbr> del documento
original.</p></li>
</ul>
<p class="rubric">Versiones</p>
<p>De <abbr title="eXtensible Stylesheet Language Transformations">XSLT</abbr> existen tres versiones:</p>
<ul class="simple">
<li><p>La <strong>1.0</strong> publicada en 1999, que usa <em>XPath</em> 1.0 y es la más extendida y aún
hoy se sigue utilizando. Para esta versión se definieron extensiones <a class="reference internal" href="#e-xslt"><span class="std std-ref">EXSLT</span></a>
que complementan el estándar y permiten hacer más transformaciones. En estos
apuntes se tratará esta versión por cuanto es la que única que, dentro del
<em>software</em> libre, soporta la librería <a class="reference external" href="http://xmlsoft.org/libxslt/">libxslt</a> en <strong>C</strong>. que es la base que
utilicen muchísimos programas y lenguajes de programación, entre ellos
<strong class="program">xmlstarlet</strong>.</p></li>
<li><p>La <strong>2.0</strong> que usa <em>XPath</em> 2.0 y fue publicada en 2007.</p></li>
<li><p>La <strong>3.0</strong>, que usa <em>XPath</em> 3.0 o 3.1 y fue publicada en junio de 2017. <a class="reference external" href="http://saxon.sourceforge.net/">Saxon</a>, procesor desarrollado en <a class="reference external" href="https://www.java.com">Java</a>, implementa esta versión. El problema es que al no
estar desarrollado en <strong>C</strong> no se presta a ser tomado como base por programas
(no escritos en <em>Java</em>) y lenguajes de programación.</p></li>
</ul>
<div class="admonition caution">
<p class="admonition-title">Prudencia</p>
<p>El apéndice desarrolla la versión <strong>1.0</strong> del estándar <abbr title="eXtensible Stylesheet Language Transformations">XSLT</abbr>, a
pesar de que el resto de los apuntes introducen con cierta profundidad
<em>XPath</em> 3.1. El autor no ha estudiado la versión <strong>3.0</strong>, aunque por lo que
puede leer en <a class="reference external" href="https://gandhimukul.tripod.com/xslt/10_20.html">esta comparación entre XSLT 1.0 y XSLT 2.0</a>, no hay diferencias
significativas de concepto, sino que:</p>
<ul class="simple">
<li><p>Los principales cambios en el comportamiento se deben a la interpretación
de las expresiones <em>XPath</em>, que ya hemos discutido en el <a class="reference internal" href="../03.consulta/01.xpath.html#xpath"><span class="std std-ref">epígrafe
dedicado a XPath</span></a>. Por tanto, sabiendo cómo interpreta <em>XPath</em>,
adivinaremos cómo se comporta <abbr title="eXtensible Stylesheet Language Transformations">XSLT</abbr>.</p></li>
<li><p>Las nuevas funciones añadidas a <em>XPath</em> cubren las necesidades por la que
nacieron las <a class="reference internal" href="#xslt-extensiones"><span class="std std-ref">extensiones EXSLT</span></a> para la versión
<em>1.0</em>. Así pues, no son necesarias por más tiempo.</p></li>
<li><p>Presenta algunos añadidos propios de <abbr title="eXtensible Stylesheet Language Transformations">XSLT</abbr>.</p></li>
</ul>
<p>En definitiva, dar el salto de la versión <em>1.0</em> a la versión <em>3.0</em> no entraña
dificultad alguna si ya se conoce <em>XPath</em> 3.1.</p>
</div>
</section>
<section id="ejemplo-introductorio">
<span id="xslt-ejemplo"></span><h3>Ejemplo introductorio<a class="headerlink" href="#ejemplo-introductorio" title="Enlace permanente a este encabezado">¶</a></h3>
<p>Antes de entrar en harina es más didáctico plantear un ejemplo y ver cuál es el
aspecto del código <abbr title="eXtensible Stylesheet Language Transformations">XSLT</abbr>. Supongamos el siguiente documento <abbr title="eXtensible  Markup Language">XML</abbr>:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;</span>
<span class="cp">&lt;!DOCTYPE discoteca [</span>
<span class="cp">   &lt;!ELEMENT discoteca (disco+)&gt;</span>
<span class="w">   </span><span class="cp">&lt;!ELEMENT disco (nombre, autor)&gt;</span>
<span class="w">   </span><span class="cp">&lt;!ATTLIST disco id     ID   #REQUIRED</span>
<span class="cp">                   tipo   (clasica|rock|pop|jazz|folk)  #REQUIRED&gt;</span>
<span class="w">   </span><span class="cp">&lt;!ELEMENT nombre (#PCDATA)&gt;</span>
<span class="w">   </span><span class="cp">&lt;!ELEMENT autor  (#PCDATA)&gt;</span>
]&gt;
<span class="cp">&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;discos.txt.xsl&quot;?&gt;</span>
<span class="cm">&lt;!--</span>
<span class="cm">- Almacena información sobre discos personales.</span>
<span class="cm">- &quot;discos.txt.xsl&quot; genera una lista en texto plano.</span>
<span class="cm">--&gt;</span>
<span class="nt">&lt;discoteca&gt;</span>
<span class="w">   </span><span class="nt">&lt;disco</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;d1&quot;</span><span class="w"> </span><span class="na">tipo=</span><span class="s">&quot;clasica&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;nombre&gt;</span>Nueve<span class="w"> </span>sinfonías<span class="nt">&lt;/nombre&gt;</span>
<span class="w">      </span><span class="nt">&lt;autor&gt;</span>Ludwing<span class="w"> </span>van<span class="w"> </span>Beethoven<span class="nt">&lt;/autor&gt;</span>
<span class="w">   </span><span class="nt">&lt;/disco&gt;</span>
<span class="w">   </span><span class="nt">&lt;disco</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;d2&quot;</span><span class="w"> </span><span class="na">tipo=</span><span class="s">&quot;jazz&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;nombre&gt;</span>Kind<span class="w"> </span>of<span class="w"> </span>Blue<span class="nt">&lt;/nombre&gt;</span>
<span class="w">      </span><span class="nt">&lt;autor&gt;</span>Miles<span class="w"> </span>Davis<span class="nt">&lt;/autor&gt;</span>
<span class="w">   </span><span class="nt">&lt;/disco&gt;</span>
<span class="w">   </span><span class="nt">&lt;disco</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;d3&quot;</span><span class="w"> </span><span class="na">tipo=</span><span class="s">&quot;rock&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;nombre&gt;</span>Metalmorfosis<span class="nt">&lt;/nombre&gt;</span>
<span class="w">      </span><span class="nt">&lt;autor&gt;</span>Barón<span class="w"> </span>Rojo<span class="nt">&lt;/autor&gt;</span>
<span class="w">   </span><span class="nt">&lt;/disco&gt;</span>
<span class="w">   </span><span class="nt">&lt;disco</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;d4&quot;</span><span class="w"> </span><span class="na">tipo=</span><span class="s">&quot;rock&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;nombre&gt;</span>Más<span class="w"> </span>madera<span class="nt">&lt;/nombre&gt;</span>
<span class="w">      </span><span class="nt">&lt;autor&gt;</span>Leño<span class="nt">&lt;/autor&gt;</span>
<span class="w">   </span><span class="nt">&lt;/disco&gt;</span>
<span class="w">   </span><span class="nt">&lt;disco</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;d5&quot;</span><span class="w"> </span><span class="na">tipo=</span><span class="s">&quot;jazz&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;nombre&gt;</span>Ella<span class="w"> </span>and<span class="w"> </span>Louis<span class="nt">&lt;/nombre&gt;</span>
<span class="w">      </span><span class="nt">&lt;autor&gt;</span>Ella<span class="w"> </span>Fitzgerald/Louis<span class="w"> </span>Armstrong<span class="nt">&lt;/autor&gt;</span>
<span class="w">   </span><span class="nt">&lt;/disco&gt;</span>
<span class="w">   </span><span class="nt">&lt;disco</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;d6&quot;</span><span class="w"> </span><span class="na">tipo=</span><span class="s">&quot;clasica&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;nombre&gt;</span>El<span class="w"> </span>Mesías<span class="nt">&lt;/nombre&gt;</span>
<span class="w">      </span><span class="nt">&lt;autor&gt;</span>G.F.<span class="w"> </span>Haendel<span class="nt">&lt;/autor&gt;</span>
<span class="w">   </span><span class="nt">&lt;/disco&gt;</span>
<span class="nt">&lt;/discoteca&gt;</span>
</pre></div>
</div>
<p>El documento tiene incrustado el <abbr title="Document Type Definition">DTD</abbr> que lo valida:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>xmlstarlet<span class="w"> </span>val<span class="w"> </span>-E<span class="w"> </span>discos.xml
<span class="go">discos.xml - valid</span>
</pre></div>
</div>
<p>Queremos crear una transformación, de suerte que obtengamos una listado de
discos en texto plano con el siguiente aspecto:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>xslstarlet<span class="w"> </span>tr<span class="w"> </span>discos.txt.xsl<span class="w"> </span>discos.xml
<span class="go">LISTA DE DISCOS</span>

<span class="go">+ clasica</span>
<span class="go">   - Nueve sinfonías (Ludwing van Beethoven)</span>
<span class="go">   - El Mesías (G.F. Haendel)</span>

<span class="go">+ jazz</span>
<span class="go">   - Kind of Blue (Miles Davis)</span>
<span class="go">   - Ella and Louis (Ella Fitzgerald/Louis Armstrong)</span>

<span class="go">+ rock</span>
<span class="go">   - Metalmorfosis (Barón Rojo)</span>
<span class="go">   - Más madera (Leño)</span>
</pre></div>
</div>
<p>Pues bien, una posible solución para lograr tal transformación es la siguiente:</p>
<div class="highlight-xslt notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="linenos"> 2</span><span class="k">&lt;xsl:stylesheet</span><span class="w"> </span><span class="na">version=</span><span class="s">&quot;1.0&quot;</span>
<span class="linenos"> 3</span><span class="w">                </span><span class="na">xmlns:xsl=</span><span class="s">&quot;http://www.w3.org/1999/XSL/Transform&quot;</span><span class="nt">&gt;</span>
<span class="linenos"> 4</span><span class="w"> </span>
<span class="linenos"> 5</span><span class="w">   </span><span class="k">&lt;xsl:output</span><span class="w"> </span><span class="na">method=</span><span class="s">&quot;text&quot;</span><span class="w"> </span><span class="na">encoding=</span><span class="s">&quot;UTF-8&quot;</span><span class="nt">/&gt;</span>
<span class="linenos"> 6</span><span class="w"> </span>
<span class="linenos"> 7</span><span class="w">   </span><span class="k">&lt;xsl:template</span><span class="w"> </span><span class="na">match=</span><span class="s">&quot;discoteca&quot;</span><span class="nt">&gt;</span>
<span class="linenos"> 8</span><span class="w">      </span><span class="k">&lt;xsl:text</span><span class="nt">&gt;</span>LISTA<span class="w"> </span>DE<span class="w"> </span>DISCOS<span class="ni">&amp;#10;</span><span class="k">&lt;/xsl:text&gt;</span>
<span class="linenos"> 9</span><span class="w">      </span><span class="k">&lt;xsl:apply-templates</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;disco&quot;</span><span class="nt">&gt;</span>
<span class="linenos">10</span><span class="w">         </span><span class="k">&lt;xsl:sort</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;@tipo&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="linenos">11</span><span class="w">      </span><span class="k">&lt;/xsl:apply-templates&gt;</span>
<span class="linenos">12</span><span class="w">   </span><span class="k">&lt;/xsl:template&gt;</span>
<span class="linenos">13</span><span class="w"> </span>
<span class="linenos">14</span><span class="w">   </span><span class="k">&lt;xsl:template</span><span class="w"> </span><span class="na">match=</span><span class="s">&quot;disco&quot;</span><span class="nt">&gt;</span>
<span class="linenos">15</span><span class="w"> </span>
<span class="linenos">16</span><span class="w">      </span><span class="k">&lt;xsl:if</span><span class="w"> </span><span class="na">test=</span><span class="s">&quot;not(preceding-sibling::disco[@tipo = current()/@tipo])&quot;</span><span class="nt">&gt;</span>
<span class="linenos">17</span><span class="w">         </span><span class="cm">&lt;!-- Alternativo &quot;/discoteca/disco[@tipo=current()/@tipo][1] = .&quot; --&gt;</span>
<span class="linenos">18</span><span class="w">         </span><span class="k">&lt;xsl:call-template</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;tipo&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="linenos">19</span><span class="w">      </span><span class="k">&lt;/xsl:if&gt;</span>
<span class="linenos">20</span><span class="w"> </span>
<span class="linenos">21</span><span class="w">      </span><span class="k">&lt;xsl:call-template</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;disco&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="linenos">22</span><span class="w">   </span><span class="k">&lt;/xsl:template&gt;</span>
<span class="linenos">23</span><span class="w"> </span>
<span class="linenos">24</span><span class="w">   </span><span class="k">&lt;xsl:template</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;tipo&quot;</span><span class="nt">&gt;</span>
<span class="linenos">25</span><span class="w">      </span><span class="k">&lt;xsl:text</span><span class="nt">&gt;</span><span class="ni">&amp;#10;</span><span class="k">&lt;/xsl:text&gt;</span>
<span class="linenos">26</span><span class="w">      </span><span class="k">&lt;xsl:text</span><span class="nt">&gt;</span>+<span class="w"> </span><span class="k">&lt;/xsl:text&gt;</span>
<span class="linenos">27</span><span class="w">      </span><span class="k">&lt;xsl:value-of</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;@tipo&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="linenos">28</span><span class="w">      </span><span class="k">&lt;xsl:text</span><span class="nt">&gt;</span><span class="ni">&amp;#10;</span><span class="k">&lt;/xsl:text&gt;</span>
<span class="linenos">29</span><span class="w">   </span><span class="k">&lt;/xsl:template&gt;</span>
<span class="linenos">30</span><span class="w"> </span>
<span class="linenos">31</span><span class="w">   </span><span class="k">&lt;xsl:template</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;disco&quot;</span><span class="nt">&gt;</span>
<span class="linenos">32</span><span class="w">      </span><span class="k">&lt;xsl:text</span><span class="nt">&gt;</span><span class="w">   </span>-<span class="w"> </span><span class="k">&lt;/xsl:text&gt;</span>
<span class="linenos">33</span><span class="w">      </span><span class="k">&lt;xsl:value-of</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;nombre&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="linenos">34</span><span class="w">      </span><span class="k">&lt;xsl:text</span><span class="nt">&gt;</span><span class="w"> </span>(<span class="k">&lt;/xsl:text&gt;</span>
<span class="linenos">35</span><span class="w">      </span><span class="k">&lt;xsl:value-of</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;autor&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="linenos">36</span><span class="w">      </span><span class="k">&lt;xsl:text</span><span class="nt">&gt;</span>)<span class="ni">&amp;#10;</span><span class="k">&lt;/xsl:text&gt;</span>
<span class="linenos">37</span><span class="w">   </span><span class="k">&lt;/xsl:template&gt;</span>
<span class="linenos">38</span>
<span class="linenos">39</span><span class="k">&lt;/xsl:stylesheet&gt;</span>
</pre></div>
</div>
<p>Es aún prematura entender con perfección el código, pero es muy pertinente
analizarlo superficialmente para entender cómo funciona el procesador, esto es,
cómo lee las reglas para generar la transformación:</p>
<ol class="arabic">
<li><p>Se define una plantilla para el nodo <code class="code docutils literal notranslate"><span class="pre">&lt;discoteca&gt;</span></code>, o sea, el nodo
<em>raíz</em> <a class="footnote-reference brackets" href="#id11" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>.</p></li>
<li><p>Hay definida otra plantilla para los nodos «disco»</p></li>
<li><p>El procesador empieza su labor viendo si existe una plantilla para «/».
Existe y, por ella, se desencadena la transformación. Tal plantilla genera el
título «LISTA DE DISCOS» y aplica la plantilla a los sucesivos nodos disco,
pero ordenados por el atributo «&#64;tipo».</p></li>
<li><p>La plantilla para «disco» se encarga de generar los ítem:</p>
<div class="highlight-xslt notranslate"><div class="highlight"><pre><span></span>-<span class="w"> </span>Título<span class="w"> </span>(Artista)
</pre></div>
</div>
<p>pero cuando el disco es el primero de su tipo (o, leyendo literalmente,
cuando no hay otro nodo hermano anterior que sea del mismo tipo que el tipo
del nodo que estamos tratanto), además, se genera la etiqueta:</p>
<div class="highlight-xslt notranslate"><div class="highlight"><pre><span></span>+<span class="w"> </span>tipo_de_musica
</pre></div>
</div>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Aunque sea muy prematuro entenderlo, esta solución tiene un grave
defecto: vuelve muy complicado hacer numerada la lista de tipos de música, en
vez de despacharla con un «+». <a class="reference internal" href="#xsl-ejemplo-intro-v2"><span class="std std-ref">Más adelante</span></a> se
ensaya otra solución que sí lo permite sin ser más complicada.</p>
</div>
<p>Supongamos, en cambio, que nuestra intención es generar una tabla <abbr title="HyperText Markup Language">HTML</abbr> (en
realidad <abbr title="eXtensible HyperText Markup Language">XHTML</abbr> que es su equivalente <abbr title="eXtensible  Markup Language">XML</abbr>) como la siguiente:</p>
<img alt="../_images/output-html.png" src="../_images/output-html.png" />
<p>La estrategia para la resolución es la: la plantilla del nodo «/» creará el
envoltorio, esto es, los elementos <code class="docutils literal notranslate"><span class="pre">&lt;html&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;head&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;body&gt;</span></code> y
<code class="docutils literal notranslate"><span class="pre">&lt;table&gt;</span></code>; y la plantilla de cada elemento disco deberá crear cada fila
<code class="docutils literal notranslate"><span class="pre">&lt;tr&gt;</span></code>. Además, al igual que en el caso anterior, cuando el disco sea el
primero de tu tipo deberá generar la celda que indica el tipo de música con una
altura igual al número de discos que haya de ese tipo:</p>
<div class="highlight-xslt notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="linenos"> 2</span><span class="k">&lt;xsl:stylesheet</span><span class="w"> </span><span class="na">version=</span><span class="s">&quot;1.0&quot;</span>
<span class="linenos"> 3</span><span class="w">                </span><span class="na">xmlns:xsl=</span><span class="s">&quot;http://www.w3.org/1999/XSL/Transform&quot;</span><span class="nt">&gt;</span>
<span class="linenos"> 4</span><span class="w"> </span>
<span class="linenos"> 5</span><span class="w">   </span><span class="k">&lt;xsl:output</span><span class="w"> </span><span class="na">method=</span><span class="s">&quot;xml&quot;</span><span class="w"> </span><span class="na">version=</span><span class="s">&quot;1.0&quot;</span><span class="w"> </span><span class="na">encoding=</span><span class="s">&quot;UTF-8&quot;</span>
<span class="linenos"> 6</span><span class="w">               </span><span class="na">doctype-public=</span><span class="s">&quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot;</span>
<span class="linenos"> 7</span><span class="w">               </span><span class="na">doctype-system=</span><span class="s">&quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;</span>
<span class="linenos"> 8</span><span class="w">               </span><span class="na">indent=</span><span class="s">&quot;yes&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="linenos"> 9</span><span class="w"> </span>
<span class="linenos">10</span><span class="w">   </span><span class="k">&lt;xsl:template</span><span class="w"> </span><span class="na">match=</span><span class="s">&quot;discoteca&quot;</span><span class="nt">&gt;</span>
<span class="linenos">11</span><span class="w">      </span><span class="nt">&lt;html&gt;</span>
<span class="linenos">12</span><span class="w">         </span><span class="nt">&lt;head&gt;</span>
<span class="linenos">13</span><span class="w">            </span><span class="nt">&lt;title&gt;</span>Discos<span class="w"> </span>de<span class="w"> </span>mi<span class="w"> </span>fonoteca<span class="nt">&lt;/title&gt;</span>
<span class="linenos">14</span><span class="w">         </span><span class="nt">&lt;/head&gt;</span>
<span class="linenos">15</span><span class="w">         </span><span class="nt">&lt;body&gt;</span>
<span class="linenos">16</span><span class="w">            </span><span class="nt">&lt;table&gt;</span>
<span class="linenos">17</span><span class="w">               </span><span class="nt">&lt;caption&gt;</span>Discos<span class="nt">&lt;/caption&gt;</span>
<span class="linenos">18</span><span class="w">               </span><span class="nt">&lt;tr&gt;&lt;th&gt;</span>Tipo<span class="nt">&lt;/th&gt;&lt;th&gt;</span>Nombre<span class="nt">&lt;/th&gt;&lt;th&gt;</span>Autor<span class="nt">&lt;/th&gt;&lt;/tr&gt;</span>
<span class="linenos">19</span><span class="w">               </span><span class="k">&lt;xsl:apply-templates</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;disco&quot;</span><span class="nt">&gt;</span>
<span class="linenos">20</span><span class="w">                  </span><span class="k">&lt;xsl:sort</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;@tipo&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="linenos">21</span><span class="w">               </span><span class="k">&lt;/xsl:apply-templates&gt;</span>
<span class="linenos">22</span><span class="w">            </span><span class="nt">&lt;/table&gt;</span>
<span class="linenos">23</span><span class="w">         </span><span class="nt">&lt;/body&gt;</span>
<span class="linenos">24</span><span class="w">      </span><span class="nt">&lt;/html&gt;</span>
<span class="linenos">25</span><span class="w">   </span><span class="k">&lt;/xsl:template&gt;</span>
<span class="linenos">26</span><span class="w"> </span>
<span class="linenos">27</span><span class="w">   </span><span class="k">&lt;xsl:template</span><span class="w"> </span><span class="na">match=</span><span class="s">&quot;disco&quot;</span><span class="nt">&gt;</span>
<span class="linenos">28</span><span class="w">      </span><span class="nt">&lt;tr&gt;</span>
<span class="linenos">29</span><span class="w">         </span><span class="k">&lt;xsl:if</span><span class="w"> </span><span class="na">test=</span><span class="s">&quot;not(preceding-sibling::disco[@tipo = current()/@tipo])&quot;</span><span class="w"> </span><span class="nt">&gt;</span>
<span class="linenos">30</span><span class="w">            </span><span class="k">&lt;xsl:element</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;td&quot;</span><span class="nt">&gt;</span>
<span class="linenos">31</span><span class="w">               </span><span class="k">&lt;xsl:attribute</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;rowspan&quot;</span><span class="nt">&gt;</span>
<span class="linenos">32</span><span class="w">                  </span><span class="k">&lt;xsl:value-of</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;count(/discoteca/disco[@tipo=current()/@tipo])&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="linenos">33</span><span class="w">               </span><span class="k">&lt;/xsl:attribute&gt;</span>
<span class="linenos">34</span><span class="w">               </span><span class="k">&lt;xsl:value-of</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;@tipo&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="linenos">35</span><span class="w">            </span><span class="k">&lt;/xsl:element&gt;</span>
<span class="linenos">36</span><span class="w">         </span><span class="k">&lt;/xsl:if&gt;</span>
<span class="linenos">37</span><span class="w">         </span><span class="nt">&lt;td&gt;</span><span class="k">&lt;xsl:value-of</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;nombre&quot;</span><span class="w"> </span><span class="nt">/&gt;&lt;/td&gt;</span>
<span class="linenos">38</span><span class="w">         </span><span class="nt">&lt;td&gt;</span><span class="k">&lt;xsl:value-of</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;autor&quot;</span><span class="w"> </span><span class="nt">/&gt;&lt;/td&gt;</span>
<span class="linenos">39</span><span class="w">      </span><span class="nt">&lt;/tr&gt;</span>
<span class="linenos">40</span><span class="w">   </span><span class="k">&lt;/xsl:template&gt;</span>
<span class="linenos">41</span><span class="w"> </span>
<span class="linenos">42</span><span class="k">&lt;/xsl:stylesheet&gt;</span>
</pre></div>
</div>
<p class="rubric">Nota pedagógica</p>
<p>Se pueden introducir el ejemplo que genera la lista de texto, creando
sucesivamente los <abbr title="eXtensible Stylesheet Language Transformations">XSLT</abbr> que generan los siguientes resultados:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>xmlstarlet<span class="w"> </span>tr<span class="w"> </span>discos.txtv1.xsl<span class="w"> </span>discos.xml
<span class="go">LISTA DE DISCOS</span>

<span class="go">- clasica: Nueve sinfonías (Ludwing van Beethoven)</span>
<span class="go">- jazz: Kind of Blue (Miles Davis)</span>
<span class="go">- rock: Metalmorfosis (Barón Rojo)</span>
<span class="go">- rock: Más madera (Leño)</span>
<span class="go">- jazz: Ella and Louis (Ella Fitzgerald/Louis Armstrong)</span>
<span class="go">- clasica: El Mesías (G.F. Haendel)</span>

<span class="gp">$ </span>xmlstarlet<span class="w"> </span>tr<span class="w"> </span>discos.txtv1.xsl<span class="w"> </span>discos.xml
<span class="go">LISTA DE DISCOS</span>

<span class="go">- clasica: Nueve sinfonías (Ludwing van Beethoven)</span>
<span class="go">- clasica: El Mesías (G.F. Haendel)</span>
<span class="go">- jazz: Kind of Blue (Miles Davis)</span>
<span class="go">- jazz: Ella and Louis (Ella Fitzgerald/Louis Armstrong)</span>
<span class="go">- rock: Metalmorfosis (Barón Rojo)</span>
<span class="go">- rock: Más madera (Leño)</span>
</pre></div>
</div>
<p>Pueden descargarse <a class="reference download internal" download="" href="../_downloads/d6ad922c7857921e8852fbaa45707682/xsl-intermedios.zip"><code class="xref download docutils literal notranslate"><span class="pre">desde</span> <span class="pre">aquí</span></code></a> estas
transformaciones intermedias.</p>
<div class="admonition seealso">
<p class="admonition-title">Ver también</p>
<p>Para saber cómo realizar transformación <abbr title="eXtensible Stylesheet Language Transformations">XSLT</abbr> usando
<strong class="program">xmlstartlet</strong> consulte <a class="reference internal" href="99.tools/01-xmlstarlet.html#xmlstarlet-xslt"><span class="std std-ref">el apéndice dedicado a ello</span></a>.</p>
</div>
</section>
</section>
<section id="expresiones">
<span id="xslt-expresiones"></span><h2>Expresiones<a class="headerlink" href="#expresiones" title="Enlace permanente a este encabezado">¶</a></h2>
<p>Muchos de los elementos de <abbr title="eXtensible Stylesheet Language Transformations">XSLT</abbr> permiten incluir atributos cuyo valor puede
ser un literal o una expresión <a class="reference internal" href="../03.consulta/01.xpath.html#xpath"><span class="std std-ref">XPath</span></a>, dentro de la cual, además
de sus propias funciones, podrán usarse <a class="reference internal" href="#xslt-func"><span class="std std-ref">funciones de XSLT</span></a> y
<a class="reference internal" href="#e-xslt"><span class="std std-ref">funciones de EXSLT</span></a>. Usar estas expresiones dentro un atributo
<abbr title="eXtensible  Markup Language">XML</abbr> provoca que haya algunas particularidades a la hora de escribirlas.</p>
<p>Fijemos nuestra vista en el elemento <a class="reference internal" href="#xsl-value-of"><span class="std std-ref">&lt;xsl:value-of&gt;</span></a>, en cuyo atributo <code class="docutils literal notranslate"><span class="pre">select</span></code>
se incluyen estas expresiones. La expresión de una cadena literal debe ir
incluida entre comillas:</p>
<div class="highlight-xslt notranslate"><div class="highlight"><pre><span></span><span class="k">&lt;xsl:value-of</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;&#39;una frase cualquiera&#39;&quot;</span><span class="nt">&gt;</span>
</pre></div>
</div>
<p>Ya es sabido que se debe rodear el valor de un atributo con comillas y que es
indiferente que estas sean simples o dobles. Pues bien, las comillas que
determinan que el valor es una cadena (simples en este caso) deben ser las
que no se usan para rodear el valor (dobles en este caso). Para obtener el valor
de un elemento o un atributo, basta con usar la expresión <em>XPath</em> apropiada:</p>
<div class="highlight-xslt notranslate"><div class="highlight"><pre><span></span><span class="k">&lt;xsl:value-of</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;@tipo&quot;</span><span class="nt">&gt;</span>
</pre></div>
</div>
<p>Esto devuelve el valor del atributo tipo del elemento que se esté procesando.</p>
<p>Cuando se realizan comparaciones, es importante reseñar que no se pueden usar
los caracteres «&lt;» y «&gt;» directamente, sino que habrá que usar las entidades «&amp;lt;» y
«&amp;gt;»:</p>
<div class="highlight-xslt notranslate"><div class="highlight"><pre><span></span><span class="k">&lt;xsl:if</span><span class="w"> </span><span class="na">test=</span><span class="s">&quot;position() &amp;gt; 2&quot;</span><span class="nt">&gt;</span>
</pre></div>
</div>
<p>Recuérdese, además, que <em>XPath</em> dispone de sus propias funciones, que pueden
usarse en todas estas expresiones. pero que <a class="reference external" href="http://xmlsoft.org/libxml2/">libxml2</a> (y, por tanto,
<strong class="program">xmlstarlet</strong>) sólo soporta <em>XPath</em> <strong>1.0</strong>.</p>
<p>Además, puede usarse la <a class="reference internal" href="#xslt-notacion-parent"><span class="std std-ref">notación de llaves</span></a> con
las expresiones <em>XPath</em> cuando se desea evaluarlas dentro de los atributos de
los elementos del <abbr title="eXtensible  Markup Language">XML</abbr> de salida.</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Es preciso aquí, hacer un inciso. aunque gracias a <a class="reference internal" href="../03.consulta/01.xpath.html#xpath"><span class="std std-ref">XPath</span></a> sabemos
qie una cadena se define incluyendo el valor entre comillas, y un número con un número
a secas, definir un valor bopleano no es algo que se haya practicado hasta
ahora, pero es posible que sea necesario a partir de ahora. Se definen
mediante las funciones <code class="code docutils literal notranslate"><span class="pre">true()</span></code> y <code class="code docutils literal notranslate"><span class="pre">false()</span></code>:</p>
<div class="highlight-xslt notranslate"><div class="highlight"><pre><span></span><span class="k">&lt;xsl:variable</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;soycadena&quot;</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;&#39;abcdef&#39;&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="k">&lt;xsl:variable</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;soynumero&quot;</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;12.24&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="k">&lt;xsl:variable</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;soybooleano&quot;</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;true()&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</pre></div>
</div>
</div>
</section>
<section id="elementos">
<h2>Elementos<a class="headerlink" href="#elementos" title="Enlace permanente a este encabezado">¶</a></h2>
<p><abbr title="eXtensible Stylesheet Language Transformations">XSLT</abbr> es un lenguaje de programación con sintaxis <abbr title="eXtensible  Markup Language">XML</abbr> y, por tanto, estudiar
la sintaxis de <abbr title="eXtensible Stylesheet Language Transformations">XSLT</abbr> es repasar qué elementos admite y que atributos soporta
cada elemento.</p>
<section id="cabecera">
<h3>Cabecera<a class="headerlink" href="#cabecera" title="Enlace permanente a este encabezado">¶</a></h3>
<p>Un documentos <abbr title="eXtensible Stylesheet Language Transformations">XSLT</abbr> es un documento <abbr title="eXtensible  Markup Language">XML</abbr>. Por tanto, la primera línea debe ser
la de todo documento <abbr title="eXtensible  Markup Language">XML</abbr>:</p>
<div class="highlight-xslt notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
</pre></div>
</div>
<p id="xsl-stylesheet">O cualquier otra variante válida. Escrita esta, podemos abrir nuestro elemento
contenedor que, para el caso es <code class="docutils literal notranslate"><span class="pre">&lt;xsl:stylesheet&gt;</span></code>:</p>
<div class="highlight-dtd notranslate"><div class="highlight"><pre><span></span><span class="k">&lt;!ELEMENT</span> <span class="nt">xsl:stylesheet</span> <span class="o">(</span><span class="nt">xsl:import</span><span class="o">*,</span> <span class="nt">top-level-elements</span><span class="o">)</span><span class="k">&gt;</span>
<span class="k">&lt;!ATTLIST</span> <span class="nt">xsl:stylesheet</span> <span class="na">id</span>                         <span class="kc">ID</span>       <span class="kc">#IMPLIED</span>
                         <span class="na">version</span>                    <span class="kc">NMTOKEN</span>  <span class="kc">#REQUIRED</span>
                         <span class="na">extension-element-prefixes</span> <span class="kc">NMTOKENS</span> <span class="kc">#IMPLIED</span>
                         <span class="na">exclude-result-prefixes</span>    <span class="kc">NMTOKENS</span> <span class="kc">#IMPLIED</span><span class="k">&gt;</span>
</pre></div>
</div>
<p>El elemento puede tener un identificador, pero es opcional y no muy común. Lo
que sí es obligatorio es incluir la versión del <abbr title="eXtensible Stylesheet Language Transformations">XSLT</abbr> que se está usando:
<strong>1.0</strong>, <strong>2.0</strong> o <strong>3.0</strong>. En nuestro caso, siempre será <strong>1.0*</strong>.  Además,
como todo elemento <abbr title="eXtensible  Markup Language">XML</abbr>, puede tener la definición de su propio espacio de
nombres (que suele ser <em>xsl</em>).  Así pues, una apertura típica es:</p>
<div class="highlight-xslt notranslate"><div class="highlight"><pre><span></span><span class="k">&lt;xsl:stylesheet</span><span class="w"> </span><span class="na">version=</span><span class="s">&quot;1.0&quot;</span><span class="w"> </span><span class="na">xmlns:xsl=</span><span class="s">&quot;http://www.w3.org/1999/XSL/Transform&quot;</span><span class="nt">&gt;</span>

<span class="w">   </span><span class="cm">&lt;!-- Contenido de la hoja --&gt;</span>

<span class="k">&lt;/xsl:stylesheet&gt;</span>
</pre></div>
</div>
<p>Cuando se usan extensiones <a class="reference internal" href="#e-xslt"><span class="std std-ref">EXSLT</span></a>, es necesario incluir el atributo
<code class="docutils literal notranslate"><span class="pre">extension-element-prefixes</span></code> (y el espacio de nombres correspondiente). Por
ejemplo, si se usan las extensiones para fecha y matemáticas:</p>
<div class="highlight-xslt notranslate"><div class="highlight"><pre><span></span><span class="k">&lt;xsl:stylesheet</span><span class="w"> </span><span class="na">version=</span><span class="s">&quot;1.0&quot;</span><span class="w"> </span><span class="na">xmlns:xsl=</span><span class="s">&quot;http://www.w3.org/1999/XSL/Transform&quot;</span>
<span class="w">                              </span><span class="na">xmlns:date=</span><span class="s">&quot;http://exslt.org/dates-and-times&quot;</span>
<span class="w">                              </span><span class="na">xmlns:math=</span><span class="s">&quot;http://exslt.org/math&quot;</span>
<span class="w">                              </span><span class="na">extension-element-prefixes=</span><span class="s">&quot;date math&quot;</span><span class="nt">&gt;</span>

<span class="w">   </span><span class="cm">&lt;!-- Contenido de la hoja --&gt;</span>

<span class="k">&lt;/xsl:stylesheet&gt;</span>
</pre></div>
</div>
<p id="xsl-include"><span id="xsl-import"></span>Abierto el elemento <a class="reference internal" href="#xsl-stylesheet"><span class="std std-ref">&lt;xsl:stylesheet&gt;</span></a> lo primero que hay que hacer es
importar otros <abbr title="eXtensible Stylesheet Language Transformations">XSLT</abbr>, si es que se van a reaprovechar las definiciones que se
hicieron en otros ficheros, con <code class="docutils literal notranslate"><span class="pre">&lt;xsl:import&gt;</span></code>. También existe
<code class="docutils literal notranslate"><span class="pre">&lt;xsl:include&gt;</span></code> que puede usarse en cualquier posición dentro de
xsl:stylesheet:</p>
<div class="highlight-dtd notranslate"><div class="highlight"><pre><span></span><span class="k">&lt;!ELEMENT</span> <span class="nt">xsl:import</span> <span class="kc">EMPTY</span><span class="k">&gt;</span>
<span class="k">&lt;!ATTLIST</span> <span class="nt">xsl:import</span> <span class="na">href</span> <span class="kc">CDATA</span> <span class="kc">#REQUIRED</span><span class="k">&gt;</span>

<span class="k">&lt;!ELEMENT</span> <span class="nt">xsl:include</span> <span class="kc">EMPTY</span><span class="k">&gt;</span>
<span class="k">&lt;!ATTLIST</span> <span class="nt">xsl:include</span> <span class="na">href</span> <span class="kc">CDATA</span> <span class="kc">#REQUIRED</span><span class="k">&gt;</span>
</pre></div>
</div>
<p>En ambos casos, el atributo <em>href</em> permite indicar la dirección del documento
xsl importado. Como se ve se definen del mismo modo, pero no son elementos
equivalentes. <code class="docutils literal notranslate"><span class="pre">&lt;xsl:include&gt;</span></code> puede usarse cuando la definiciones hechas es un
documento externo queremos tenerlas disponibles exactamente del mismo modo que
las tendríamos disponibles, si las hubiéramos hecho dentro del propio documento.
Es útil cuando queremos despiezar nuestra transformación en varios ficheros,
quizás porque sea muy compleja.</p>
<p><code class="docutils literal notranslate"><span class="pre">&lt;xsl:import&gt;</span></code> actúa de distinta forma y tiene otra utilidad: la de modificar
estilos ya definidos sin tener que reescribir todo. En este caso, las
definiciones de la hoja que se importa tienen menos prioridad que las de la hoja
importadora. Así pues, si quisiéramos crear otra hoja xsl que sacara una salida
idéntica a la del <a class="reference internal" href="#xslt-ejemplo"><span class="std std-ref">primer ejemplo</span></a>, salvo por el hecho de
que queremos que los signos “+” sean asteriscos (“*”), podríamos hacer lo
siguiente:</p>
<div class="highlight-xslt notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="k">&lt;xsl:stylesheet</span><span class="w"> </span><span class="na">version=</span><span class="s">&quot;1.0&quot;</span>
<span class="w">                </span><span class="na">xmlns:xsl=</span><span class="s">&quot;http://www.w3.org/1999/XSL/Transform&quot;</span><span class="nt">&gt;</span>

<span class="w">   </span><span class="k">&lt;xsl:import</span><span class="w"> </span><span class="na">href=</span><span class="s">&quot;discos.txt.xsl&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>

<span class="w">   </span><span class="k">&lt;xsl:template</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;tipo&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:text</span><span class="nt">&gt;</span><span class="ni">&amp;#10;</span><span class="k">&lt;/xsl:text&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:text</span><span class="nt">&gt;</span>*<span class="w"> </span><span class="k">&lt;/xsl:text&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:value-of</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;@tipo&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:text</span><span class="nt">&gt;</span><span class="ni">&amp;#10;</span><span class="k">&lt;/xsl:text&gt;</span>
<span class="w">   </span><span class="k">&lt;/xsl:template&gt;</span>

<span class="k">&lt;/xsl:stylesheet&gt;</span>
</pre></div>
</div>
<p id="xsl-output">O sea, importamos las definiciones de <code class="file docutils literal notranslate"><span class="pre">discos.txt.xsl</span></code> y redifinimos la
plantilla con nombre <em>tipo</em>. Otro elemento importante al comenzar a
escribir un documento <abbr title="eXtensible Stylesheet Language Transformations">XSLT</abbr> es <code class="docutils literal notranslate"><span class="pre">&lt;xsl:output&gt;</span></code>, el cual permite definir cómo
será la salida de procesamiento, es decir, cómo será el resultado de nuestra
transformación:</p>
<div class="highlight-xslt notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;!ELEMENT xsl:output EMPTY&gt;</span>
<span class="cp">&lt;!ATTLIST xsl:output method               (xml|html|text) &quot;xml&quot;</span>
<span class="cp">                     version              CDATA          #IMPLIED</span>
<span class="cp">                     encoding             NMTOKEN        #IMPLIED</span>
<span class="cp">                     omit-xml-declaration (yes|no)       &quot;no&quot;</span>
<span class="cp">                     standalone           (yes|no)       &quot;no&quot;</span>
<span class="cp">                     doctype-public       CDATA          #IMPLIED</span>
<span class="cp">                     doctype-system       CDATA          #IMPLIED</span>
<span class="cp">                     indent               (yes|no)       &quot;no&quot;</span>
<span class="cp">                     media-type           CDATA          #IMPLIED&gt;</span>
</pre></div>
</div>
<p>El primero de los atributos debe especificar cuál será el método de salida:
«<em>xml</em>» para generar otro <abbr title="eXtensible  Markup Language">XML</abbr>, «<em>text</em>» para generar un fichero de texto y
<abbr title="HyperText Markup Language">HTML</abbr> para generar un <abbr title="HyperText Markup Language">HTML</abbr> (en su variante <abbr title="Standard Generalized Markup Language">SGML</abbr>). En la versión <strong>1.0</strong>, si
se quiere generar un fichero <abbr title="eXtensible HyperText Markup Language">XHTML</abbr> hay que especificar el método «<em>xml</em>». El
atributo version permite indicar la versión del <abbr title="eXtensible  Markup Language">XML</abbr> o <abbr title="HyperText Markup Language">HTML</abbr> de salida.
También es interesante <code class="docutils literal notranslate"><span class="pre">indent</span></code> que permite sacar un documento <abbr title="eXtensible  Markup Language">XML</abbr> o <abbr title="HyperText Markup Language">HTML</abbr>
con un sangrado que lo haga legible. Los <a class="reference internal" href="#xslt-ejemplo"><span class="std std-ref">ejemplos expositorios</span></a> muestran el uso de este elemento.</p>
<p><a class="reference internal" href="#xsl-stylesheet"><span class="std std-ref">&lt;xsl:stylesheet&gt;</span></a> tiene otros hijos posibles, pero se introducirán adelante.</p>
</section>
<section id="plantillas">
<h3>Plantillas<a class="headerlink" href="#plantillas" title="Enlace permanente a este encabezado">¶</a></h3>
<section id="definicion">
<h4>Definición<a class="headerlink" href="#definicion" title="Enlace permanente a este encabezado">¶</a></h4>
<p>La definicion de las transformaciones consiste basicamente en describir cómo se
transformara cada uno de los nodos del <abbr title="eXtensible  Markup Language">XML</abbr> original, esto es, en crear
plantillas para la transformacion de cada nodo.</p>
<p id="xsl-template">Estas plantillas se crean dentro de <a class="reference internal" href="#xsl-stylesheet"><span class="std std-ref">&lt;xsl:stylesheet&gt;</span></a> mediante el elemento
<code class="docutils literal notranslate"><span class="pre">&lt;xsl:template&gt;</span></code>, cuya definición en forma <abbr title="Document Type Definition">DTD</abbr> podría ser más o menos así:</p>
<div class="highlight-dtd notranslate"><div class="highlight"><pre><span></span><span class="k">&lt;!ELEMENT</span> <span class="nt">xsl:template</span> <span class="o">(</span><span class="nt">xsl:param</span><span class="o">*,</span> <span class="nt">template</span><span class="o">)</span>
<span class="nt">&lt;!ATTLIST</span> <span class="nt">xsl:template</span> <span class="nt">match</span>     <span class="nt">CDATA</span>    <span class="nt">#IMPLIED</span>
                       <span class="nt">name</span>      <span class="nt">NMTOKEN</span>  <span class="nt">#IMPLIED</span>
                       <span class="nt">priority</span>  <span class="nt">NMTOKEN</span>  <span class="nt">#IMPLIED</span>
                       <span class="nt">mode</span>      <span class="nt">NMTOKEN</span>  <span class="nt">#IMPLIED</span><span class="k">&gt;</span>
</pre></div>
</div>
<p>Empecemos aclarando sus parametros:</p>
<dl>
<dt><em>match</em></dt><dd><p>permite indicar una expresion <em>XPath</em> que determina sobre qué  elemento o
elementos es aplicable la plantilla. Así, por ejemplo, <code class="code docutils literal notranslate"><span class="pre">match=&quot;disco&quot;</span></code>
indica que la plantilla es aplicable a los elementos «disco», se encuentren
donde se encuentren, puesto que no se especifica ruta y en este punto no
tiene sentido expresar una ruta relativsa ya que no tenemos ninguna
referencia. En cambio, si la expresión hubiera sido <code class="code docutils literal notranslate"><span class="pre">match=&quot;disco[1]&quot;</span></code>,
la plantilla sólo se aplicaria al primer elemento «disco» y no al resto.  El
parámetro es obligatorio a menos que se incluya un parámetro <em>name</em>.</p>
</dd>
<dt><em>name</em></dt><dd><p>permite darle un nombre a la plantilla y puede aparecer con o sin el
parámetro <code class="docutils literal notranslate"><span class="pre">match</span></code>. Las plantillas con nombre pueden invocadarse apelando
al nombre y no describen directamente la transformación de nodos del <abbr title="eXtensible  Markup Language">XML</abbr>
original como hacen aquellas con <code class="docutils literal notranslate"><span class="pre">match</span></code>: simplemente, cuando se invocan,
se ejecutan tomando como <a class="reference internal" href="#xslt-nodo-proces"><span class="std std-ref">nodo de procesamiento</span></a> el
nodo de procesamiento de la plantilla desde la que se invocan. Véase el
<a class="reference internal" href="#xslt-ejemplo"><span class="std std-ref">primer ejemplo introductorio</span></a> en que hay definida una
llamada «<em>tipo</em>».</p>
</dd>
<dt><em>mode</em></dt><dd><p>es un parámetro opcional y permite crear distintas plantillas para un mismo
elemento. Cuál de las plantillas se use, dependerá entonces del atribute
<em>mode</em> con el que se invoque (vease <a class="reference internal" href="#xsl-apply-templates"><span class="std std-ref">&lt;xsl:apply-templates&gt;</span></a>).</p>
</dd>
<dt><em>priority</em></dt><dd><p>modifica la prioridad predeterminada de la plantilla, que se calcula
atendiendo al valor de <em>match</em>. Esta prioridad predeterminada es:</p>
<table class="xslt-prioridad docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Prioridad</p></th>
<th class="head"><p>Descripción</p></th>
<th class="head"><p>Ejemplo</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>-0.50</p></td>
<td><p>Comodín o nombre genérico</p></td>
<td><div class="line-block">
<div class="line">*</div>
<div class="line">&#64;*</div>
<div class="line">node()</div>
<div class="line">text()</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>-0.25</p></td>
<td><p>Comodin con espacio de nombres</p></td>
<td><div class="line-block">
<div class="line">ns:*</div>
<div class="line">&#64;ns:*</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>0.00</p></td>
<td><p>Nombre particular de un nodo</p></td>
<td><div class="line-block">
<div class="line">disco</div>
<div class="line">&#64;tipo</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>0.50</p></td>
<td><p>Cualquier otra expresión más precisa</p></td>
<td><div class="line-block">
<div class="line">/discoteca/disco</div>
<div class="line">disco[&#64;tipo=”clasica”]</div>
</div>
</td>
</tr>
</tbody>
</table>
<p>Esto significa que si tuvieramos dos plantillas, una con
<code class="code docutils literal notranslate"><span class="pre">match=&quot;disco&quot;</span></code> y otra con <code class="code docutils literal notranslate"><span class="pre">match=&quot;disco[last()]&quot;</span></code>, el último
elemento «disco» cumple con ambas expresiones, pero como la segunda expresión
tiene más prioridad que la primera, entonces la plantilla que se usará para
este último disco es la segunda. Por supuesto, el atributo <em>priority</em> permite
indicar una prioridad numérica que altere la prioridad calculada.</p>
</dd>
</dl>
<p>El contenido de un elemento <a class="reference internal" href="#xsl-template"><span class="std std-ref">&lt;xsl:template&gt;</span></a> es muy diverso y depende mucho de qué
queramos hacer dentro de él: obsérvese que dentro de él tienen cabida tanto la
mayoría de los elementos de <abbr title="eXtensible Stylesheet Language Transformations">XSLT</abbr> como elementos del <abbr title="eXtensible  Markup Language">XML</abbr> resultante: basta
mirar <a class="reference internal" href="#xslt-ejemplo"><span class="std std-ref">los dos ejemplos de arriba</span></a> para comprobar lo que se
afirma ahora. Así pues, ya sabremos ir rellenando este elemento según vayamos
viendo cada elemento.</p>
<p id="xslt-nodo-proces">Es fundamental tener claro el concepto de <strong>nodo de procesamiento</strong>. El
<em class="dfn">nodo de procesamiento</em> es aquel nodo del <abbr title="eXtensible  Markup Language">XML</abbr> original al que la
plantilla está aplicando la transformación. Cuando se usan expresiones <em>XPath</em>
relativas dentro de una plantilla, se sobreentiende que son relativas a su nodo
de procesamiento. Si echa un vistazo al <a class="reference internal" href="#xslt-ejemplo"><span class="std std-ref">primer ejemplo</span></a>
verá que en la plantilla para «/» se invoca para todos los hijos
<code class="docutils literal notranslate"><span class="pre">&lt;disco&gt;</span></code> de <code class="docutils literal notranslate"><span class="pre">&lt;discoteca&gt;</span></code> la aplicación de su plantilla<a class="footnote-reference brackets" href="#id12" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a>:</p>
<div class="highlight-xslt notranslate"><div class="highlight"><pre><span></span><span class="k">&lt;xsl:apply-templates</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;discoteca/disco&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</pre></div>
</div>
<p>Esto supone que se aplique consecutivamente <strong>6</strong> veces la plantilla para
<code class="docutils literal notranslate"><span class="pre">&lt;disco&gt;</span></code>, ya que seis son los elementos <code class="docutils literal notranslate"><span class="pre">&lt;disco&gt;</span></code> del <abbr title="eXtensible  Markup Language">XML</abbr> original<a class="footnote-reference brackets" href="#id13" id="id4" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a>.
Durante la primera ejecución de la plantilla el nodo de procesamiento será el
primer elemento <code class="docutils literal notranslate"><span class="pre">&lt;disco&gt;</span></code>; durante la segunda, el segundo; y así
sucesivamente. Por este motivo, las expresiones <code class="docutils literal notranslate"><span class="pre">&#64;tipo</span></code>, <code class="docutils literal notranslate"><span class="pre">nombre</span></code> o
<code class="docutils literal notranslate"><span class="pre">autor</span></code> funcionan, ya que se refieren al nodo de procesamiento, que es un
elemento <code class="docutils literal notranslate"><span class="pre">&lt;disco&gt;</span></code>.</p>
<p id="xsl-param">Ahora bien, aparte de todos estos innumerables elementos hay uno en particular
con el que se puede abrir la definición de una plantilla: xsl:param. El nombre
de este elemento no es caprichoso: <em>param</em> es apócope de <em>parámeter</em>, parámetro, y
declara los parámetros que se pueden pasar a la plantilla cuando se la invoca,
del mismo modo que en un lenguaje de programación más convencional se pueden
pasar argumentos a las funciones. Es más, en este lenguaje los plantillas hacen
el papel de funciones.</p>
<p>La definición del elemento es esta:</p>
<div class="highlight-dtd notranslate"><div class="highlight"><pre><span></span><span class="k">&lt;!ELEMENT</span> <span class="nt">xsl:param</span> <span class="o">(</span><span class="nt">template</span><span class="o">)</span><span class="k">&gt;</span>
<span class="k">&lt;!ATTLIST</span> <span class="nt">xsl:param</span> <span class="na">name</span>   <span class="kc">NMTOKEN</span> <span class="kc">#REQUIRED</span>
                    <span class="na">select</span> <span class="kc">CDATA</span>   <span class="kc">#IMPLIED</span><span class="k">&gt;</span>
</pre></div>
</div>
<p>El atributo <code class="docutils literal notranslate"><span class="pre">name</span></code> es obligatorio y declara cómo se llama el parámetro. El
atributo <code class="docutils literal notranslate"><span class="pre">select</span></code>, sin embargo, es opcional e indica cuál será el valor
predeterminado del parámetro cuando en la invocación a la plantilla no se
indique valor alguno. Estos son ejemplos de declaraciones correctas de
parámetros:</p>
<div class="highlight-xslt notranslate"><div class="highlight"><pre><span></span><span class="k">&lt;xsl:template</span><span class="w"> </span><span class="na">match=</span><span class="s">&quot;disco&quot;</span><span class="nt">&gt;</span>
<span class="w">   </span><span class="k">&lt;xsl:param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;uno&quot;</span><span class="w"> </span><span class="nt">/&gt;</span><span class="w">                 </span><span class="cm">&lt;!-- Parámetro sin valor predeterminado --&gt;</span>
<span class="w">   </span><span class="k">&lt;xsl:param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;dos&quot;</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;&#39;soy 2&#39;&quot;</span><span class="nt">/&gt;</span><span class="w"> </span><span class="cm">&lt;!-- Parámetro con valor predeterminado --&gt;</span>

<span class="w">   </span><span class="cm">&lt;!-- Operaciones que se hacen en esta plantilla --&gt;</span>
<span class="k">&lt;/xsl:template&gt;</span>
</pre></div>
</div>
<p>Sin embargo, el elemento <a class="reference internal" href="#xsl-param"><span class="std std-ref">&lt;xsl:param&gt;</span></a> puede no estar vacío. En este caso, su
contenido sirve para generar un valor que será el que se tome como
predeterminado. Por ejemplo:</p>
<div class="highlight-xslt notranslate"><div class="highlight"><pre><span></span><span class="k">&lt;xsl:template</span><span class="w"> </span><span class="na">match=</span><span class="s">&quot;disco&quot;</span><span class="nt">&gt;</span>
<span class="w">   </span><span class="k">&lt;xsl:param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;uno&quot;</span><span class="w"> </span><span class="nt">/&gt;</span><span class="w"> </span><span class="cm">&lt;!-- Sin valor predeterminado --&gt;</span>
<span class="w">   </span><span class="k">&lt;xsl:param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;dos&quot;</span><span class="nt">&gt;</span><span class="w">   </span><span class="cm">&lt;!-- El Valor predeterminado lo genera el contenido --&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:value-of</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;&#39;soy &#39;&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:text</span><span class="nt">&gt;</span>2<span class="nt">&lt;/text&gt;</span>
<span class="w">   </span><span class="k">&lt;/xsl:param&gt;</span>

<span class="w">   </span><span class="cm">&lt;!-- Operaciones que se hacen en esta plantilla --&gt;</span>
<span class="k">&lt;/xsl:template&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Por lo general, esta segunda forma se usa cuando el valor no es un
valor fijo, sino que se genera de una forma más o menos complicada que
requiere hacer varias operaciones.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">Ver también</p>
<p>El documento <abbr title="eXtensible Stylesheet Language Transformations">XSLT</abbr> en sí también puede recibir parámetros externos
y estos se definen con <a class="reference internal" href="#xsl-param"><span class="std std-ref">&lt;xsl:param&gt;</span></a>. Consulte la <a class="reference internal" href="#xslt-variables"><span class="std std-ref">sección dedicada a las
variables</span></a> para más información.</p>
</div>
<p>Para usar el valor de estos parámetros dentro del cuerpo de la plantilla, debe
utlizarse la misma sintaxis que para las <strong>constantes</strong> definidas mediante
<a class="reference internal" href="#xsl-variable"><span class="std std-ref">&lt;xsl:variable&gt;</span></a>.</p>
</section>
<section id="invocacion">
<h4>Invocación<a class="headerlink" href="#invocacion" title="Enlace permanente a este encabezado">¶</a></h4>
<p>Hay dos modos de invocar una plantilla:</p>
<ol class="arabic" id="xsl-apply-templates">
<li><p>Basándose en el nodo con <code class="docutils literal notranslate"><span class="pre">&lt;xsl:apply-templates&gt;</span></code>, para aquellas plantillas
que tengan un atributo <code class="docutils literal notranslate"><span class="pre">match</span></code>:</p>
<div class="highlight-dtd notranslate"><div class="highlight"><pre><span></span><span class="k">&lt;!ELEMENT</span> <span class="nt">xsl:apply-templates</span> <span class="o">(</span><span class="nt">xsl:sort</span><span class="o">|</span><span class="nt">xsl:with-param</span><span class="o">)*</span><span class="k">&gt;</span>
<span class="k">&lt;!ATTLIST</span> <span class="nt">xsl:apply-templates</span> <span class="na">select</span> <span class="kc">CDATA</span>   <span class="kc">#IMPLIED</span>
                              <span class="na">mode</span>   <span class="kc">NMTOKEN</span> <span class="kc">#IMPLIED</span><span class="k">&gt;</span>
</pre></div>
</div>
</li>
<li><p>Basándose en su nombre con <code class="docutils literal notranslate"><span class="pre">&lt;xsl:call-template&gt;</span></code>, para aquellas plantillas
que tengan un atributo <code class="docutils literal notranslate"><span class="pre">name</span></code>:</p>
<div class="highlight-dtd notranslate"><div class="highlight"><pre><span></span><span class="k">&lt;!ELEMENT</span> <span class="nt">xsl:call-template</span> <span class="nt">xsl:with-param</span><span class="o">*</span><span class="k">&gt;</span>
<span class="k">&lt;!ATTLIST</span> <span class="nt">xsl:call-template</span> <span class="na">name</span> <span class="kc">NMTOKEN</span> <span class="kc">#REQUIRED</span><span class="k">&gt;</span>
</pre></div>
</div>
</li>
</ol>
<p>Ambos modos de invocación están ilustrados en los <a class="reference internal" href="#xslt-ejemplo"><span class="std std-ref">ejemplos introductorios</span></a>. Por ejemplo, en la plantilla para el elemento «/» del primer
ejemplo, se invoca la plantilla disco para que se aplique a los elementos de
<code class="file docutils literal notranslate"><span class="pre">/discoteca/disco</span></code>:</p>
<div class="highlight-xslt notranslate"><div class="highlight"><pre><span></span><span class="k">&lt;xsl:apply-templates</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;disco&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</pre></div>
</div>
<p>La invocación también podría haber sido:</p>
<div class="highlight-xslt notranslate"><div class="highlight"><pre><span></span><span class="k">&lt;xsl:apply-templates</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;//disco&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</pre></div>
</div>
<p>o incluso:</p>
<div class="highlight-xslt notranslate"><div class="highlight"><pre><span></span><span class="k">&lt;xsl:apply-templates</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;*&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</pre></div>
</div>
<p>puesto que las tres expresiones <em>XPath</em> que dan valor al atributo <code class="docutils literal notranslate"><span class="pre">select</span></code>
seleccionan todos los discos de la «discoteca». En consecuencia, la salida
mostrará las transformaciones de cada elemento  <code class="code docutils literal notranslate"><span class="pre">&lt;disco&gt;</span></code> y en el orden en
que la expresión <em>XPath</em> los devuelve, esto es, el orden en que aparecen en el
<abbr title="eXtensible  Markup Language">XML</abbr> original. En cambio, si se hubiera escrito:</p>
<div class="highlight-xslt notranslate"><div class="highlight"><pre><span></span><span class="k">&lt;xsl:apply-templates</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;disco&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</pre></div>
</div>
<p>no se habría aplicado ninguna plantilla a los discos, ya que no hay ningún
<code class="docutils literal notranslate"><span class="pre">&lt;disco&gt;</span></code> hijo del nodo «/», que es el que se está procesando en el momento de
usar este <a class="reference internal" href="#xsl-apply-templates"><span class="std std-ref">&lt;xsl:apply-templates&gt;</span></a>.</p>
<p>Si no se expresa el atributo <code class="docutils literal notranslate"><span class="pre">select</span></code> se aplican las plantillas de todos los
nodos hijos del nodo de procesamiento.</p>
<p>Además del atributo <code class="docutils literal notranslate"><span class="pre">select</span></code>, puede incluirse opcionalmente un atributo
<code class="docutils literal notranslate"><span class="pre">mode</span></code> en caso de que al definir la plantilla se usase tal atributo también.</p>
<p>Como contenido pueden incluirse dos elementos: <a class="reference internal" href="#xsl-sort"><span class="std std-ref">&lt;xsl:sort&gt;</span></a>, que permite
aplicar la plantilla a los nodos según un determinado orden (de lo contrario el
orden vendrá determinado por la aparición del nodo en el documento); y
<a class="reference internal" href="#xsl-with-param"><span class="std std-ref">&lt;xsl:with-param&gt;</span></a> que permite pasar parámetros a la plantilla<a class="footnote-reference brackets" href="#id14" id="id5" role="doc-noteref"><span class="fn-bracket">[</span>4<span class="fn-bracket">]</span></a>.</p>
<p id="xsl-with-param">La definición pseudo-formal de <code class="docutils literal notranslate"><span class="pre">&lt;xsl:with-param&gt;</span></code> es exactamente la misma que
para <a class="reference internal" href="#xsl-param"><span class="std std-ref">&lt;xsl:param&gt;</span></a>:</p>
<div class="highlight-dtd notranslate"><div class="highlight"><pre><span></span><span class="k">&lt;!ELEMENT</span> <span class="nt">xsl:with-param</span> <span class="o">(</span><span class="nt">template</span><span class="o">)</span><span class="k">&gt;</span>
<span class="k">&lt;!ATTLIST</span> <span class="nt">xsl:with-param</span> <span class="na">name</span>   <span class="kc">NMTOKEN</span> <span class="kc">#REQUIRED</span>
                         <span class="na">select</span> <span class="kc">CDATA</span>   <span class="kc">#IMPLIED</span><span class="k">&gt;</span>
</pre></div>
</div>
<p>y podemos explicar exactamente lo mismo, de modo que no se repetirá.</p>
<p id="xsl-sort">Por su parte, la definición de <code class="docutils literal notranslate"><span class="pre">&lt;xsl:sort&gt;</span></code> es la siguiente:</p>
<div class="highlight-dtd notranslate"><div class="highlight"><pre><span></span><span class="k">&lt;!ELEMENT</span> <span class="nt">xsl:sort</span> <span class="kc">EMPTY</span><span class="k">&gt;</span>
<span class="k">&lt;!ATTLIST</span> <span class="nt">xsl:sort</span> <span class="na">select</span>     <span class="kc">CDATA</span>   <span class="kc">#REQUIRED</span>
                   <span class="na">lang</span>       <span class="kc">NMTOKEN</span> <span class="kc">#IMPLIED</span>
                   <span class="na">data-type</span>  <span class="o">(</span><span class="na">text</span><span class="o">|</span><span class="na">number</span><span class="o">|</span><span class="na">qname</span><span class="o">)</span> <span class="s2">&quot;text&quot;</span>
                   <span class="na">order</span>      <span class="o">(</span><span class="na">ascending</span><span class="o">|</span><span class="na">descending</span><span class="o">)</span> <span class="s2">&quot;ascending&quot;</span>
                   <span class="na">case-order</span> <span class="o">(</span><span class="na">upper-first</span><span class="o">|</span><span class="na">lower-first</span><span class="o">)</span> <span class="s2">&quot;upper-first&quot;</span><span class="k">&gt;</span>
</pre></div>
</div>
<p>El atributo fundamental de <a class="reference internal" href="#xsl-sort"><span class="std std-ref">&lt;xsl:sort&gt;</span></a> es <code class="docutils literal notranslate"><span class="pre">select</span></code> que indica que expresión
<em>XPath</em> se utilizará para definir la ordenación. El resto de los atributos
permite modificar esta ordenación: <code class="docutils literal notranslate"><span class="pre">lang</span></code> especifica la lengua que se usará
para ordenar; <code class="docutils literal notranslate"><span class="pre">data-type</span></code> si se ordenará suponiendo texto o suponiendo
números; <code class="docutils literal notranslate"><span class="pre">order</span></code> si se quiere que la ordenación sea de menor a mayor o de
mayor a menor; y <code class="docutils literal notranslate"><span class="pre">case-order</span></code>, si se quiere que la mayúscula o la minúscula
vaya primero.</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>En <a class="reference internal" href="#xslt-ejemplo"><span class="std std-ref">los ejemplos</span></a> se usa este elemento para ordenar
los discos por su tipo.</p>
</div>
<p>Para ordenar pueden usarse varios <a class="reference internal" href="#xsl-sort"><span class="std std-ref">&lt;xsl:sort&gt;</span></a>; en ese caso, se ordenará según el
criterio del primer <a class="reference internal" href="#xsl-sort"><span class="std std-ref">&lt;xsl:sort&gt;</span></a>, y a igualdad de éste, según el segundo y así
sucesivamente. Por ejemplo, en el <a class="reference internal" href="../01.intro/02b.marcas.html#xml-ejemplo"><span class="std std-ref">ejemplo introductorio sobre el claustro
de profesores</span></a>, podríamos ordenar alfabéticamente del siguiente
modo:</p>
<div class="highlight-xslt notranslate"><div class="highlight"><pre><span></span><span class="k">&lt;xsl:apply-templates</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;profesor&quot;</span><span class="nt">&gt;</span>
<span class="w">   </span><span class="k">&lt;xsl:sort</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;apellidos&quot;</span><span class="nt">/&gt;</span>
<span class="w">   </span><span class="k">&lt;xsl:sort</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;nombre&quot;</span><span class="nt">/&gt;</span>
<span class="k">&lt;/xsl:apply-templates&gt;</span>
</pre></div>
</div>
<p>Un aspecto a tener en cuenta cuando se usa <a class="reference internal" href="#xsl-sort"><span class="std std-ref">&lt;xsl:sort&gt;</span></a>, es cómo se evalúa la
<a class="reference internal" href="../03.consulta/01.xpath.html#xpath-position"><span class="std std-ref">función position() de XPath</span></a>. Esta función devuelve la
posición del nodo respecto al conjunto de nodos que se están evaluando; y no
respecto a la posición que ocupa dentro del documento. Esto significa que si
definimos esta simple transformación:</p>
<div class="highlight-xslt notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="k">&lt;xsl:stylesheet</span><span class="w"> </span><span class="na">version=</span><span class="s">&quot;1.0&quot;</span>
<span class="w">                </span><span class="na">xmlns:xsl=</span><span class="s">&quot;http://www.w3.org/1999/XSL/Transform&quot;</span><span class="nt">&gt;</span>
<span class="w"> </span>
<span class="w">   </span><span class="k">&lt;xsl:output</span><span class="w"> </span><span class="na">method=</span><span class="s">&quot;text&quot;</span><span class="w"> </span><span class="na">encoding=</span><span class="s">&quot;UTF-8&quot;</span><span class="nt">/&gt;</span>
<span class="w"> </span>
<span class="w">   </span><span class="k">&lt;xsl:template</span><span class="w"> </span><span class="na">match=</span><span class="s">&quot;discoteca&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:text</span><span class="nt">&gt;</span>LISTA<span class="w"> </span>DE<span class="w"> </span>DISCOS<span class="ni">&amp;#10;</span><span class="k">&lt;/xsl:text&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:apply-templates</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;disco&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">   </span><span class="k">&lt;/xsl:template&gt;</span>
<span class="w"> </span>
<span class="w">   </span><span class="k">&lt;xsl:template</span><span class="w"> </span><span class="na">match=</span><span class="s">&quot;disco&quot;</span><span class="nt">&gt;</span>
<span class="hll"><span class="w">      </span><span class="k">&lt;xsl:value-of</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;position()&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</span><span class="w">      </span><span class="k">&lt;xsl:text</span><span class="nt">&gt;</span>.<span class="w"> </span><span class="k">&lt;/xsl:text&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:value-of</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;nombre&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:text</span><span class="nt">&gt;</span><span class="ni">&amp;#10;</span><span class="k">&lt;/xsl:text&gt;</span>
<span class="w">   </span><span class="k">&lt;/xsl:template&gt;</span>
<span class="w"> </span>
<span class="k">&lt;/xsl:stylesheet&gt;</span>
</pre></div>
</div>
<p>la salida que se obtiene, puesto que no se especificó ningún orden en
<a class="reference internal" href="#xsl-apply-templates"><span class="std std-ref">&lt;xsl:apply-templates&gt;</span></a>, sigue el orden de aparición de los elementos disco en el
documento:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>LISTA DE DISCOS

1. Nueve sinfonías
2. Kind of Blue
3. Metalmorfosis
4. Más madera
5. Ella and Louis
6. El Mesías
</pre></div>
</div>
<p>lo cual es lo esperable. Si cambiamos la ordenación de los nodos para que, por
ejemplo, se ordenen por nombre:</p>
<div class="highlight-xslt notranslate"><div class="highlight"><pre><span></span><span class="k">&lt;xsl:apply-templates</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;discoteca/disco&quot;</span><span class="nt">&gt;</span>
<span class="w">   </span><span class="k">&lt;xsl:sort</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;nombre&quot;</span><span class="w"> </span><span class="nt">&gt;</span>
<span class="k">&lt;/xsl:apply-templates&gt;</span>
</pre></div>
</div>
<p>obtendremos esto otro:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>LISTA DE DISCOS

1. El Mesías
2. Ella and Louis
3. Kind of Blues
4. Más madera
5. Metalmorfosis
6. Nueve sinfonías
</pre></div>
</div>
<p>Como puede observarse, la <em>posición</em> siempre es relativa a la ordenación que
hayamos hecho, y no tiene nada que ver con la posición que ocupen dentro del
documento. Si hubiéramos querido hacer referencia a la posición en él deberíamos
haber usado el elemento <a class="reference internal" href="#xsl-number"><span class="std std-ref">&lt;xsl:number&gt;</span></a>.</p>
<p id="xsl-call-template">La otra forma de aplicar plantillas es invocarlas por su nombre con
<code class="docutils literal notranslate"><span class="pre">&lt;xsl:call-template&gt;</span></code>. En este caso, al invocarlas de este modo, no se le
indica al procesador que aplique la plantilla adecuada a los nodos que se
seleccionan con la expresión <em>XPath</em> incluida en <code class="docutils literal notranslate"><span class="pre">match</span></code>, sino que se le insta
a que aplique la plantilla cuyo nombre se refiere con <code class="docutils literal notranslate"><span class="pre">name</span></code>. El procesador,
pues, salta a otro lugar del código <abbr title="eXtensible Stylesheet Language Transformations">XSLT</abbr> (la plantilla invocada), pero no
salta de <em>nodo de procesamiento</em>: éste sigue siendo el mismo que procesaba.</p>
<p>En consecuencia, crear una plantilla y aplicarla con <a class="reference internal" href="#xsl-call-template"><span class="std std-ref">&lt;xsl:call-template&gt;</span></a> dentro de
la invocante es equivalente a no hacerlo e incluir su código sin modificaciones
dentro de la invocante en el punto en que se aplica con <a class="reference internal" href="#xsl-call-template"><span class="std std-ref">&lt;xsl:call-template&gt;</span></a>. Las
plantillas con nombre, sin embargo, nos permiten estructurar mejor el código.</p>
<p>El uso de <a class="reference internal" href="#xsl-call-template"><span class="std std-ref">&lt;xsl:call-template&gt;</span></a> con una plantilla con nombre se puede comprobar en
el <a class="reference internal" href="#xslt-ejemplo"><span class="std std-ref">primer ejemplo expositorio</span></a>:</p>
<div class="highlight-xslt notranslate"><div class="highlight"><pre><span></span><span class="k">&lt;xsl:template</span><span class="w"> </span><span class="na">match=</span><span class="s">&quot;disco&quot;</span><span class="nt">&gt;</span>

<span class="w">   </span><span class="k">&lt;xsl:if</span><span class="w"> </span><span class="na">test=</span><span class="s">&quot;not(preceding-sibling::disco[@tipo = current()/@tipo])&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:call-template</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;tipo&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">   </span><span class="k">&lt;/xsl:if&gt;</span>

<span class="w">   </span><span class="k">&lt;xsl:text</span><span class="nt">&gt;</span><span class="w">   </span>-<span class="w"> </span><span class="k">&lt;/xsl:text&gt;</span>
<span class="w">   </span><span class="k">&lt;xsl:value-of</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;nombre&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">   </span><span class="k">&lt;xsl:text</span><span class="nt">&gt;</span><span class="w"> </span><span class="k">&lt;/xsl:text&gt;</span>
<span class="w">   </span><span class="k">&lt;xsl:value-of</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;concat(&#39;(&#39;, autor, &#39;)&#39;)&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">   </span><span class="k">&lt;xsl:text</span><span class="nt">&gt;</span><span class="ni">&amp;#10;</span><span class="k">&lt;/xsl:text&gt;</span>
<span class="k">&lt;/xsl:template&gt;</span>

<span class="k">&lt;xsl:template</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;tipo&quot;</span><span class="nt">&gt;</span>
<span class="w">   </span><span class="k">&lt;xsl:text</span><span class="nt">&gt;</span><span class="ni">&amp;#10;</span><span class="k">&lt;/xsl:text&gt;</span>
<span class="w">   </span><span class="k">&lt;xsl:text</span><span class="nt">&gt;</span>+<span class="w"> </span><span class="k">&lt;/xsl:text&gt;</span>
<span class="w">   </span><span class="k">&lt;xsl:value-of</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;@tipo&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">   </span><span class="k">&lt;xsl:text</span><span class="nt">&gt;</span><span class="ni">&amp;#10;</span><span class="k">&lt;/xsl:text&gt;</span>
<span class="k">&lt;/xsl:template&gt;</span>
</pre></div>
</div>
<p>Como puede verse la generación de la línea que indica el tipo de música se ha
extraído fuera de la plantilla y se ha metido en otra con nombre
(«tipo»). El nodo de procesamiento dentro de esta plantilla siempre es
un elemento <code class="docutils literal notranslate"><span class="pre">&lt;disco&gt;</span></code>, ya que es invocada desde una plantilla en que es así.</p>
<p>También podríamos, gracias a las plantilla con nombre, reorganizar el segundo
ejemplo:</p>
<div class="highlight-xslt notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="k">&lt;xsl:stylesheet</span><span class="w"> </span><span class="na">version=</span><span class="s">&quot;1.0&quot;</span>
<span class="w">                </span><span class="na">xmlns:xsl=</span><span class="s">&quot;http://www.w3.org/1999/XSL/Transform&quot;</span><span class="nt">&gt;</span>
<span class="w"> </span>
<span class="w">   </span><span class="k">&lt;xsl:output</span><span class="w"> </span><span class="na">method=</span><span class="s">&quot;xml&quot;</span><span class="w"> </span><span class="na">version=</span><span class="s">&quot;1.0&quot;</span><span class="w"> </span><span class="na">encoding=</span><span class="s">&quot;UTF-8&quot;</span>
<span class="w">               </span><span class="na">doctype-public=</span><span class="s">&quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot;</span>
<span class="w">               </span><span class="na">doctype-system=</span><span class="s">&quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;</span>
<span class="w">               </span><span class="na">indent=</span><span class="s">&quot;yes&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w"> </span>
<span class="w">   </span><span class="k">&lt;xsl:template</span><span class="w"> </span><span class="na">match=</span><span class="s">&quot;discoteca&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;html&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;html&gt;</span>
<span class="w">         </span><span class="k">&lt;xsl:call-template</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;head&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">         </span><span class="k">&lt;xsl:call-template</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;body&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;/html&gt;</span>
<span class="w">   </span><span class="k">&lt;/xsl:template&gt;</span>
<span class="w"> </span>
<span class="w">   </span><span class="k">&lt;xsl:template</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;head&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;head&gt;</span>
<span class="w">         </span><span class="nt">&lt;title&gt;</span>Discos<span class="w"> </span>de<span class="w"> </span>mi<span class="w"> </span>fonoteca<span class="nt">&lt;/title&gt;</span>
<span class="w">      </span><span class="nt">&lt;/head&gt;</span>
<span class="w">   </span><span class="k">&lt;/xsl:template&gt;</span>
<span class="w"> </span>
<span class="w">   </span><span class="k">&lt;xsl:template</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;body&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;body&gt;</span>
<span class="w">         </span><span class="k">&lt;xsl:call-template</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;table&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;/body&gt;</span>
<span class="w">   </span><span class="k">&lt;/xsl:template&gt;</span>
<span class="w"> </span>
<span class="w">   </span><span class="k">&lt;xsl:template</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;table&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;table&gt;</span>
<span class="w">         </span><span class="nt">&lt;caption&gt;</span>Discos<span class="nt">&lt;/caption&gt;</span>
<span class="w">         </span><span class="nt">&lt;tr&gt;&lt;th&gt;</span>Tipo<span class="nt">&lt;/th&gt;&lt;th&gt;</span>Nombre<span class="nt">&lt;/th&gt;&lt;th&gt;</span>Autor<span class="nt">&lt;/th&gt;&lt;/tr&gt;</span>
<span class="w">         </span><span class="k">&lt;xsl:apply-templates</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;disco&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="k">&lt;xsl:sort</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;@tipo&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">         </span><span class="k">&lt;/xsl:apply-templates&gt;</span>
<span class="w">      </span><span class="nt">&lt;/table&gt;</span>
<span class="w">   </span><span class="k">&lt;/xsl:template&gt;</span>
<span class="w"> </span>
<span class="w">   </span><span class="k">&lt;xsl:template</span><span class="w"> </span><span class="na">match=</span><span class="s">&quot;disco&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;tr&gt;</span>
<span class="w">         </span><span class="k">&lt;xsl:if</span><span class="w"> </span><span class="na">test=</span><span class="s">&quot;/discoteca/disco[@tipo=current()/@tipo][1] = .&quot;</span><span class="w"> </span><span class="nt">&gt;</span>
<span class="w">            </span><span class="k">&lt;xsl:element</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;td&quot;</span><span class="nt">&gt;</span>
<span class="w">               </span><span class="k">&lt;xsl:attribute</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;rowspan&quot;</span><span class="nt">&gt;</span>
<span class="w">                  </span><span class="k">&lt;xsl:value-of</span>
<span class="na">select=</span><span class="s">&quot;count(/discoteca/disco[@tipo=current()/@tipo])&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">               </span><span class="k">&lt;/xsl:attribute&gt;</span>
<span class="w">               </span><span class="k">&lt;xsl:value-of</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;@tipo&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="k">&lt;/xsl:element&gt;</span>
<span class="w">         </span><span class="k">&lt;/xsl:if&gt;</span>
<span class="w">         </span><span class="nt">&lt;td&gt;</span><span class="k">&lt;xsl:value-of</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;nombre&quot;</span><span class="w"> </span><span class="nt">/&gt;&lt;/td&gt;</span>
<span class="w">         </span><span class="nt">&lt;td&gt;</span><span class="k">&lt;xsl:value-of</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;autor&quot;</span><span class="w"> </span><span class="nt">/&gt;&lt;/td&gt;</span>
<span class="w">      </span><span class="nt">&lt;/tr&gt;</span>
<span class="w">   </span><span class="k">&lt;/xsl:template&gt;</span>
<span class="w"> </span>
<span class="k">&lt;/xsl:stylesheet&gt;</span>
</pre></div>
</div>
<p class="rubric" id="xslt-default-template">¿Qué ocurre si se pide aplicar una plantilla que no se han definido?</p>
<p>La especificaciones de <abbr title="eXtensible Stylesheet Language Transformations">XSLT</abbr> <a class="reference external" href="https://www.w3.org/TR/1999/REC-xslt-19991116#built-in-rule">aclaran que existen definidas estas reglas
implícitas</a>:</p>
<div class="highlight-xslt notranslate"><div class="highlight"><pre><span></span><span class="k">&lt;xsl:template</span><span class="w"> </span><span class="na">match=</span><span class="s">&quot;*|/&quot;</span><span class="nt">&gt;</span>
<span class="w">   </span><span class="k">&lt;xsl:apply-templates</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="k">&lt;/xsl:template&gt;</span>

<span class="k">&lt;xsl:template</span><span class="w"> </span><span class="na">match=</span><span class="s">&quot;text()|@*&quot;</span><span class="nt">&gt;</span>
<span class="w">   </span><span class="k">&lt;xsl:value-of</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;.&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="k">&lt;/xsl:template&gt;</span>

<span class="k">&lt;xsl:template</span><span class="w"> </span><span class="na">match=</span><span class="s">&quot;processing-instruction()|comment()&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</pre></div>
</div>
<p>Por tanto, si se pide aplicar con <a class="reference internal" href="#xsl-apply-templates"><span class="std std-ref">&lt;xsl:apply-templates&gt;</span></a> a una plantilla que no se ha
definido, se mostrará todo el texto que contenga y se aplicará recursivamente
la misma regla a los elementos que contenga.</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Obsérvese cómo la plantilla predeterminada para el nodo <code class="code docutils literal notranslate"><span class="pre">/</span></code> es
aplicar la plantilla de su único nodo hijo (en el ejemplo,
<code class="code docutils literal notranslate"><span class="pre">&lt;discoteca&gt;</span></code>). Por ello, en la práctica podemos considerar que la
primera plantilla que busca el procesador es la plantilla cuyo <em>match</em>
coincide con el nombre del elemento contenedor (o sea, <code class="code docutils literal notranslate"><span class="pre">&lt;discoteca&gt;</span></code>).</p>
</div>
<p class="rubric">Ejercicio intermedio</p>
<p>Tomando el <abbr title="eXtensible  Markup Language">XML</abbr> del <a class="reference internal" href="#xslt-ejemplo"><span class="std std-ref">ejemplo introductorio</span></a>, crear un único
<abbr title="eXtensible Stylesheet Language Transformations">XSLT</abbr> que devuelva la siguiente salida:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>LISTA DE DISCOS

1. clasica: Nueve sinfonías (Ludwing van Beethoven)
2. jazz: Kind of Blue (Miles Davis)
3. rock: Metalmorfosis (Barón Rojo)
4. rock: Más madera (Leño)
5. jazz: Ella and Louis (Ella Fitzgerald/Louis Armstrong)
6. clasica: El Mesías (G.F. Haendel)

LISTA ALTERNATIVA DE DISCOS

*  [Ludwing van Beethoven] -- Nueve sinfonías (clasica)
*  [Miles Davis] -- Kind of Blue (jazz)
*  [Barón Rojo] -- Metalmorfosis (rock)
*  [Leño] -- Más madera (rock)
*  [Ella Fitzgerald/Louis Armstrong] -- Ella and Louis (jazz)
*  [G.F. Haendel] -- El Mesías (clasica)
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>La primera lista está ordenada por tipo de música.</p>
</div>
</section>
</section>
<section id="variables">
<span id="xslt-variables"></span><h3>Variables<a class="headerlink" href="#variables" title="Enlace permanente a este encabezado">¶</a></h3>
<p>En <abbr title="eXtensible Stylesheet Language Transformations">XSLT</abbr> no existen variables, sino exclusivamente constantes que pueden ser:</p>
<ul id="xsl-variable">
<li><p>Definidas a través del elemento <code class="docutils literal notranslate"><span class="pre">&lt;xsl-variables&gt;</span></code> que puede incluirse dentro
de casi cualquier elemento (incluido <a class="reference internal" href="#xsl-stylesheet"><span class="std std-ref">&lt;xsl:stylesheet&gt;</span></a>) y cuya sintaxis es
equivalente a <a class="reference internal" href="#xsl-param"><span class="std std-ref">&lt;xsl:param&gt;</span></a>:</p>
<div class="highlight-dtd notranslate"><div class="highlight"><pre><span></span><span class="k">&lt;!ELEMENT</span> <span class="nt">xsl:variable</span> <span class="o">(</span><span class="nt">template</span><span class="o">)</span><span class="k">&gt;</span>
<span class="k">&lt;!ATTLIST</span> <span class="nt">xsl:variable</span> <span class="na">name</span>   <span class="kc">NMTOKEN</span>  <span class="kc">#REQUIRED</span>
                       <span class="na">select</span> <span class="kc">CDATA</span>    <span class="kc">#IMPLIED</span><span class="k">&gt;</span>
</pre></div>
</div>
<p>Por ejemplo, la condición de los <a class="reference internal" href="#xslt-ejemplo"><span class="std std-ref">ejemplos introductorios</span></a>:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;xsl:if</span><span class="w"> </span><span class="na">test=</span><span class="s">&quot;not(preceding-sibling::disco[@tipo = current()/@tipo])&quot;</span><span class="w"> </span><span class="nt">&gt;</span>
<span class="w">   </span><span class="cm">&lt;!-- Código si se cumple la condición --&gt;</span>
<span class="nt">&lt;/xsl:if&gt;</span>
</pre></div>
</div>
<p>podría haber escrito también así:</p>
<div class="highlight-xslt notranslate"><div class="highlight"><pre><span></span><span class="k">&lt;xsl:variable</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;tipo&quot;</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;@tipo&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="k">&lt;xsl:if</span><span class="w"> </span><span class="na">test=</span><span class="s">&quot;not(preceding-sibling::disco[@tipo = $tipo])&quot;</span><span class="w"> </span><span class="nt">&gt;</span>
<span class="w">   </span><span class="cm">&lt;!-- Código si se cumple la condición --&gt;</span>
<span class="k">&lt;/xsl:if&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Percátese que para usar la (no-)variable debe anteponerse un dolar
al nombre que se le asignó, tal como se hace en lenguajes como <a class="reference external" href="http://pubs.opengroup.org/onlinepubs/009696899/utilities/xcu_chap02.html">sh</a> o
<a class="reference external" href="https://www.perl.org/">Perl</a>.</p>
</div>
</li>
<li><p>Definidas como parámetro que se pasa a una plantilla a través de <a class="reference internal" href="#xsl-param"><span class="std std-ref">&lt;xsl:param&gt;</span></a> y
que se declaran dentro de la plantilla con <a class="reference internal" href="#xsl-with-param"><span class="std std-ref">&lt;xsl:with-param&gt;</span></a>. El uso posterior del
valor se hace exactamente igual que cuando se define la constante con
<a class="reference internal" href="#xsl-param"><span class="std std-ref">&lt;xsl:param&gt;</span></a>/<a class="reference internal" href="#xsl-with-param"><span class="std std-ref">&lt;xsl:with-param&gt;</span></a>: anteponiendo un dólar.</p>
<p>Cómo se usa <a class="reference internal" href="#xsl-param"><span class="std std-ref">&lt;xsl:param&gt;</span></a> (y su contraparte <a class="reference internal" href="#xsl-with-param"><span class="std std-ref">&lt;xsl:with-param&gt;</span></a>) ya está explicado bajo
un epígrafe anterior. Pero es necesario añadir que al usar el procesador
<abbr title="eXtensible Stylesheet Language Transformations">XSLT</abbr> se pueden pasar parámetros tal como se pasan al invocar una
plantilla; y que, así como en <a class="reference internal" href="#xsl-template"><span class="std std-ref">&lt;xsl:template&gt;</span></a> se declaran los
parámetros, es posible declarar con <a class="reference internal" href="#xsl-param"><span class="std std-ref">&lt;xsl:param&gt;</span></a> dentro de <a class="reference internal" href="#xsl-stylesheet"><span class="std std-ref">&lt;xsl:stylesheet&gt;</span></a> los
parámetros que pasan al procesamiento:</p>
<div class="highlight-xslt notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="k">&lt;xsl:stylesheet</span><span class="w"> </span><span class="na">version=</span><span class="s">&quot;1.0&quot;</span>
<span class="w">                </span><span class="na">xmlns:xsl=</span><span class="s">&quot;http://www.w3.org/1999/XSL/Transform&quot;</span><span class="nt">&gt;</span>

<span class="w">   </span><span class="k">&lt;xsl:param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;param1&quot;</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;&#39;xxxx&#39;&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>

<span class="w">   </span><span class="cm">&lt;!-- Resto de la hoja --&gt;</span>

<span class="k">&lt;/xsl:stylesheet&gt;</span>
</pre></div>
</div>
<p>lo cual permitiría pasar a la hoja un parámetro externo llamado <em>param1</em>. Con
<strong class="program">xmlstarlet</strong>, podríamos hacerlo así:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>xmlstarlet<span class="w"> </span>tr<span class="w"> </span>hoja.xsl<span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;param1=&#39;abcdef&#39;&quot;</span><span class="w"> </span>original.xml
</pre></div>
</div>
<p>que propiciaría que la constante <em>$param1</em> tuviera como valor la cadena
«abcdef». Tal como hemos hecho la definición, en caso de no pasar valor, su
valor predeterminado sería la cadena «xxxx».</p>
</li>
</ul>
</section>
<section id="generacion-de-la-salida">
<h3>Generación de la salida<a class="headerlink" href="#generacion-de-la-salida" title="Enlace permanente a este encabezado">¶</a></h3>
<p>El objeto de escribir una transformación <abbr title="eXtensible Stylesheet Language Transformations">XSLT</abbr> es generar un documento de salida:
en principio, un fichero de texto o un fichero <abbr title="eXtensible  Markup Language">XML</abbr> (o algo similar) como un
<abbr title="HyperText Markup Language">HTML</abbr>. Por tanto, el objetivo de las plantillas que creamos con <a class="reference internal" href="#xsl-template"><span class="std std-ref">&lt;xsl:template&gt;</span></a> es
transformar la información del <abbr title="eXtensible  Markup Language">XML</abbr> original, bien en texto, bien en nuevos
elementos <abbr title="eXtensible  Markup Language">XML</abbr>.</p>
<p id="xsl-text">El elemento más simple para esto es <code class="docutils literal notranslate"><span class="pre">&lt;xsl:text&gt;</span></code>:</p>
<div class="highlight-dtd notranslate"><div class="highlight"><pre><span></span><span class="k">&lt;!ELEMENT</span> <span class="nt">xsl:text</span> <span class="o">(</span><span class="kc">#PCDATA</span><span class="o">)</span><span class="k">&gt;</span>
<span class="k">&lt;!ATTLIST</span> <span class="nt">xsl:text</span> <span class="na">disable-output-escaping</span> <span class="o">(</span><span class="na">yes</span><span class="o">|</span><span class="na">no</span><span class="o">)</span>  <span class="s2">&quot;no&quot;</span><span class="k">&gt;</span>
</pre></div>
</div>
<p>cuyo uso puede conbsultarse en los <a class="reference internal" href="#xslt-ejemplo"><span class="std std-ref">ejemplos introductorios</span></a>. Otro modo de volcar en la salida texto es el elemento
<code class="docutils literal notranslate"><span class="pre">&lt;xsl:value-of&gt;</span></code>:</p>
<div class="highlight-dtd notranslate" id="xsl-value-of"><div class="highlight"><pre><span></span><span class="k">&lt;!ELEMENT</span> <span class="nt">xsl:value-of</span> <span class="kc">EMPTY</span><span class="k">&gt;</span>
<span class="k">&lt;!ATTLIST</span> <span class="nt">xsl:value-of</span> <span class="na">select</span>                 <span class="kc">CDATA</span>     <span class="kc">#REQUIRED</span>
                       <span class="na">disble-output-escaping</span> <span class="o">(</span><span class="na">yes</span><span class="o">|</span><span class="na">no</span><span class="o">)</span>  <span class="s2">&quot;no&quot;</span><span class="k">&gt;</span>
</pre></div>
</div>
<p>El valor se expresa con el atributo <code class="docutils literal notranslate"><span class="pre">select</span></code> dentro del cual se podrá usar
<a class="reference internal" href="#xslt-expresiones"><span class="std std-ref">una cadena o una expresión XPath</span></a>. Por lo general,
cuando se pretende volcar un texto literal, se usa <a class="reference internal" href="#xsl-text"><span class="std std-ref">&lt;xsl:text&gt;</span></a>; y, cuando se pretende
volcar un valor obtenido a partir de una expresión <em>Xpath</em>, se usa <a class="reference internal" href="#xsl-value-of"><span class="std std-ref">&lt;xsl:value-of&gt;</span></a>.</p>
<p>Cuando la salida es un documento <abbr title="eXtensible  Markup Language">XML</abbr>, entonces es necesario
generar elementos. Una forma de hacerlo es incluirlos de forma explícita en el
<abbr title="eXtensible Stylesheet Language Transformations">XSLT</abbr> tal como se hace en la plantilla para «/» del segundo ejemplo:</p>
<div class="highlight-xslt notranslate"><div class="highlight"><pre><span></span><span class="k">&lt;xsl:template</span><span class="w"> </span><span class="na">match=</span><span class="s">&quot;/&quot;</span><span class="nt">&gt;</span>
<span class="w">   </span><span class="nt">&lt;html&gt;</span>
<span class="w">      </span><span class="nt">&lt;head&gt;</span>
<span class="w">         </span><span class="nt">&lt;title&gt;</span>Discos<span class="w"> </span>de<span class="w"> </span>mi<span class="w"> </span>fonoteca<span class="nt">&lt;/title&gt;</span>
<span class="w">      </span><span class="nt">&lt;/head&gt;</span>
<span class="w">      </span><span class="nt">&lt;body&gt;</span>
<span class="w">         </span><span class="nt">&lt;table&gt;</span>
<span class="w">            </span><span class="nt">&lt;caption&gt;</span>Discos<span class="nt">&lt;/caption&gt;</span>
<span class="w">            </span><span class="nt">&lt;tr&gt;&lt;th&gt;</span>Tipo<span class="nt">&lt;/th&gt;&lt;th&gt;</span>Nombre<span class="nt">&lt;/th&gt;&lt;th&gt;</span>Autor<span class="nt">&lt;/th&gt;&lt;/tr&gt;</span>
<span class="w">            </span><span class="k">&lt;xsl:apply-templates</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;discoteca/disco&quot;</span><span class="nt">&gt;</span>
<span class="w">               </span><span class="k">&lt;xsl:sort</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;@tipo&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="k">&lt;/xsl:apply-templates&gt;</span>
<span class="w">         </span><span class="nt">&lt;/table&gt;</span>
<span class="w">      </span><span class="nt">&lt;/body&gt;</span>
<span class="w">   </span><span class="nt">&lt;/html&gt;</span>
<span class="k">&lt;/xsl:template&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Esta es, precisamente, la razón por la que suelen incluirse los
elementos propios de <abbr title="eXtensible Stylesheet Language Transformations">XSLT</abbr> en un espacio de nombres aparte (<em>xsl</em>).</p>
</div>
<p id="xsl-element">Sin embargo, los elementos también pueden generarse mediante <code class="docutils literal notranslate"><span class="pre">&lt;xsl:element&gt;</span></code>:</p>
<div class="highlight-dtd notranslate"><div class="highlight"><pre><span></span><span class="k">&lt;!ELEMENT</span> <span class="nt">xsl:element</span> <span class="o">(</span><span class="nt">template</span><span class="o">)</span><span class="k">&gt;</span>
<span class="k">&lt;!ATTLIST</span> <span class="nt">xsl:element</span> <span class="na">name</span>               <span class="kc">NMTOKEN</span>  <span class="kc">#REQUIRED</span>
                      <span class="na">namespace</span>          <span class="kc">NMTOKEN</span>  <span class="kc">#IMPLIED</span>
                      <span class="na">use-attribute-sets</span> <span class="kc">NMTOKENS</span> <span class="kc">#IMPLIED</span><span class="k">&gt;</span>
</pre></div>
</div>
<p>El atributo <code class="docutils literal notranslate"><span class="pre">nombre</span></code> sirve para indicar el nombre del elemento; mientras que
<code class="docutils literal notranslate"><span class="pre">use-attribute-sets</span></code> permite añadir al elemento varios atributos en conjunción con
el elemento <a class="reference internal" href="#xsl-attribute-set"><span class="std std-ref">&lt;xsl:attribute-set&gt;</span></a>, que se verá a continuación.</p>
<p id="xsl-attribute">Para añadir atributos al elemento puede usarse el elemento <code class="docutils literal notranslate"><span class="pre">&lt;xsl:attribute&gt;</span></code>:</p>
<div class="highlight-dtd notranslate"><div class="highlight"><pre><span></span><span class="k">&lt;!ELEMENT</span> <span class="nt">xsl:attribute</span> <span class="o">(</span><span class="nt">template</span><span class="o">)</span><span class="k">&gt;</span>
<span class="k">&lt;!ATTLIST</span> <span class="nt">xsl:attribute</span> <span class="na">name</span>               <span class="kc">NMTOKEN</span>  <span class="kc">#REQUIRED</span>
                        <span class="na">namespace</span>          <span class="kc">NMTOKEN</span>  <span class="kc">#IMPLIED</span><span class="k">&gt;</span>
</pre></div>
</div>
<p>Un ejemplo de lo expuesto son las líneas 30-35 del segundo <a class="reference internal" href="#xslt-ejemplo"><span class="std std-ref">ejemplo
introductorio</span></a>:</p>
<div class="highlight-xslt notranslate"><div class="highlight"><pre><span></span><span class="k">&lt;xsl:element</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;td&quot;</span><span class="nt">&gt;</span>
<span class="w">   </span><span class="k">&lt;xsl:attribute</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;rowspan&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:value-of</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;count(/discoteca/disco[@tipo=current()/@tipo])&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">   </span><span class="k">&lt;/xsl:attribute&gt;</span>
<span class="w">   </span><span class="k">&lt;xsl:value-of</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;@tipo&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="k">&lt;/xsl:element&gt;</span>
</pre></div>
</div>
<p>Nótese que se genera el elemento de salida <code class="docutils literal notranslate"><span class="pre">&lt;td&gt;</span></code> (una celda) a la que se
quiere añadir el atributo <code class="docutils literal notranslate"><span class="pre">rowspan</span></code>. El contenido de <a class="reference internal" href="#xsl-attribute"><span class="std std-ref">&lt;xsl:attribute&gt;</span></a>, será el
valor que adopte dicho atributo, y el resto de contenido de <a class="reference internal" href="#xsl-element"><span class="std std-ref">&lt;xsl:element&gt;</span></a> el
contenido de la celda. Alternativamente, lo anterior puede escribirse del
siguiente modo:</p>
<div class="highlight-xslt notranslate" id="xslt-notacion-parent"><div class="highlight"><pre><span></span><span class="nt">&lt;td</span><span class="w"> </span><span class="na">rowspan=</span><span class="s">&quot;{count(/discoteca/disco[@tipo=current()/@tipo])}&quot;</span><span class="nt">&gt;</span>
<span class="w">   </span><span class="k">&lt;xsl:value-of</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;@tipo&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;/td&gt;</span>
</pre></div>
</div>
<p>La <em class="dfn">notación de llaves</em> indica al procesador que evalúe la expresión
<em>XPath</em> y escriba el resultado, y no que escriba la expresión literalmente.</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Esta notación puede resultarnos útil no sólo cuando generamos una
salida <abbr title="eXtensible  Markup Language">XML</abbr>. Por ejemplo, en <a class="reference internal" href="#xslt-ejerc-inter2"><span class="std std-ref">un ejercicio intermedio anterior</span></a> la podríamoa haber usado de este modo:</p>
<div class="highlight-xslt notranslate"><div class="highlight"><pre><span></span><span class="k">&lt;xsl:variable</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;formato&quot;</span><span class="nt">&gt;</span>
<span class="w">   </span><span class="k">&lt;xsl:choose</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:when</span><span class="w"> </span><span class="na">test=</span><span class="s">&quot;@tipo = &#39;clasica&#39;&quot;</span><span class="nt">&gt;</span>
<span class="w">         </span>xsl:text&gt;i.<span class="w"> </span><span class="k">&lt;/xsl:text&gt;</span>
<span class="w">      </span><span class="k">&lt;/xsl:when&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:otherwise</span><span class="nt">&gt;</span>
<span class="w">         </span><span class="k">&lt;xsl:text</span><span class="nt">&gt;</span>1.<span class="w"> </span><span class="k">&lt;/xsl:text&gt;</span>
<span class="w">      </span><span class="k">&lt;/xsl:otherwise&gt;</span>
<span class="w">   </span><span class="k">&lt;/xsl:choose&gt;</span>
<span class="k">&lt;/xsl:variable&gt;</span>
<span class="k">&lt;xsl:number</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;position()&quot;</span><span class="w"> </span><span class="na">format=</span><span class="s">&quot;{$formato}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</pre></div>
</div>
</div>
<p id="xsl-attribute-set">Quedó pendiente la explicación del atributo <code class="docutils literal notranslate"><span class="pre">use-attribute-sets</span></code> de <a class="reference internal" href="#xsl-element"><span class="std std-ref">&lt;xsl:element&gt;</span></a>.
Dentro de este atributo, se pueden incluir nombres de conjuntos de atributos que
se definieran con <a class="reference internal" href="#xsl-attribute-set"><span class="std std-ref">&lt;xsl:attribute-set&gt;</span></a>. Puede tener utilidad en algunos casos. En
<a class="reference external" href="https://msdn.microsoft.com/en-us/library/ms256104%28v=vs.110%29.aspx">este enlace</a> se da
cuenta de cómo se usa.</p>
<p id="xsl-comment">Al generar como salida un <abbr title="eXtensible  Markup Language">XML</abbr> también es posible que queramos generar un
comentario, para lo cual existe el elemento <code class="docutils literal notranslate"><span class="pre">&lt;xsl:comment&gt;</span></code>:</p>
<div class="highlight-dtd notranslate"><div class="highlight"><pre><span></span><span class="k">&lt;!ELEMENT</span> <span class="nt">xsl:comment</span> <span class="o">(</span><span class="nt">template</span><span class="o">)</span><span class="k">&gt;</span>
</pre></div>
</div>
<p>El contenido de este elemento sirve para generar el contenido del comentario.
Por ejemplo, entre las líneas 14 y 15 del segundo ejemplo podríamos haber
escrito lo siguiente:</p>
<div class="highlight-xslt notranslate"><div class="highlight"><pre><span></span><span class="k">&lt;xsl:comment</span><span class="nt">&gt;</span><span class="w"> </span>Tabla<span class="w"> </span>generada<span class="w"> </span>a<span class="w"> </span>partir<span class="w"> </span>de<span class="w"> </span>discos.xml<span class="w"> </span><span class="k">&lt;/xsl:comment&gt;</span>
</pre></div>
</div>
<p id="xsl-processing-instruction">También es posible incluir instrucciones de procesamiento con
<code class="docutils literal notranslate"><span class="pre">&lt;xsl:processing-instruction&gt;</span></code>:</p>
<div class="highlight-dtd notranslate"><div class="highlight"><pre><span></span><span class="k">&lt;!ELEMENT</span> <span class="nt">xsl:processing-instruction</span> <span class="o">(</span><span class="nt">template</span><span class="o">)</span><span class="k">&gt;</span>
<span class="k">&lt;!ATTLIST</span> <span class="nt">xsl:processing-instruction</span> <span class="na">name</span> <span class="kc">NMTOKEN</span> <span class="kc">#REQUIRED</span><span class="k">&gt;</span>
</pre></div>
</div>
<p>Un ejemplo de su uso puede ser el siguiente:</p>
<div class="highlight-xslt notranslate"><div class="highlight"><pre><span></span><span class="k">&lt;xsl:processing-instruction</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;xml-stysheet&quot;</span><span class="nt">&gt;</span>href=&quot;discos.css&quot;<span class="w"> </span>type=&quot;text/css&quot;<span class="k">&lt;/xsl:processing-instruction&gt;</span>
</pre></div>
</div>
<p id="xsl-number">En ocasiones, es útil incluir números, formateados de algún modo determinado,
dentro de la salida. Para ello existe el elemento <code class="docutils literal notranslate"><span class="pre">&lt;xsl:number&gt;</span></code>:</p>
<div class="highlight-dtd notranslate"><div class="highlight"><pre><span></span><span class="k">&lt;!ELEMENT</span> <span class="nt">xsl:number</span> <span class="kc">EMPTY</span><span class="k">&gt;</span>
<span class="k">&lt;!ATTLIST</span> <span class="nt">xsl:number</span> <span class="na">count</span>              <span class="kc">CDATA</span>   <span class="kc">#IMPLIED</span>
                     <span class="na">from</span>               <span class="kc">CDATA</span>   <span class="kc">#IMPLIED</span>
                     <span class="na">value</span>              <span class="kc">CDATA</span>   <span class="kc">#IMPLIED</span>
                     <span class="na">format</span>             <span class="kc">CDATA</span>   <span class="s2">&quot;1&quot;</span>
                     <span class="na">lang</span>               <span class="kc">NMTOKEN</span> <span class="kc">#IMPLIED</span>
                     <span class="na">grouping-separator</span> <span class="kc">NMTOKEN</span> <span class="s2">&quot;,&quot;</span>
                     <span class="na">grouping-size</span>      <span class="kc">NMTOKEN</span> <span class="s2">&quot;3&quot;</span><span class="k">&gt;</span>
</pre></div>
</div>
<p><a class="reference internal" href="#xsl-number"><span class="std std-ref">&lt;xsl:number&gt;</span></a> actúa de dos formas:</p>
<ul class="simple">
<li><p>si se le proporciona el atributo <code class="docutils literal notranslate"><span class="pre">value</span></code> se evalúa la expresión que se use
como valor (la cual obviamente debe devolver un número).</p></li>
<li><p>si no se le proporciona, entonces obtiene el número basándose en la posición
del nodo de procesamiento.</p></li>
</ul>
<p>En principio, lo que hace es contar el número de nodos del mismo tipo al del
nodo de procesamiento, que hay encima de este (incluyendo éste). Ahora bien,
este comportamiento puede alterarse con los atributos <code class="docutils literal notranslate"><span class="pre">count</span></code> y <code class="docutils literal notranslate"><span class="pre">from</span></code>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">count</span></code> selecciona los nodos que quieren contarse mediante el uso de una
expresión <em>XPath</em>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">from</span></code> selecciona con una expresión <em>XPath</em> el nodo desde el que se desea
contar, en vez de hacerlo desde el primero que selecciona <code class="docutils literal notranslate"><span class="pre">count</span></code>.</p></li>
</ul>
<p>El resto de atributos permite formatear el número. <code class="docutils literal notranslate"><span class="pre">format</span></code> permite indicar
cómo se querrá qe aparezcan esos números:</p>
<ul class="simple">
<li><p>«1» para una numeración normal: 1, 2, 3, 4, etc.</p></li>
<li><p>«01» para una numeración con igual número de cifras.</p></li>
<li><p>«a» para numerar con letras minúsculas del alfabeto.</p></li>
<li><p>«A» para numerar con letras mayúsuculas del alfabeto.</p></li>
<li><p>«i» para números romanos en minúsculas.</p></li>
<li><p>«I» para números romanos en mayúsculas.</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<p>Los atributos <code class="docutils literal notranslate"><span class="pre">count</span></code> y <code class="docutils literal notranslate"><span class="pre">from</span></code> de <a class="reference internal" href="#xsl-number"><span class="std std-ref">&lt;xsl:number&gt;</span></a> no permiten
expresiones <em>XPath</em> relativas al nodo de procesamiento, sino que se comporta
exactamente igual que el atributo <code class="docutils literal notranslate"><span class="pre">match</span></code> de <a class="reference internal" href="#xsl-template"><span class="std std-ref">&lt;xsl:template&gt;</span></a>. En consecuencia,
tampoco tiene sentido usar dentro él la función <a class="reference internal" href="#xsl-func-current"><span class="std std-ref">current()</span></a>. En la
especificación este tipo de atributos se notan como de tipo <em>pattern</em>.</p>
</div>
<p>Además se pueden indicar formatos como «(1)» si se quiere el número abrazado por
paréntesis. Por último, <code class="docutils literal notranslate"><span class="pre">grouping-separator</span></code> y <code class="docutils literal notranslate"><span class="pre">grouping-size</span></code> sirven para
separar las cifras. Podemos usar este elemento para mejorar el listado del
<a class="reference internal" href="#xslt-ejemplo"><span class="std std-ref">primer ejemplo</span></a>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>LISTA DE DISCOS

+ clasica
   1. Nueve sinfonías (Ludwing van Beethoven)
   2. El Mesías (G.F. Haendel)

+ jazz
   1. Kind of Blue (Miles Davis)
   2. Ella and Louis (Ella Fitzgerald/Louis Armstrong)

+ rock
   1. Metalmorfosis (Barón Rojo)
   2. Más madera (Leño)
</pre></div>
</div>
<p>Que se obtiene con este otro <abbr title="eXtensible Stylesheet Language Transformations">XSLT</abbr> en el que aprovechamos el <abbr title="eXtensible Stylesheet Language Transformations">XSLT</abbr> ya escrito
mediante el uso de <a class="reference internal" href="#xsl-import"><span class="std std-ref">&lt;xsl:import&gt;</span></a>:</p>
<div class="highlight-xslt notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="k">&lt;xsl:stylesheet</span><span class="w"> </span><span class="na">version=</span><span class="s">&quot;1.0&quot;</span>
<span class="w">                </span><span class="na">xmlns:xsl=</span><span class="s">&quot;http://www.w3.org/1999/XSL/Transform&quot;</span><span class="nt">&gt;</span>
<span class="w"> </span>
<span class="w">   </span><span class="k">&lt;xsl:import</span><span class="w"> </span><span class="na">href=</span><span class="s">&quot;discos.txt.xsl&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w"> </span>
<span class="w">   </span><span class="k">&lt;xsl:template</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;disco&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:variable</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;tipo&quot;</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;@tipo&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:number</span><span class="w"> </span><span class="na">count=</span><span class="s">&quot;//disco[@tipo = $tipo]&quot;</span><span class="w"> </span><span class="na">format=</span><span class="s">&quot;   1. &quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:value-of</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;nombre&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:text</span><span class="nt">&gt;</span><span class="w"> </span>(<span class="k">&lt;/xsl:text&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:value-of</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;autor&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:text</span><span class="nt">&gt;</span>)<span class="ni">&amp;#10;</span><span class="k">&lt;/xsl:text&gt;</span>
<span class="w">   </span><span class="k">&lt;/xsl:template&gt;</span>

<span class="k">&lt;/xsl:stylesheet&gt;</span>
</pre></div>
</div>
<p id="xsl-copy-of"><span id="xsl-copy"></span>Hay, por último, otro modo de generar contenido de salida: con los elementos
<code class="docutils literal notranslate"><span class="pre">&lt;xsl:copy&gt;</span> <span class="pre">y</span> <span class="pre">``&lt;xsl:copy-of&gt;</span></code>:</p>
<div class="highlight-dtd notranslate"><div class="highlight"><pre><span></span><span class="k">&lt;!ELEMENT</span> <span class="nt">xsl:copy-of</span> <span class="kc">EMPTY</span><span class="k">&gt;</span>
<span class="k">&lt;!ATTLIST</span> <span class="nt">xsl:copy-of</span> <span class="na">select</span> <span class="kc">CDATA</span>  <span class="kc">#REQUIRED</span><span class="k">&gt;</span>

<span class="k">&lt;!ELEMENT</span> <span class="nt">xsl:copy</span> <span class="o">(</span><span class="nt">template</span><span class="o">)</span><span class="k">&gt;</span>
<span class="k">&lt;!ATTLIST</span> <span class="nt">xsl:copy</span> <span class="na">use-attribute-sets</span> <span class="kc">NMTOKENS</span>  <span class="kc">#IMPLIED</span><span class="k">&gt;</span>
</pre></div>
</div>
<p>Estos elementos permiten hacer la copia de un elemento del <abbr title="eXtensible  Markup Language">XML</abbr> original. La
diferencia entre ellos es que <a class="reference internal" href="#xsl-copy"><span class="std std-ref">&lt;xsl:copy&gt;</span></a> hace la copia sin copiar atributos y
nodos hijos, mietras que <a class="reference internal" href="#xsl-copy-of"><span class="std std-ref">&lt;xsl:copy-of&gt;</span></a> sí los incluye.</p>
<p>Por ejemplo, una estúpida hoja de estilos que transforma nuestro <abbr title="eXtensible  Markup Language">XML</abbr> original
<code class="file docutils literal notranslate"><span class="pre">discos.xml</span></code> en otro documento idéntico es la siguiente:</p>
<div class="highlight-xslt notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="k">&lt;xsl:stylesheet</span><span class="w"> </span><span class="na">version=</span><span class="s">&quot;1.0&quot;</span>
<span class="w">                </span><span class="na">xmlns:xsl=</span><span class="s">&quot;http://www.w3.org/1999/XSL/Transform&quot;</span><span class="nt">&gt;</span>

<span class="w">   </span><span class="k">&lt;xsl:output</span><span class="w"> </span><span class="na">method=</span><span class="s">&quot;xml&quot;</span><span class="w"> </span><span class="na">encoding=</span><span class="s">&quot;utf-8&quot;</span><span class="w"> </span><span class="na">indent=</span><span class="s">&quot;yes&quot;</span><span class="nt">/&gt;</span>

<span class="w">   </span><span class="k">&lt;xsl:template</span><span class="w"> </span><span class="na">match=</span><span class="s">&quot;/&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:copy-of</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;.&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">   </span><span class="k">&lt;/xsl:template&gt;</span>

<span class="k">&lt;/xsl:stylesheet&gt;</span>
</pre></div>
</div>
<p>Sin embargo, cobra utilidad cuando lo que pretendemos es alterar parte del
documento como aquí:</p>
<div class="highlight-xslt notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="k">&lt;xsl:stylesheet</span><span class="w"> </span><span class="na">version=</span><span class="s">&quot;1.0&quot;</span>
<span class="w">                </span><span class="na">xmlns:xsl=</span><span class="s">&quot;http://www.w3.org/1999/XSL/Transform&quot;</span><span class="nt">&gt;</span>

<span class="w">   </span><span class="k">&lt;xsl:output</span><span class="w"> </span><span class="na">method=</span><span class="s">&quot;xml&quot;</span><span class="w"> </span><span class="na">encoding=</span><span class="s">&quot;utf-8&quot;</span><span class="w"> </span><span class="na">indent=</span><span class="s">&quot;yes&quot;</span><span class="nt">/&gt;</span>

<span class="w">   </span><span class="k">&lt;xsl:template</span><span class="w"> </span><span class="na">match=</span><span class="s">&quot;*&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:copy</span><span class="nt">&gt;</span>
<span class="w">         </span><span class="k">&lt;xsl:apply-templates</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;@*|nodes()&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="k">&lt;/xsl:copy&gt;</span>
<span class="w">   </span><span class="k">&lt;/xsl:template&gt;</span>

<span class="w">   </span><span class="k">&lt;xsl:template</span><span class="w"> </span><span class="na">match=</span><span class="s">&quot;@*|text()|comment()|processing-instruction()&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:copy-of</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;.&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">   </span><span class="k">&lt;/xsl:template&gt;</span>

<span class="w">   </span><span class="k">&lt;xsl:template</span><span class="w"> </span><span class="na">match=</span><span class="s">&quot;disco[@tipo=&#39;jazz&#39;]&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>

<span class="k">&lt;/xsl:stylesheet&gt;</span>
</pre></div>
</div>
<p>En esta traducción, la plantilla para los nodos elemento (plantilla «*») copia
el elemento y aplica la plantilla correspondiente a todos los comentarios y
todos sus nodos hijo. La plantilla para los nodos no-elemento (o sea, atributos,
nodos de texto, comentarios e instrucciones de procesamiento) consiste en hacer
una copia exacta del nodo. O sea, que, en principio, hacemos una copia exacta
del <abbr title="eXtensible  Markup Language">XML</abbr> original. Sin embargo, defimos una plantilla específica para los
discos de jazz que consiste en… no traducir nada. La consecuencia es que en la
salida obtendremos un <abbr title="eXtensible  Markup Language">XML</abbr> como el original, pero sin los discos de <em>jazz</em>.</p>
</section>
<section id="sentencias-condicionales">
<h3>Sentencias condicionales<a class="headerlink" href="#sentencias-condicionales" title="Enlace permanente a este encabezado">¶</a></h3>
<p>En <abbr title="eXtensible Stylesheet Language Transformations">XSLT</abbr> hay dos elementos que permiten crear sentencias condicionales
<code class="docutils literal notranslate"><span class="pre">&lt;xsl:if&gt;</span></code> y <code class="docutils literal notranslate"><span class="pre">&lt;xsl:choose&gt;</span></code>. El primero es una suerte de sentencia <em>if</em>,
pero sin posibilidad de incluir un <em>else</em>, mientras que el segundo hace las
veces de cláusula <em>switch</em>.</p>
<section id="elemento-xsl-if">
<span id="xsl-if"></span><h4>Elemento <code class="docutils literal notranslate"><span class="pre">&lt;xsl:if&gt;</span></code><a class="headerlink" href="#elemento-xsl-if" title="Enlace permanente a este encabezado">¶</a></h4>
<p>Permite generar una determinada salida si se cumple una condición:</p>
<div class="highlight-dtd notranslate"><div class="highlight"><pre><span></span><span class="k">&lt;!ELEMENT</span> <span class="nt">xsl:if</span> <span class="o">(</span><span class="nt">template</span><span class="o">)</span><span class="k">&gt;</span>
<span class="k">&lt;!ATTLIST</span> <span class="nt">xsl:if</span> <span class="na">test</span> <span class="kc">CDATA</span>  <span class="kc">#REQUIRED</span><span class="k">&gt;</span>
</pre></div>
</div>
<p>El atributo <code class="docutils literal notranslate"><span class="pre">test</span></code> sirve para indicar esta condición. Los <a class="reference internal" href="#xslt-ejemplo"><span class="std std-ref">ejemplos
expositorios</span></a> tiene una muestra del uso de este elemento:</p>
<div class="highlight-xslt notranslate"><div class="highlight"><pre><span></span><span class="k">&lt;xsl:if</span><span class="w"> </span><span class="na">test=</span><span class="s">&quot;not(preceding-sibling::disco[@tipo = current()/@tipo])&quot;</span><span class="nt">&gt;</span>
<span class="w">   </span><span class="k">&lt;xsl:call-template</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;tipo&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="k">&lt;/xsl:if&gt;</span>
</pre></div>
</div>
<p>La condición en román paladino es: <em>si el disco que se está procesando, es el
primer disco de su tipo</em>.</p>
</section>
<section id="elemento-xsl-choose">
<span id="xsl-choose"></span><h4>Elemento <code class="docutils literal notranslate"><span class="pre">&lt;xsl:choose&gt;</span></code><a class="headerlink" href="#elemento-xsl-choose" title="Enlace permanente a este encabezado">¶</a></h4>
<p>Este elemento permite generar distintas salidas dependiendo de la evaluación de
distintas expresiones. Se ha dicho que equivale a una cláusula <em>switch</em>, pero más
bien equivale a una serie de <em>if</em>: <code class="code docutils literal notranslate"><span class="pre">if...</span> <span class="pre">elif...</span> <span class="pre">elif...</span> <span class="pre">else</span> <span class="pre">...</span> <span class="pre">fi</span></code>:</p>
<div class="highlight-dtd notranslate"><div class="highlight"><pre><span></span><span class="k">&lt;!ELEMENT</span> <span class="nt">xsl:choose</span> <span class="o">(</span><span class="nt">xsl:when</span><span class="o">+,</span><span class="nt">xsl:otherwise</span><span class="o">?)</span><span class="k">&gt;</span>

<span class="k">&lt;!ELEMENT</span> <span class="nt">xsl:when</span> <span class="o">(</span><span class="nt">template</span><span class="o">)</span><span class="k">&gt;</span>
<span class="k">&lt;!ATTLIST</span> <span class="nt">xsl:when</span> <span class="na">test</span> <span class="kc">CDATA</span>  <span class="kc">#REQUIRED</span><span class="k">&gt;</span>

<span class="k">&lt;!ELEMENT</span> <span class="nt">xsl:otherwise</span> <span class="o">(</span><span class="nt">template</span><span class="o">)</span><span class="k">&gt;</span>
</pre></div>
</div>
<p>De nuevo, <code class="docutils literal notranslate"><span class="pre">test</span></code> permite indicar la condición. En el caso de
<code class="docutils literal notranslate"><span class="pre">&lt;xsl:otherwise&gt;</span></code>, no hay ninguna, porque se entra en este elemento cuando el
resto de expresiones han sido falsas. Para ilustrar supongamos que queremos
generar esta salida:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>LISTA DE DISCOS

+ clasica (para muy tradicionales)
   - Nueve sinfonías (Ludwing van Beethoven)
   - El Mesías (G.F. Haendel)

+ jazz (para tradicionales)
   - Kind of Blue (Miles Davis)
   - Ella and Louis (Ella Fitzgerald/Louis Armstrong)

+ rock (para modernillos)
   - Metalmorfosis (Barón Rojo)
   - Más madera (Leño)
</pre></div>
</div>
<p>Es decir, añadir una frase al lado del tipo de música. Para ello podríamos hacer
la siguiente transformación:</p>
<div class="highlight-xslt notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="k">&lt;xsl:stylesheet</span><span class="w"> </span><span class="na">version=</span><span class="s">&quot;1.0&quot;</span>
<span class="w">                </span><span class="na">xmlns:xsl=</span><span class="s">&quot;http://www.w3.org/1999/XSL/Transform&quot;</span><span class="nt">&gt;</span>
<span class="w"> </span>
<span class="w">   </span><span class="k">&lt;xsl:import</span><span class="w"> </span><span class="na">href=</span><span class="s">&quot;discos.txt.xsl&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w"> </span>
<span class="w">   </span><span class="k">&lt;xsl:template</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;tipo&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:text</span><span class="nt">&gt;</span><span class="ni">&amp;#10;</span><span class="k">&lt;/xsl:text&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:text</span><span class="nt">&gt;</span>+<span class="w"> </span><span class="k">&lt;/xsl:text&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:value-of</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;@tipo&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:text</span><span class="nt">&gt;</span><span class="w"> </span><span class="k">&lt;/xsl:text&gt;</span>
<span class="hll"><span class="w">      </span><span class="k">&lt;xsl:choose</span><span class="nt">&gt;</span>
</span><span class="hll"><span class="w">         </span><span class="k">&lt;xsl:when</span><span class="w"> </span><span class="na">test=</span><span class="s">&quot;@tipo = &#39;clasica&#39;&quot;</span><span class="nt">&gt;</span>
</span><span class="hll"><span class="w">            </span><span class="k">&lt;xsl:text</span><span class="nt">&gt;</span>(para<span class="w"> </span>muy<span class="w"> </span>tradicionales)<span class="k">&lt;/xsl:text&gt;</span>
</span><span class="hll"><span class="w">         </span><span class="k">&lt;/xsl:when&gt;</span>
</span><span class="hll"><span class="w">         </span><span class="k">&lt;xsl:when</span><span class="w"> </span><span class="na">test=</span><span class="s">&quot;@tipo = &#39;jazz&#39;&quot;</span><span class="nt">&gt;</span>
</span><span class="hll"><span class="w">            </span><span class="k">&lt;xsl:text</span><span class="nt">&gt;</span>(para<span class="w"> </span>tradicionales)<span class="k">&lt;/xsl:text&gt;</span>
</span><span class="hll"><span class="w">         </span><span class="k">&lt;/xsl:when&gt;</span>
</span><span class="hll"><span class="w">         </span><span class="k">&lt;xsl:when</span><span class="w"> </span><span class="na">test=</span><span class="s">&quot;@tipo = &#39;rock&#39;&quot;</span><span class="nt">&gt;</span>
</span><span class="hll"><span class="w">            </span><span class="k">&lt;xsl:text</span><span class="nt">&gt;</span>(para<span class="w"> </span>modernillos)<span class="k">&lt;/xsl:text&gt;</span>
</span><span class="hll"><span class="w">         </span><span class="k">&lt;/xsl:when&gt;</span>
</span><span class="hll"><span class="w">         </span><span class="k">&lt;xsl:otherwise</span><span class="nt">&gt;</span>
</span><span class="hll"><span class="w">            </span><span class="k">&lt;xsl:text</span><span class="nt">&gt;</span>(para<span class="w"> </span>vaya<span class="w"> </span>usted<span class="w"> </span>a<span class="w"> </span>saber<span class="w"> </span>quién)<span class="k">&lt;/xsl:text&gt;</span>
</span><span class="hll"><span class="w">         </span><span class="k">&lt;/xsl:otherwise&gt;</span>
</span><span class="hll"><span class="w">      </span><span class="k">&lt;/xsl:choose&gt;</span>
</span><span class="w">      </span><span class="k">&lt;xsl:text</span><span class="nt">&gt;</span><span class="ni">&amp;#10;</span><span class="k">&lt;/xsl:text&gt;</span>
<span class="w">   </span><span class="k">&lt;/xsl:template&gt;</span>
<span class="w"> </span>
<span class="k">&lt;/xsl:stylesheet&gt;</span>
</pre></div>
</div>
<p class="rubric" id="xslt-ejerc-inter2">Ejercicio intermedio</p>
<p>Obtener el siguiente listado:</p>
<div class="highlight-xslt notranslate"><div class="highlight"><pre><span></span>LISTA<span class="w"> </span>ALTERNATIVA<span class="w"> </span>DE<span class="w"> </span>DISCOS

i)<span class="w">  </span>[Ludwing<span class="w"> </span>van<span class="w"> </span>Beethoven]<span class="w"> </span>--<span class="w"> </span>Nueve<span class="w"> </span>sinfonías<span class="w"> </span>(clasica)
2)<span class="w">  </span>[Miles<span class="w"> </span>Davis]<span class="w"> </span>--<span class="w"> </span>Kind<span class="w"> </span>of<span class="w"> </span>Blue<span class="w"> </span>(jazz)
3)<span class="w">  </span>[Barón<span class="w"> </span>Rojo]<span class="w"> </span>--<span class="w"> </span>Metalmorfosis<span class="w"> </span>(rock)
4)<span class="w">  </span>[Leño]<span class="w"> </span>--<span class="w"> </span>Más<span class="w"> </span>madera<span class="w"> </span>(rock)
5)<span class="w">  </span>[Ella<span class="w"> </span>Fitzgerald/Louis<span class="w"> </span>Armstrong]<span class="w"> </span>--<span class="w"> </span>Ella<span class="w"> </span>and<span class="w"> </span>Louis<span class="w"> </span>(jazz)
vi)<span class="w">  </span>[G.F.<span class="w"> </span>Haendel]<span class="w"> </span>--<span class="w"> </span>El<span class="w"> </span>Mesías<span class="w"> </span>(clasica)
</pre></div>
</div>
<p>en que los discos de música clásica se han numerado con números romanos.</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Si lo resuelve definiendo una variable para almacenar el formato,
tendrá que usar la <a class="reference internal" href="#xslt-notacion-parent"><span class="std std-ref">notación de llaves</span></a>.</p>
</div>
</section>
</section>
<section id="bucles">
<span id="xsl-for-each"></span><h3>Bucles<a class="headerlink" href="#bucles" title="Enlace permanente a este encabezado">¶</a></h3>
<p><abbr title="eXtensible Stylesheet Language Transformations">XSLT</abbr> implementa un tipo de bucle, <code class="docutils literal notranslate"><span class="pre">&lt;xsl:for-each&gt;</span></code><a class="footnote-reference brackets" href="#id15" id="id6" role="doc-noteref"><span class="fn-bracket">[</span>5<span class="fn-bracket">]</span></a>, que nos permite recorrer
una serie de elementos del <abbr title="eXtensible  Markup Language">XML</abbr> original:</p>
<div class="highlight-dtd notranslate"><div class="highlight"><pre><span></span><span class="k">&lt;!ELEMENT</span> <span class="nt">xsl:for-each</span> <span class="o">(</span><span class="nt">xsl:sort</span><span class="o">*,</span> <span class="nt">template</span><span class="o">)</span><span class="k">&gt;</span>
<span class="k">&lt;!ATTLIST</span> <span class="nt">xsl:for-each</span> <span class="na">select</span> <span class="kc">CDATA</span> <span class="kc">#REQUIRED</span><span class="k">&gt;</span>
</pre></div>
</div>
<p>El atributo <code class="docutils literal notranslate"><span class="pre">select</span></code> permite indicar los nodos que se quieren recorrer en el
bucle. Al entrar en <a class="reference internal" href="#xsl-for-each"><span class="std std-ref">&lt;xsl:for-each&gt;</span></a> el nodo de procesamiento pasa a ser el que
se trate en cada iteración del bucle, de modo que las expresiones <em>XPath</em> relativas
deberán estar referenciadas a él. Además es posible usar <a class="reference internal" href="#xsl-sort"><span class="std std-ref">&lt;xsl:sort&gt;</span></a> para ordenar
de un determinado modo los nodos seleccionados, tal como se indicó para
<a class="reference internal" href="#xsl-apply-templates"><span class="std std-ref">&lt;xsl:apply-templates&gt;</span></a>.</p>
<p id="xsl-ejemplo-intro-v2">Para ilustrar su uso, podemos reescribir el <a class="reference internal" href="#xslt-ejemplo"><span class="std std-ref">primer ejemplo</span></a>
del siguiente modo:</p>
<div class="highlight-xslt notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="k">&lt;xsl:stylesheet</span><span class="w"> </span><span class="na">version=</span><span class="s">&quot;1.0&quot;</span>
<span class="w">                </span><span class="na">xmlns:xsl=</span><span class="s">&quot;http://www.w3.org/1999/XSL/Transform&quot;</span><span class="nt">&gt;</span>
<span class="w"> </span>
<span class="w">   </span><span class="k">&lt;xsl:output</span><span class="w"> </span><span class="na">method=</span><span class="s">&quot;text&quot;</span><span class="w"> </span><span class="na">encoding=</span><span class="s">&quot;UTF-8&quot;</span><span class="nt">/&gt;</span>
<span class="w"> </span>
<span class="w">   </span><span class="k">&lt;xsl:template</span><span class="w"> </span><span class="na">match=</span><span class="s">&quot;discoteca&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:text</span><span class="nt">&gt;</span>LISTA<span class="w"> </span>DE<span class="w"> </span>DISCOS<span class="ni">&amp;#10;</span><span class="k">&lt;/xsl:text&gt;</span>
<span class="hll"><span class="w">      </span><span class="k">&lt;xsl:for-each</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;disco[not(@tipo = preceding-sibling::disco/@tipo)]&quot;</span><span class="nt">&gt;</span>
</span><span class="hll"><span class="w">         </span><span class="k">&lt;xsl:sort</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;@tipo&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</span><span class="hll">
</span><span class="hll"><span class="w">         </span><span class="k">&lt;xsl:call-template</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;tipo&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</span><span class="hll"><span class="w">         </span><span class="k">&lt;xsl:apply-templates</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;//disco[@tipo = current()/@tipo]&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</span><span class="hll"><span class="w">      </span><span class="k">&lt;/xsl:for-each&gt;</span>
</span><span class="w">   </span><span class="k">&lt;/xsl:template&gt;</span>
<span class="w"> </span>
<span class="w">   </span><span class="k">&lt;xsl:template</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;tipo&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:text</span><span class="nt">&gt;</span><span class="ni">&amp;#10;</span><span class="k">&lt;/xsl:text&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:number</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;position()&quot;</span><span class="w"> </span><span class="na">format=</span><span class="s">&quot;1. &quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:value-of</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;@tipo&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:text</span><span class="nt">&gt;</span><span class="ni">&amp;#10;</span><span class="k">&lt;/xsl:text&gt;</span>
<span class="w">   </span><span class="k">&lt;/xsl:template&gt;</span>
<span class="w"> </span>
<span class="w">   </span><span class="k">&lt;xsl:template</span><span class="w"> </span><span class="na">match=</span><span class="s">&quot;disco&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:number</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;position()&quot;</span><span class="w"> </span><span class="na">format=</span><span class="s">&quot;   a) &quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:value-of</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;nombre&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:text</span><span class="nt">&gt;</span><span class="w"> </span>(<span class="k">&lt;/xsl:text&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:value-of</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;autor&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:text</span><span class="nt">&gt;</span>)<span class="ni">&amp;#10;</span><span class="k">&lt;/xsl:text&gt;</span>
<span class="w">   </span><span class="k">&lt;/xsl:template&gt;</span>

<span class="k">&lt;/xsl:stylesheet&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>La reescritura no ha consistido en una mera sustitución del
<a class="reference internal" href="#xsl-apply-templates"><span class="std std-ref">&lt;xsl:apply-templates&gt;</span></a> por el <a class="reference internal" href="#xsl-for-each"><span class="std std-ref">&lt;xsl:for-each&gt;</span></a> (cosa que se podría haber hecho), sino
que se ha cambiado significativamente el algoritmo. En la antigua solución
se aplicaba la plantilla sobre todos los elementos «disco» y, dentro de la
plantilla, se comprobaba si era el primer disco de un tipo para escribir la
etiqueta que marcaba el tipo de música. Ahora, sin embargo, el <a class="reference internal" href="#xsl-for-each"><span class="std std-ref">&lt;xsl:for-each&gt;</span></a>
sólo recorre los primeros discos de cada tipo y, en cada iteración, se
ejecuta la plantilla para todos los discos de un mismo tipo. Hay, por tanto,
una profundidad más en la iteración, y eso nos permite numerar los tipos de
música:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>LISTA DE DISCOS

1. clasica
   a) Nueve sinfonías (Ludwing van Beethoven)
   b) El Mesías (G.F. Haendel)

2. jazz
   a) Kind of Blue (Miles Davis)
   b) Ella and Louis (Ella Fitzgerald/Louis Armstrong)

3. rock
   a) Metalmorfosis (Barón Rojo)
   b) Más madera (Leño)
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Por lo general, una solución con <a class="reference internal" href="#xsl-for-each"><span class="std std-ref">&lt;xsl:for-each&gt;</span></a> puede ser escrita con
<a class="reference internal" href="#xsl-apply-templates"><span class="std std-ref">&lt;xsl:apply-templates&gt;</span></a> y viceversa. Como prueba, <a class="reference download internal" download="" href="../_downloads/687c6bf3f424840dac65b5433bcce7ef/discos-2apply.txt.xsl"><code class="xref download docutils literal notranslate"><span class="pre">ésta</span> <span class="pre">es</span> <span class="pre">la</span> <span class="pre">solución</span> <span class="pre">con</span>
<span class="pre">apply-templates</span></code></a> del código <abbr title="eXtensible Stylesheet Language Transformations">XSLT</abbr> que se acaba
de proponer.</p>
</div>
</section>
<section id="otros-elementos">
<h3>Otros elementos<a class="headerlink" href="#otros-elementos" title="Enlace permanente a este encabezado">¶</a></h3>
<p>Además de los elementos ya descritos, <abbr title="eXtensible Stylesheet Language Transformations">XSLT</abbr> dispone de algunos otros que permiten
hacer cosas interesantes:</p>
<dl class="simple" id="xsl-fall-back">
<dt><code class="docutils literal notranslate"><span class="pre">&lt;xsl:fall-back&gt;</span></code></dt><dd><p>permite ejecutar un código alternativo cuando el procesador no tenga soporte
para alguna instrucción que se haya intentado ejecutar. <a class="reference external" href="https://www.w3schools.com/xml/ref_xsl_el_fallback.asp">Aquí</a> hay un ejemplo
elocuente de cómo debe usarse.</p>
</dd>
</dl>
<dl id="xsl-message">
<dt><code class="docutils literal notranslate"><span class="pre">&lt;xsl:message&gt;</span></code></dt><dd><p>permite escribir en la salida de errores un mensaje durante el procesamiento.
Es común que contenga texto, pero puede contener los mismos elementos que
<a class="reference internal" href="#xsl-template"><span class="std std-ref">&lt;xsl:template&gt;</span></a>, por ejemplo, <a class="reference internal" href="#xsl-value-of"><span class="std std-ref">&lt;xsl:value-of&gt;</span></a>, lo cual permite mostrar el valor de
nodos y variables durante una depuración del código.</p>
<p>Permite, además, incluir el atributo <em>terminate</em> con valor <em>yes</em> para
cancelar inmediatamente la ejecución de la transformación:</p>
<div class="highlight-xslt notranslate"><div class="highlight"><pre><span></span><span class="k">&lt;xsl:message</span><span class="w"> </span><span class="na">terminate=</span><span class="s">&quot;yes&quot;</span><span class="nt">&gt;</span>ERROR.<span class="w"> </span>Valor<span class="w"> </span>incorrecto:<span class="w"> </span><span class="k">&lt;xsl:value-of</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;$variable&quot;</span><span class="nt">/&gt;</span>.<span class="k">&lt;/xsl:message&gt;</span>
</pre></div>
</div>
</dd>
</dl>
<span id="xsl-preserve-space"></span><dl class="simple" id="xsl-strip-space">
<dt><code class="docutils literal notranslate"><span class="pre">&lt;xsl:preserve-space&gt;</span></code>/<code class="docutils literal notranslate"><span class="pre">&lt;xsl:strip-space&gt;</span></code></dt><dd><p>permite indicar una lista de elementos del <abbr title="eXtensible  Markup Language">XML</abbr> original para los que se quiere
en la transformación preservar o eliminar los espacios en blanco adicionales.
Deben incluirse dentro de <a class="reference internal" href="#xsl-stylesheet"><span class="std std-ref">&lt;xsl:stylesheet&gt;</span></a>.</p>
</dd>
</dl>
<dl id="xsl-key">
<dt><code class="docutils literal notranslate"><span class="pre">&lt;xsl:key&gt;</span></code></dt><dd><p>genera una colección de elementos clasificados según un determinado
criterio:</p>
<div class="highlight-dtd notranslate"><div class="highlight"><pre><span></span><span class="k">&lt;!ELEMENT</span> <span class="nt">xsl:key</span> <span class="kc">EMPTY</span><span class="k">&gt;</span>
<span class="k">&lt;!ATTLIST</span> <span class="nt">xsl:key</span> <span class="na">name</span>  <span class="kc">NMTOKEN</span>  <span class="kc">#REQUIRED</span>
                  <span class="na">match</span> <span class="kc">CDATA</span>    <span class="kc">#REQUIRED</span>
                  <span class="na">use</span>   <span class="kc">CDATA</span>    <span class="kc">#REQUIRED</span><span class="k">&gt;</span>
</pre></div>
</div>
<p>El atributo <code class="docutils literal notranslate"><span class="pre">name</span></code> sirve para darle nombre a la clave, <code class="docutils literal notranslate"><span class="pre">match</span></code> para
indicar los elementos que formarán parte de la colección; y <code class="docutils literal notranslate"><span class="pre">use</span></code> el
criterio que se seguirá para clasificarlos. Por ejemplo, dentro del elemento
<a class="reference internal" href="#xsl-stylesheet"><span class="std std-ref">&lt;xsl:stylesheet&gt;</span></a> podemos hacer la siguiente definición:</p>
<div class="highlight-xslt notranslate"><div class="highlight"><pre><span></span><span class="k">&lt;xsl:key</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;tipo_musica&quot;</span><span class="w"> </span><span class="na">match=</span><span class="s">&quot;disco&quot;</span><span class="w"> </span><span class="na">use=</span><span class="s">&quot;@tipo&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</pre></div>
</div>
<p>que clasifica los discos por su tipo, de manera que si usamos la función
<a class="reference internal" href="#xsl-func-key"><span class="std std-ref">key()</span></a>, la expresión <code class="code docutils literal notranslate"><span class="pre">key(tipo_musica,</span> <span class="pre">'clasica')</span></code> devuelve el
conjunto de elementos disco de música clásica.</p>
</dd>
</dl>
<dl id="xsl-decimal-format">
<dt><code class="docutils literal notranslate"><span class="pre">&lt;xsl:decimal-format&gt;</span></code></dt><dd><p>especifica los caracteres que se usarán para el formateo de números que se
lleve a cabo con la función <a class="reference internal" href="#xsl-func-format-number"><span class="std std-ref">format-number()</span></a>:</p>
<div class="highlight-dtd notranslate"><div class="highlight"><pre><span></span><span class="k">&lt;!ELEMENT</span> <span class="nt">xsl:decimal-format</span> <span class="kc">EMPTY</span><span class="k">&gt;</span>
<span class="k">&lt;!ATTLIST</span> <span class="nt">xsl:decimal-format</span> <span class="na">name</span>               <span class="kc">NMTOKEN</span> <span class="kc">#REQUIRED</span>
                             <span class="na">decimal-separator</span>  <span class="kc">CDATA</span>   <span class="s2">&quot;.&quot;</span>
                             <span class="na">grouping-separator</span> <span class="kc">CDATA</span>   <span class="s2">&quot;,&quot;</span>
                             <span class="na">infinity</span>           <span class="kc">CDATA</span>   <span class="s2">&quot;Infinity&quot;</span>
                             <span class="na">minus-sign</span>         <span class="kc">CDATA</span>   <span class="s2">&quot;-&quot;</span>
                             <span class="na">NaN</span>                <span class="kc">CDATA</span>   <span class="s2">&quot;NaN&quot;</span>
                             <span class="na">percent</span>            <span class="kc">CDATA</span>   <span class="s2">&quot;%&quot;</span>
                             <span class="na">per-mille</span>          <span class="kc">CDATA</span>   <span class="s2">&quot;‰&quot;</span>
                             <span class="na">zero-digit</span>         <span class="kc">CDATA</span>   <span class="s2">&quot;0&quot;</span>
                             <span class="na">digit</span>              <span class="kc">CDATA</span>   <span class="s2">&quot;#&quot;</span>
                             <span class="na">pattern-separator</span>  <span class="kc">CDATA</span>   <span class="s2">&quot;;&quot;</span><span class="k">&gt;</span>
</pre></div>
</div>
<p>Debe incluirse como hijo de <a class="reference internal" href="#xsl-stylesheet"><span class="std std-ref">&lt;xsl:stylesheet&gt;</span></a>.</p>
</dd>
</dl>
</section>
</section>
<section id="funciones">
<span id="xslt-func"></span><h2>Funciones<a class="headerlink" href="#funciones" title="Enlace permanente a este encabezado">¶</a></h2>
<p><abbr title="eXtensible Stylesheet Language Transformations">XSLT</abbr> <strong>1.0</strong> tiene unas pocas funciones que pueden usarse para hacer más poderosas
las expresiones <em>XPath</em>. De hecho, <a class="reference internal" href="#e-xslt"><span class="std std-ref">EXSLT</span></a> consisten básicamente en aumentar
este número de funciones disponibles.</p>
<dl id="xsl-func-current">
<dt><code class="docutils literal notranslate"><span class="pre">current()</span></code></dt><dd><p>Devuelve el nodo actual de procesamiento. En principio, parace un poco inútil
porque:</p>
<div class="highlight-xslt notranslate"><div class="highlight"><pre><span></span><span class="k">&lt;xsl:value-of</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;current()&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<p>es equivalente a:</p>
<div class="highlight-xslt notranslate"><div class="highlight"><pre><span></span><span class="k">&lt;xsl:value-of</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;.&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<p>Sin embargo, cuando la expresión <em>XPath</em> es más complicada y contiene un
predicado dejan de devolver el mismo nodo, ya que <em>current()</em> siempre
devuelve el nodo de procesamiento. Un ejemplo sería una variante de la
plantilla disco del <a class="reference internal" href="#xslt-ejemplo"><span class="std std-ref">primer ejemplo</span></a>:</p>
<div class="highlight-xslt notranslate"><div class="highlight"><pre><span></span><span class="k">&lt;xsl:variable</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;tipo&quot;</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;@tipo&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="k">&lt;xsl:if</span><span class="w"> </span><span class="na">test=</span><span class="s">&quot;not(preceding-sibling::disco[@tipo = $tipo])&quot;</span><span class="nt">&gt;</span>
<span class="w">   </span><span class="k">&lt;xsl:call-template</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;tipo&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="k">&lt;/xsl:if&gt;</span>
</pre></div>
</div>
<p>Obsérvese que para tomar los discos cuyo tipo es igual al disco que se
procesa, hubo que guardar primero el tipo en una variable, puesto que en la
expresión <code class="code docutils literal notranslate"><span class="pre">test=&quot;not(preceding-sibling::disco[&#64;tipo</span> <span class="pre">=</span> <span class="pre">./&#64;tipo])&quot;</span></code> el
punto representa el propio disco del que se comprueba el tipo en el
predicado; y, por tanto, tal predicado es una <a class="reference external" href="https://es.wikipedia.org/wiki/Tautolog%C3%ADa">tautología</a>. En cambio:</p>
<div class="highlight-xslt notranslate"><div class="highlight"><pre><span></span><span class="k">&lt;xsl:if</span><span class="w"> </span><span class="na">test=</span><span class="s">&quot;not(preceding-sibling::disco[@tipo = current()/@tipo])&quot;</span><span class="nt">&gt;</span>
<span class="w">   </span><span class="k">&lt;xsl:call-template</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;tipo&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="k">&lt;/xsl:if&gt;</span>
</pre></div>
</div>
<p>hace exactamente lo que queremos sin necesidad de definir la variable.</p>
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<p>Ha de hacerse una puntualización: no debe usarse la función
<a class="reference internal" href="#xsl-func-current"><span class="std std-ref">current()</span></a> dentro de atributos que la normativa indica que son <em>pattern</em>,
tales como el atributo <code class="docutils literal notranslate"><span class="pre">match</span></code> de <a class="reference internal" href="#xsl-template"><span class="std std-ref">&lt;xsl:template&gt;</span></a> o el atributo <code class="docutils literal notranslate"><span class="pre">count</span></code> de
<a class="reference internal" href="#xsl-number"><span class="std std-ref">&lt;xsl:number&gt;</span></a>.</p>
</div>
</dd>
</dl>
<dl id="xsl-func-document">
<dt><code class="docutils literal notranslate"><span class="pre">document()</span></code></dt><dd><p>Obtiene el árbol de nodos de un documento <abbr title="eXtensible  Markup Language">XML</abbr>, para poder acceder a su
información.</p>
<p>Para ilustrar la función, supongamos que tenemos otro documento <abbr title="eXtensible  Markup Language">XML</abbr> en que
están apuntados los discos que hemos dejado prestados:</p>
<div class="highlight-xslt notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;</span>
<span class="cp">&lt;!DOCTYPE prestados [</span>
<span class="cp">   &lt;!ELEMENT prestados (disco+)&gt;</span>
<span class="w">   </span><span class="cp">&lt;!ELEMENT disco EMPTY&gt;</span>
<span class="w">   </span><span class="cp">&lt;!ATTLIST disco id    ID      #REQUIRED</span>
<span class="cp">                   a     CDATA   #REQUIRED</span>
<span class="cp">                   fecha NMTOKEN #REQUIRED&gt;</span>
]&gt;
<span class="nt">&lt;prestados&gt;</span>
<span class="w">   </span><span class="nt">&lt;disco</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;d1&quot;</span><span class="w"> </span><span class="na">a=</span><span class="s">&quot;Periquito&quot;</span><span class="w"> </span><span class="na">fecha=</span><span class="s">&quot;2014-01-01&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">   </span><span class="nt">&lt;disco</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;d4&quot;</span><span class="w"> </span><span class="na">a=</span><span class="s">&quot;Mariquita&quot;</span><span class="w"> </span><span class="na">fecha=</span><span class="s">&quot;2014-03-01&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;/prestados&gt;</span>
</pre></div>
</div>
<p>y que queremos sacar una lista en que se distinga convenientemente qué
discos tenemos prestados:</p>
<div class="highlight-xslt notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="k">&lt;xsl:stylesheet</span><span class="w"> </span><span class="na">version=</span><span class="s">&quot;1.0&quot;</span>
<span class="w">                </span><span class="na">xmlns:xsl=</span><span class="s">&quot;http://www.w3.org/1999/XSL/Transform&quot;</span>
<span class="w">                </span><span class="na">xmlns:exslt=</span><span class="s">&quot;http://exslt.org/common&quot;</span>
<span class="w">                </span><span class="na">extension-element-prefixes=</span><span class="s">&quot;exslt&quot;</span><span class="nt">&gt;</span>
<span class="w"> </span>
<span class="w">   </span><span class="k">&lt;xsl:import</span><span class="w"> </span><span class="na">href=</span><span class="s">&quot;discos.txt.xsl&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>

<span class="hll"><span class="w">   </span><span class="k">&lt;xsl:variable</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;prestados&quot;</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;document(&#39;prestamos.xml&#39;)/prestados/disco/@id&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</span>
<span class="w">   </span><span class="k">&lt;xsl:template</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;disco&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:text</span><span class="nt">&gt;</span><span class="w">   </span><span class="k">&lt;/xsl:text&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:choose</span><span class="nt">&gt;</span>
<span class="w">         </span><span class="k">&lt;xsl:when</span><span class="w"> </span><span class="na">test=</span><span class="s">&quot;@id = $prestados&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="k">&lt;xsl:text</span><span class="nt">&gt;</span>#<span class="w"> </span><span class="k">&lt;/xsl:text&gt;</span>
<span class="w">         </span><span class="k">&lt;/xsl:when&gt;</span>
<span class="w">         </span><span class="k">&lt;xsl:otherwise</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="k">&lt;xsl:text</span><span class="nt">&gt;</span>-<span class="w"> </span><span class="k">&lt;/xsl:text&gt;</span>
<span class="w">         </span><span class="k">&lt;/xsl:otherwise&gt;</span>
<span class="w">      </span><span class="k">&lt;/xsl:choose&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:value-of</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;nombre&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:text</span><span class="nt">&gt;</span><span class="w"> </span>(<span class="k">&lt;/xsl:text&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:value-of</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;autor&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:text</span><span class="nt">&gt;</span>)<span class="ni">&amp;#10;</span><span class="k">&lt;/xsl:text&gt;</span>
<span class="w">   </span><span class="k">&lt;/xsl:template&gt;</span>
<span class="w"> </span>
<span class="k">&lt;/xsl:stylesheet&gt;</span>
</pre></div>
</div>
<p>Esta transformación genera la siguiente salida:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>LISTA DE DISCOS

+ clasica
   # Nueve sinfonías (Ludwing van Beethoven)
   - El Mesías (G.F. Haendel)

+ jazz
   - Kind of Blue (Miles Davis)
   - Ella and Louis (Ella Fitzgerald/Louis Armstrong)

+ rock
   - Metalmorfosis (Barón Rojo)
   # Más madera (Leño)
</pre></div>
</div>
</dd>
</dl>
<dl id="xsl-func-element-available">
<dt><code class="docutils literal notranslate"><span class="pre">element-available()</span></code></dt><dd><p>La función permite comprobar si un elemento <abbr title="eXtensible Stylesheet Language Transformations">XSLT</abbr> está disponible en el
procesador. Por ejemplo:</p>
<div class="highlight-xslt notranslate"><div class="highlight"><pre><span></span><span class="k">&lt;xsl:choose</span><span class="nt">&gt;</span>
<span class="w">   </span><span class="k">&lt;xsl:when</span><span class="w"> </span><span class="na">test=</span><span class="s">&quot;element-available(&#39;xsl:comment&#39;)&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:comment</span><span class="nt">&gt;</span><span class="w"> </span>Comentario<span class="w"> </span>interesantísimo<span class="w"> </span><span class="k">&lt;/xsl:comment&gt;</span>
<span class="w">   </span><span class="k">&lt;/xsl:when&gt;</span>
<span class="w">   </span><span class="k">&lt;xsl:when</span><span class="w"> </span><span class="na">test=</span><span class="s">&quot;element-available(&#39;xsl:message&#39;)&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:message</span><span class="nt">&gt;</span>¡Atención!<span class="w"> </span>La<span class="w"> </span>salida<span class="w"> </span>se<span class="w"> </span>queda<span class="w"> </span>sin<span class="w"> </span>el<span class="w"> </span>comentario<span class="w"> </span>interesantísimo<span class="k">&lt;/xsl:message&gt;</span>
<span class="w">   </span><span class="k">&lt;/xsl:when&gt;</span>
<span class="w">   </span><span class="k">&lt;xsl:otherwise</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="cm">&lt;!-- Este procesador es una caca y no se puede hacer nada con él :( --&gt;</span>
<span class="w">   </span><span class="k">&lt;/xsl:otherwise&gt;</span>
<span class="k">&lt;/xsl:choose&gt;</span>
</pre></div>
</div>
</dd>
</dl>
<dl id="xsl-func-format-number">
<dt><code class="docutils literal notranslate"><span class="pre">format-number()</span></code></dt><dd><p>La función sirve para convertir un número a cadena según un determinado
formato. El número se indica como primer argumento y la cadena como segundo
siguiendo estas reglas:</p>
<ul class="simple">
<li><p>Un «0» indica que se mostrará siempre un dígito.</p></li>
<li><p>Una «#» indica que se mostrará el dígito sólo si este realmente existe.</p></li>
<li><p>Un «.» indica la posición del punto decimal</p></li>
<li><p>Un «%» indica que quiere mostrarse el número como porcentaje.</p></li>
</ul>
<p>Así, por ejemplo:</p>
<ul class="simple">
<li><p>«#.00» mostrará el número siempre con dos decimales.</p></li>
<li><p>«#%» expresará el número como un porcentaje</p></li>
</ul>
<p>Por ejemplo:</p>
<div class="highlight-xslt notranslate"><div class="highlight"><pre><span></span><span class="k">&lt;xsl:value-of</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;format-number(0.23342, &#39;#.00%&#39;)&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</pre></div>
</div>
<p>muestra «23.34%». La función admite un tercer parámetro: el nombre de un
formato definido con el elemento <a class="reference internal" href="#xsl-decimal-format"><span class="std std-ref">&lt;xsl:decimal-format&gt;</span></a>.</p>
</dd>
</dl>
<dl class="simple" id="xsl-func-available">
<dt><code class="docutils literal notranslate"><span class="pre">function-available()</span></code></dt><dd><p>Equivalente a <a class="reference internal" href="#xsl-func-element-available"><span class="std std-ref">element-available()</span></a>, pero para comprobar funciones en vez de
elementos.</p>
</dd>
</dl>
<dl class="simple" id="xsl-func-generate-id">
<dt><code class="docutils literal notranslate"><span class="pre">generate-id()</span></code></dt><dd><p>Genera un identificar único para el nodo especificado en el argumento. Si no
especifica ninguno, se sobreentiende el nodo actual.</p>
</dd>
</dl>
<dl id="xsl-func-key">
<dt><code class="docutils literal notranslate"><span class="pre">key()</span></code></dt><dd><p>Función complementaria al elemento <a class="reference internal" href="#xsl-key"><span class="std std-ref">&lt;xsl:key&gt;</span></a>. Para ilustrarla, podemos cambiar el
<a class="reference internal" href="#xslt-ejemplo"><span class="std std-ref">primer ejemplo</span></a> por este otro:</p>
<div class="highlight-xslt notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="k">&lt;xsl:stylesheet</span><span class="w"> </span><span class="na">version=</span><span class="s">&quot;1.0&quot;</span>
<span class="w">                </span><span class="na">xmlns:xsl=</span><span class="s">&quot;http://www.w3.org/1999/XSL/Transform&quot;</span><span class="nt">&gt;</span>
<span class="w"> </span>
<span class="w">   </span><span class="k">&lt;xsl:output</span><span class="w"> </span><span class="na">method=</span><span class="s">&quot;text&quot;</span><span class="w"> </span><span class="na">encoding=</span><span class="s">&quot;UTF-8&quot;</span><span class="nt">/&gt;</span>
<span class="w"> </span>
<span class="hll"><span class="w">   </span><span class="k">&lt;xsl:key</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;tipo&quot;</span><span class="w"> </span><span class="na">match=</span><span class="s">&quot;disco&quot;</span><span class="w"> </span><span class="na">use=</span><span class="s">&quot;@tipo&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</span>
<span class="w">   </span><span class="k">&lt;xsl:template</span><span class="w"> </span><span class="na">match=</span><span class="s">&quot;discoteca&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:text</span><span class="nt">&gt;</span>LISTA<span class="w"> </span>DE<span class="w"> </span>DISCOS<span class="ni">&amp;#10;</span><span class="k">&lt;/xsl:text&gt;</span>

<span class="hll"><span class="w">      </span><span class="k">&lt;xsl:for-each</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;disco[. = key(&#39;tipo&#39;,@tipo)[1]]&quot;</span><span class="nt">&gt;</span>
</span><span class="w">         </span><span class="k">&lt;xsl:call-template</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;tipo&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="hll"><span class="w">         </span><span class="k">&lt;xsl:apply-templates</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;key(&#39;tipo&#39;, @tipo)&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</span><span class="w">      </span><span class="k">&lt;/xsl:for-each&gt;</span>
<span class="w">   </span><span class="k">&lt;/xsl:template&gt;</span>
<span class="w"> </span>
<span class="w">   </span><span class="k">&lt;xsl:template</span><span class="w"> </span><span class="na">match=</span><span class="s">&quot;disco&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:text</span><span class="nt">&gt;</span><span class="w">   </span><span class="k">&lt;/xsl:text&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:number</span><span class="w"> </span><span class="na">format=</span><span class="s">&quot;a) &quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:value-of</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;nombre&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:text</span><span class="nt">&gt;</span><span class="w"> </span>(<span class="k">&lt;/xsl:text&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:value-of</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;autor&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:text</span><span class="nt">&gt;</span>)<span class="ni">&amp;#10;</span><span class="k">&lt;/xsl:text&gt;</span>
<span class="w">   </span><span class="k">&lt;/xsl:template&gt;</span>

<span class="w">   </span><span class="k">&lt;xsl:template</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;tipo&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:text</span><span class="nt">&gt;</span><span class="ni">&amp;#10;</span><span class="k">&lt;/xsl:text&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:number</span><span class="w"> </span><span class="na">format=</span><span class="s">&quot;1. &quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:value-of</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;@tipo&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:text</span><span class="nt">&gt;</span><span class="ni">&amp;#10;</span><span class="k">&lt;/xsl:text&gt;</span>
<span class="w">   </span><span class="k">&lt;/xsl:template&gt;</span>

<span class="k">&lt;/xsl:stylesheet&gt;</span>
</pre></div>
</div>
<p>Esta transformación genera la siguiente lista:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>LISTA DE DISCOS

1. clasica
   a) Nueve sinfonías (Ludwing van Beethoven)
   b) El Mesías (G.F. Haendel)

2. jazz
   a) Kind of Blue (Miles Davis)
   b) Ella and Louis (Ella Fitzgerald/Louis Armstrong)

3. rock
   a) Metalmorfosis (Barón Rojo)
   b) Más madera (Leño)
</pre></div>
</div>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">system-property()</span></code></dt><dd><p>Permite obtener información sobre el procesador que se está usando para la
transformación. El único argumento es una cadena que puede ser:</p>
<ul class="simple">
<li><p>“<em>xsl:version</em>”, la versión de <abbr title="eXtensible Stylesheet Language Transformations">XSLT</abbr> que implementa el procesador.</p></li>
<li><dl class="simple">
<dt>“<em>xsl:vendor</em>”, el vendedor del procesador o, por mejor decir, el nombre del</dt><dd><p>software procesador.</p>
</dd>
</dl>
</li>
<li><p>“<em>xsl:vendor-url</em>”, la <abbr title="Uniform Resource Locator">URL</abbr> del software procesador.</p></li>
</ul>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unparsed-entity-uri()</span></code></dt><dd><p>Devuelve la <abbr title="Uniform Resource Identifier">URI</abbr> de la entidad no procesable que se haya indicado como
argumento. Esta entidad debe estar definida en el <abbr title="Document Type Definition">DTD</abbr>.</p>
<div class="admonition seealso">
<p class="admonition-title">Ver también</p>
<p>Consulte el <a class="reference internal" href="../02.validacion/01.dtdxml.html#dtd-ent-no-p"><span class="std std-ref">concepto de entidad no procesable</span></a>
en la sección dedicada a <abbr title="Document Type Definition">DTD</abbr>.</p>
</div>
</dd>
</dl>
<p class="rubric">Ejercicio intermedio</p>
<p>Modifique la propuesta con la que se presentó <a class="reference internal" href="#xsl-func-document"><span class="std std-ref">document()</span></a>, para que la salida sea:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>LISTA DE DISCOS

+ clasica
 # [Periquito] Nueve sinfonías (Ludwing van Beethoven)
 - El Mesías (G.F. Haendel)

+ jazz
 - Kind of Blue (Miles Davis)
 - Ella and Louis (Ella Fitzgerald/Louis Armstrong)

+ rock
 - Metalmorfosis (Barón Rojo)
 # [Mariquita] Más madera (Leño)
</pre></div>
</div>
</section>
<section id="extensiones">
<span id="xslt-extensiones"></span><h2>Extensiones<a class="headerlink" href="#extensiones" title="Enlace permanente a este encabezado">¶</a></h2>
<p>Además de las funciones que define las especificación para <abbr title="eXtensible Stylesheet Language Transformations">XSLT</abbr> <strong>1.0</strong>,
algunos procesadores que soportan esta versión, pero no la <strong>2.0</strong> han
implementado los elementos y funciones definidos por la <a class="reference external" href="http://exslt.org">comunidad EXSLT</a>.</p>
<p>Por otro lado, es también posible crear extensiones propias.</p>
<section id="extensiones-estandar">
<span id="e-xslt"></span><h3>Extensiones estándar<a class="headerlink" href="#extensiones-estandar" title="Enlace permanente a este encabezado">¶</a></h3>
<p>Como los procesadores no tienen por qué implementar todas, lo recomentables
es conocer cuáles, que en nuestro caso se hace:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>xmlstarlet<span class="w"> </span>tr<span class="w"> </span>--show-ext
</pre></div>
</div>
<p>Extenderse aquí en explicar una por una las funciones es labor prolija y además
ya está realizada en la propia página de la <a class="reference external" href="http://exslt.org">comunidad EXSLT</a>. Lo que sí
podemos hacer es ilustrar con algunos ejemplos cómo se utilizan.</p>
<p id="exslt-set-distinct">A partir de 2.0, <em>XPath</em> tiene una utilísima función llamada <a class="reference external" href="https://www.w3.org/TR/xpath-functions-31/#func-distinct-values">distinct-values()</a>, de la que
carece la versión <strong>1.0</strong> y que permite eliminar los nodos repetidos en un
conjunto<a class="footnote-reference brackets" href="#id16" id="id7" role="doc-noteref"><span class="fn-bracket">[</span>6<span class="fn-bracket">]</span></a>. Ahora bien, <a class="reference internal" href="#e-xslt"><span class="std std-ref">EXSLT</span></a> dispone de la función <a class="reference internal" href="#exslt-set-distinct"><span class="std std-ref">set:distinct()</span></a>
precisamente para realizar esa misma labor. Con ella, podríamos resolver el
<a class="reference internal" href="#xslt-ejemplo"><span class="std std-ref">primer ejemplo introductorio</span></a> del siguiente modo:</p>
<div class="highlight-xslt notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="k">&lt;xsl:stylesheet</span><span class="w"> </span><span class="na">version=</span><span class="s">&quot;1.0&quot;</span>
<span class="w">                </span><span class="na">xmlns:xsl=</span><span class="s">&quot;http://www.w3.org/1999/XSL/Transform&quot;</span>
<span class="hll"><span class="w">                </span><span class="na">xmlns:set=</span><span class="s">&quot;http://exslt.org/sets&quot;</span>
</span><span class="hll"><span class="w">                </span><span class="na">extension-element-prefixes=</span><span class="s">&quot;set&quot;</span><span class="nt">&gt;</span>
</span><span class="w"> </span>
<span class="w">   </span><span class="k">&lt;xsl:output</span><span class="w"> </span><span class="na">method=</span><span class="s">&quot;text&quot;</span><span class="w"> </span><span class="na">encoding=</span><span class="s">&quot;utf-8&quot;</span><span class="nt">/&gt;</span>
<span class="w"> </span>
<span class="w">   </span><span class="k">&lt;xsl:template</span><span class="w"> </span><span class="na">match=</span><span class="s">&quot;discoteca&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:text</span><span class="nt">&gt;</span>LISTA<span class="w"> </span>DE<span class="w"> </span>DISCOS<span class="ni">&amp;#10;</span><span class="k">&lt;/xsl:text&gt;</span>
<span class="hll"><span class="w">      </span><span class="k">&lt;xsl:for-each</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;set:distinct(disco/@tipo)&quot;</span><span class="nt">&gt;</span>
</span><span class="w">         </span><span class="k">&lt;xsl:sort</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;.&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>

<span class="w">         </span><span class="k">&lt;xsl:call-template</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;tipo&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">         </span><span class="k">&lt;xsl:apply-templates</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;//disco[@tipo = current()]&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="k">&lt;/xsl:for-each&gt;</span>
<span class="w">   </span><span class="k">&lt;/xsl:template&gt;</span>
<span class="w"> </span>
<span class="w">   </span><span class="k">&lt;xsl:template</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;tipo&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:text</span><span class="nt">&gt;</span><span class="ni">&amp;#10;</span><span class="k">&lt;/xsl:text&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:number</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;position()&quot;</span><span class="w"> </span><span class="na">format=</span><span class="s">&quot;1. &quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:value-of</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;.&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:text</span><span class="nt">&gt;</span><span class="ni">&amp;#10;</span><span class="k">&lt;/xsl:text&gt;</span>
<span class="w">   </span><span class="k">&lt;/xsl:template&gt;</span>
<span class="w"> </span>
<span class="w">   </span><span class="k">&lt;xsl:template</span><span class="w"> </span><span class="na">match=</span><span class="s">&quot;disco&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:number</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;position()&quot;</span><span class="w"> </span><span class="na">format=</span><span class="s">&quot;   a) &quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:value-of</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;nombre&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:text</span><span class="nt">&gt;</span><span class="w"> </span>(<span class="k">&lt;/xsl:text&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:value-of</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;autor&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:text</span><span class="nt">&gt;</span>)<span class="ni">&amp;#10;</span><span class="k">&lt;/xsl:text&gt;</span>
<span class="w">   </span><span class="k">&lt;/xsl:template&gt;</span>
<span class="w"> </span>
<span class="k">&lt;/xsl:stylesheet&gt;</span>
</pre></div>
</div>
<p>cuya salida es:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>LISTA DE DISCOS

1. clasica
   a) Nueve sinfonías (Ludwing van Beethoven)
   b) El Mesías (G.F. Haendel)

2. jazz
   a) Kind of Blue (Miles Davis)
   b) Ella and Louis (Ella Fitzgerald/Louis Armstrong)

3. rock
   a) Metalmorfosis (Barón Rojo)
   b) Más madera (Leño)
</pre></div>
</div>
<p id="exslt-func-func">Otra aplicación de ls extensdiones es esta: imaginemos que queremos mostrar un
conjunto de elementos de un <abbr title="eXtensible  Markup Language">XML</abbr>, pero de manera desordenada; esto es, que cada
vez que generemos la salida el orden de esos elementos varíe de modo aleatorio.
Piénsese en un <abbr title="eXtensible  Markup Language">XML</abbr> que almacene preguntas de un examen: puede resultarnos útil
sacar unos cuantos modelos en que esas preguntas estén desordenadas con el
propósito de dificultar que los alumnos se copien. Así que nuestro propósito es
generar una función de manera que al hacer:</p>
<div class="highlight-xslt notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;my:sort</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;xsl:random()&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</pre></div>
</div>
<p>dentro de <a class="reference internal" href="#xsl-for-each"><span class="std std-ref">&lt;xsl:for-each&gt;</span></a> o <a class="reference internal" href="#xsl-apply-templates"><span class="std std-ref">&lt;xsl:apply-templates&gt;</span></a> la ordenación de los nodos sea
imprevisible y distinta cada vez. Lo primero es analizar lo que pretendemos:</p>
<ol class="arabic simple">
<li><p>Queremos crear una función nueva, para lo cual existe la extensión
<code class="docutils literal notranslate"><span class="pre">&lt;func:function&gt;</span></code>.</p></li>
<li><p>La funciones debemos meterla en un espacio de nombres propio. Puede ser <em>my</em>,
por ejemplo<a class="footnote-reference brackets" href="#id17" id="id8" role="doc-noteref"><span class="fn-bracket">[</span>7<span class="fn-bracket">]</span></a>.</p></li>
<li><p>La llamamos <em>random</em>, por eso de que genera un número aleatorio.</p></li>
<li><p>Debe devolvernos un número pseudo-aleatorio que es el que servirá para
(des)ordenar el conjunto de elementos.</p></li>
<li><p>Es conveniente crearla en fichero aparte, pues puede sernos útil en muchas
transformaciones.</p></li>
</ol>
<p>Pues bien, fijado esto, podemos crearnos el siguiente fichero
<code class="file docutils literal notranslate"><span class="pre">random.xsl</span></code>:</p>
<div class="highlight-xslt notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="k">&lt;xsl:stylesheet</span><span class="w"> </span><span class="na">version=</span><span class="s">&quot;1.0&quot;</span>
<span class="w">                </span><span class="na">xmlns:xsl=</span><span class="s">&quot;http://www.w3.org/1999/XSL/Transform&quot;</span>
<span class="w">                </span><span class="na">xmlns:func=</span><span class="s">&quot;http://exslt.org/functions&quot;</span>
<span class="w">                </span><span class="na">xmlns:date=</span><span class="s">&quot;http://exslt.org/dates-and-times&quot;</span>
<span class="w">                </span><span class="na">xmlns:my=</span><span class="s">&quot;urn:miextension&quot;</span>
<span class="w">                </span><span class="na">extension-element-prefixes=</span><span class="s">&quot;func date my&quot;</span><span class="nt">&gt;</span>
<span class="w"> </span>
<span class="w">   </span><span class="cm">&lt;!-- devuelve un número pseudoaleatorio</span>
<span class="cm">     -  a partir del generate-id() del elemento</span>
<span class="cm">     -  (sirve para desordenar un conjunto de nodos) --&gt;</span>
<span class="w">   </span><span class="nt">&lt;func:function</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;my:random&quot;</span><span class="nt">&gt;</span>
<span class="w"> </span>
<span class="w">      </span><span class="k">&lt;xsl:variable</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;m&quot;</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;32768&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:variable</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;a&quot;</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;1103515245&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:variable</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;c&quot;</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;12345&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w"> </span>
<span class="w">      </span><span class="k">&lt;xsl:variable</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;seconds&quot;</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;substring(date:seconds(), 5)&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:variable</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;seed&quot;</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;concat(substring(generate-id(), 4), $seconds)&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w"> </span>
<span class="w">      </span><span class="nt">&lt;func:result</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;($seed * $a + $c) mod $m&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">   </span><span class="nt">&lt;/func:function&gt;</span>
<span class="k">&lt;/xsl:stylesheet&gt;</span>
</pre></div>
</div>
<p>No es tan importante el modo en que se obtiene el número pseudo-aleatorio, sino
sólo saber que para obtenerlo es necesaria una semilla que se consigue a partir
del identificador generado del nodo y la hora puesta en segundos según el tiempo
<em>UNIX</em>. El primer dato se consigue a través de la función <a class="reference internal" href="#xsl-func-generate-id"><span class="std std-ref">generate-id()</span></a>. Para
el segundo es necesario la función <a class="reference external" href="http://exslt.org/date/functions/seconds/index.html">date:seconds()</a>, que es una función de
<a class="reference internal" href="#e-xslt"><span class="std std-ref">EXSLT</span></a>.</p>
<p>Ahora, si queremos usar esta nueva función, para generar un listado desordenado
de nombres de discos, podemos hacer lo siguiente:</p>
<div class="highlight-xslt notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="k">&lt;xsl:stylesheet</span><span class="w"> </span><span class="na">version=</span><span class="s">&quot;1.0&quot;</span>
<span class="w">                </span><span class="na">xmlns:xsl=</span><span class="s">&quot;http://www.w3.org/1999/XSL/Transform&quot;</span>
<span class="hll"><span class="w">                </span><span class="na">xmlns:my=</span><span class="s">&quot;urn:miextension&quot;</span>
</span><span class="hll"><span class="w">                </span><span class="na">extension-element-prefixes=</span><span class="s">&quot;my&quot;</span><span class="nt">&gt;</span>
</span><span class="w"> </span>
<span class="hll"><span class="w">   </span><span class="k">&lt;xsl:include</span><span class="w"> </span><span class="na">href=</span><span class="s">&quot;random.xsl&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</span>
<span class="w">   </span><span class="k">&lt;xsl:output</span><span class="w"> </span><span class="na">method=</span><span class="s">&quot;text&quot;</span><span class="w"> </span><span class="na">encoding=</span><span class="s">&quot;UTF-8&quot;</span><span class="nt">/&gt;</span>
<span class="w"> </span>
<span class="w">   </span><span class="k">&lt;xsl:template</span><span class="w"> </span><span class="na">match=</span><span class="s">&quot;discoteca&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:text</span><span class="nt">&gt;</span>LISTA<span class="w"> </span>DE<span class="w"> </span>DISCOS<span class="ni">&amp;#10;</span><span class="k">&lt;/xsl:text&gt;</span>

<span class="w">      </span><span class="k">&lt;xsl:apply-templates</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;disco&quot;</span><span class="nt">&gt;</span>
<span class="hll"><span class="w">         </span><span class="k">&lt;xsl:sort</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;my:random()&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</span><span class="w">      </span><span class="k">&lt;/xsl:apply-templates&gt;</span>
<span class="w">   </span><span class="k">&lt;/xsl:template&gt;</span>
<span class="w"> </span>
<span class="w">   </span><span class="k">&lt;xsl:template</span><span class="w"> </span><span class="na">match=</span><span class="s">&quot;disco&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:text</span><span class="nt">&gt;</span>-<span class="w"> </span><span class="k">&lt;/xsl:text&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:value-of</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;nombre&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:text</span><span class="nt">&gt;</span><span class="w"> </span>(<span class="k">&lt;/xsl:text&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:value-of</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;autor&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="k">&lt;xsl:text</span><span class="nt">&gt;</span>)<span class="ni">&amp;#10;</span><span class="k">&lt;/xsl:text&gt;</span>
<span class="w">   </span><span class="k">&lt;/xsl:template&gt;</span>

<span class="k">&lt;/xsl:stylesheet&gt;</span>
</pre></div>
</div>
</section>
<section id="extensiones-propias">
<h3>Extensiones propias<a class="headerlink" href="#extensiones-propias" title="Enlace permanente a este encabezado">¶</a></h3>
<p>Se han presentado ya los principios de <abbr title="eXtensible Stylesheet Language Transformations">XSLT</abbr> <strong>1.0</strong> y también las extensiones
estándar definidas por la <a class="reference external" href="http://exslt.org">comunidad EXSLT</a> para éste, implementadas muchas de forma
nativa en los propios procesadores. Sin embargo, realizar una tarea algo
particular y compleja con estas herramientas puede resultar una tarea titánica,
cuando no poco menos que imposible. Para suplir estas carencias de manera que
podamos escribir nosotros mismos nuestras propias funciones de extensión en
otros lenguajes (<a class="reference internal" href="#exslt-func-func"><span class="std std-ref">&lt;func:function&gt;</span></a> permite escribirlas, pero en <abbr title="eXtensible Stylesheet Language Transformations">XSLT</abbr>) hay algunas
posibilidades:</p>
<ul class="simple">
<li><p>La extensión <code class="docutils literal notranslate"><span class="pre">&lt;func:script&gt;</span></code> de <a class="reference internal" href="#e-xslt"><span class="std std-ref">EXSLT</span></a> que permite definir el código de la
función en otro lenguaje. Desgraciadamente los procesadores no suelen tener
soporte para ella.</p></li>
<li><p>Usar <a class="reference external" href="http://xmlsoft.org/libxslt/">libxslt</a> dentro de un lenguaje de programación de propósito general y
definir nuevas funciones de transformación.</p></li>
</ul>
<p>Es este segundo método el que se ilustrará, usando como lenguaje de programación
<a class="reference external" href="http://python.org">Python</a>.</p>
<div class="admonition-todo admonition" id="id9">
<p class="admonition-title">Por hacer</p>
<p>Escribir este apartado basándose en <a class="reference external" href="http://blog.humaneguitarist.org/2012/11/02/pixelation-custom-xslt-functions-with-python-and-lxml/">lo expuesto aquí</a>.</p>
</div>
</section>
<section id="ejercicios-propuestos">
<h3>Ejercicios propuestos<a class="headerlink" href="#ejercicios-propuestos" title="Enlace permanente a este encabezado">¶</a></h3>
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<p>Los ejercicios está organizados según el <abbr title="eXtensible  Markup Language">XML</abbr> que traducen y
no según dificultad. Si prefiere hacerlos según su dificultad un orden
apropiado (incluyendo sólo los que generan una salida de texto) es: 1,
7, 9, 10, 11, 8, 12, 21, 3, 22, 11, 5, 6, 15, 16, 17, 18 Terminar de ordenarlos…</p>
</div>
<div class="admonition-todo admonition" id="id10">
<p class="admonition-title">Por hacer</p>
<p>Añadir problemas que consistan en manipular el <abbr title="eXtensible  Markup Language">XML</abbr> original quitando
o añadiendo nodos.</p>
</div>
<ol class="arabic">
<li><p>Dada la solución propuesta para almacenar la información de un dibujo técnico
en dos dimensiones, hacer una lista con las entidades que se encuentran en el
dibujo: cada item constará del nombre de la entidad y, entre paréntesis, el
identificador.</p>
<p class="sol-oculta"><a class="reference download internal" download="" href="../_downloads/12588743247d3cb991afb8cc8a420e71/01-grafico.txt.xsl"><code class="xref download docutils literal notranslate"><span class="pre">Solución</span> <span class="pre">propuesta</span></code></a></p>
</li>
<li><p>Haga una transformación semejante a la anterior, pero genere una salida
<abbr title="HyperText Markup Language">HTML</abbr> en forma de tabla de dos columnas, la primera columna contendrá el
nombre de la entidad y la segunda el identificador.</p>
</li>
<li id="ej-xslt-3"><p>Ídem al ejercicio 1, pero cada ítem debe tener el siguiente aspecto:</p>
<ul class="simple">
<li><p>Si es punto: <code class="code docutils literal notranslate"><span class="pre">P=(x,y)</span></code>.</p></li>
<li><p>Si es circunferencia: <code class="code docutils literal notranslate"><span class="pre">C=(x,</span> <span class="pre">y);</span> <span class="pre">R=r</span></code>.</p></li>
<li><p>Si es recta: <code class="code docutils literal notranslate"><span class="pre">R=(x1,</span> <span class="pre">y1)-(x2,</span> <span class="pre">y2)</span></code>.</p></li>
<li><p>Si es rectángulo: <code class="code docutils literal notranslate"><span class="pre">R=(x1,</span> <span class="pre">y1)+(x2,</span> <span class="pre">y2)</span></code>.</p></li>
</ul>
<p class="sol-oculta"><a class="reference download internal" download="" href="../_downloads/9874be3e03648c89ca733fa0809a1019/03-grafico.txt.xsl"><code class="xref download docutils literal notranslate"><span class="pre">Solución</span> <span class="pre">propuesta</span></code></a></p>
</li>
<li><p>Vuelva a hacer el ejercicio anterior, pero genere una tabla <abbr title="HyperText Markup Language">HTML</abbr> como salida
parecida a la del ejercicio <strong>2</strong>. En este caso la segunda columna contendrá
las expresiones anteriores para identificar a cada entidad, en vez del
identificador.</p>
</li>
<li id="ej-xslt-5"><p>Sobre el mismo <abbr title="eXtensible  Markup Language">XML</abbr> crear una lista con el siguiente aspecto:</p>
<div class="highlight-xslt notranslate"><div class="highlight"><pre><span></span>LISTA<span class="w"> </span>DE<span class="w"> </span>ENTIDADES

1.<span class="w"> </span>circunferencia:
<span class="w">   </span>-<span class="w"> </span>e03

2.<span class="w"> </span>punto:
<span class="w">   </span>-<span class="w"> </span>e01
<span class="w">   </span>-<span class="w"> </span>e05

3.<span class="w"> </span>recta:
<span class="w">   </span>-<span class="w"> </span>e02

4.<span class="w"> </span>rectangulo:
<span class="w">   </span>-<span class="w"> </span>e04
</pre></div>
</div>
<p>es decir, una lista organizada por tipos de entidad. De cada entidad sólo hay
que indicar su identificador.</p>
<p class="sol-oculta"><a class="reference download internal" download="" href="../_downloads/36064238b95342af29fc82557c7db037/05-grafico.txt.xsl"><code class="xref download docutils literal notranslate"><span class="pre">Solución</span> <span class="pre">propuesta</span></code></a></p>
</li>
<li><p>Haga una lista semejante a la del ejercicio 3, pero las entidades deberán
estar ordenadas por tipo y junto a la información del tipo, deberá incluirse
la cantidad de entidades que hay de ese tipo. Por ejemplo:</p>
<div class="highlight-xslt notranslate"><div class="highlight"><pre><span></span>a)<span class="w"> </span>circunferencia:<span class="w"> </span>5
<span class="w">   </span>1.<span class="w"> </span>C(3,<span class="w"> </span>4);<span class="w"> </span>R=2
<span class="w">   </span>2.<span class="w"> </span>...

b)<span class="w"> </span>punto:<span class="w"> </span>2
<span class="w">   </span>1.<span class="w"> </span>P(0,<span class="w"> </span>25)
<span class="w">   </span>2.<span class="w"> </span>P(-4,<span class="w"> </span>10)
<span class="w">   </span>3.<span class="w"> </span>...
</pre></div>
</div>
<p class="sol-oculta"><a class="reference download internal" download="" href="../_downloads/23e688abcb209b18ded83481f3d5645d/06-grafico.txt.xsl"><code class="xref download docutils literal notranslate"><span class="pre">Solución</span> <span class="pre">propuesta</span></code></a></p>
</li>
<li><p>Tomando el <a class="reference internal" href="../01.intro/02b.marcas.html#xml-ejemplo"><span class="std std-ref">XML introductorio</span></a>, obtenga una lista numerada
de profesores ordenada alfabéticamente por apellidos.</p>
<p class="sol-oculta"><a class="reference download internal" download="" href="../_downloads/6a1fce76e4eedf0c2d40adc91e08d792/07-profesores.txt.xsl"><code class="xref download docutils literal notranslate"><span class="pre">Solución</span> <span class="pre">propuesta</span></code></a></p>
</li>
<li><p>Haga lo mismo que en el caso anterior, pero la lista dividida en cuatro secciones:</p>
<ol class="loweralpha simple">
<li><p>Profesores activos (incluye titulares y sustitutos).</p></li>
<li><p>Profesores sustituidos.</p></li>
<li><p>Profesores sin sustituto (son aquellos cuyo atributo  <code class="docutils literal notranslate"><span class="pre">id</span></code> coincide
con el valor del atributo <code class="docutils literal notranslate"><span class="pre">sustituto</span></code>).</p></li>
<li><p>Profesores sustitutos.</p></li>
</ol>
<p class="sol-oculta"><a class="reference download internal" download="" href="../_downloads/9b7ebe3afef7c42e5635630d8d962554/08-profesores.txt.xsl"><code class="xref download docutils literal notranslate"><span class="pre">Solución</span> <span class="pre">propuesta</span></code></a></p>
</li>
<li><p>Dada la solución propuesta para almacenar la información sobre las facturas
de una empresa, muestre una lista numerada de clientes de la empresa.</p>
<p class="sol-oculta"><a class="reference download internal" download="" href="../_downloads/756c48c6199fbd7c23f8e1df47de29ce/09-facturas.txt.xsl"><code class="xref download docutils literal notranslate"><span class="pre">Solución</span> <span class="pre">propuesta</span></code></a></p>
</li>
<li><p>Haga lo mismo que en el ejercicio anterior, pero muestre en la lista sólo los
clientes que han comprado algo.</p>
<p class="sol-oculta"><a class="reference download internal" download="" href="../_downloads/73243ff9dff208ec266fb509572e0e8d/10-facturas.txt.xsl"><code class="xref download docutils literal notranslate"><span class="pre">Solución</span> <span class="pre">propuesta</span></code></a></p>
</li>
<li><p>Haga una lista de facturas, en cada una de las cuales aparezca la cantidad de productos
distintos que se han comprado.</p>
<p class="sol-oculta"><a class="reference download internal" download="" href="../_downloads/aaa63c524f8fd02f7f1820860338695d/11-facturas.txt.xsl"><code class="xref download docutils literal notranslate"><span class="pre">Solución</span> <span class="pre">propuesta</span></code></a></p>
</li>
<li><p>Repita la lista, pero incluyendo sólo las facturas con más de un producto distinto.</p>
<p class="sol-oculta"><a class="reference download internal" download="" href="../_downloads/f4d98a3114fc489ebf20fed4e0b9a51d/12-facturas.txt.xsl"><code class="xref download docutils literal notranslate"><span class="pre">Solución</span> <span class="pre">propuesta</span></code></a></p>
</li>
<li><p>A partir del <abbr title="eXtensible  Markup Language">XML</abbr> de las facturas, haga una lista de clientes para cada uno
de los cuales se desglosen sus facturas. De las facturas se debe mostrar el
identificador y la fecha.</p>
<p class="sol-oculta"><a class="reference download internal" download="" href="../_downloads/9976455e98f4cca1ac8043f1e1159234/13-facturas.txt.xsl"><code class="xref download docutils literal notranslate"><span class="pre">Solución</span> <span class="pre">propuesta</span></code></a></p>
</li>
<li><p>Haga lo mismo que en el ejercicio anterior, pero el documento resultante debe
ser una tabla <abbr title="HyperText Markup Language">HTML</abbr> de dos columnas: la primera indicará el cliente; y la
segunda las facturas.</p>
</li>
<li id="ej-xslt-15"><p>Sobre el mismo <abbr title="eXtensible  Markup Language">XML</abbr> devuelva una lista de facturas, de cada una de las cuales
debe desglosarse cuáles son productos que incluye y qué cantidad de ellos.
Por ejemplo:</p>
<div class="highlight-xslt notranslate"><div class="highlight"><pre><span></span>1.<span class="w"> </span>f01<span class="w"> </span>(2018-10-15):
<span class="w">   </span>+<span class="w"> </span>mollete:<span class="w"> </span>3
<span class="w">   </span>+<span class="w"> </span>tomate:<span class="w"> </span>1
2.<span class="w"> </span>f02<span class="w"> </span>(2018-11-15):
<span class="w">   </span>+<span class="w"> </span>tomate:<span class="w"> </span>2
</pre></div>
</div>
<p class="sol-oculta"><a class="reference download internal" download="" href="../_downloads/2547bb33b280cca6538561b50f6dad9d/15-facturas.txt.xsl"><code class="xref download docutils literal notranslate"><span class="pre">Solución</span> <span class="pre">propuesta</span></code></a></p>
</li>
<li><p>Dada la solución propuesta para almacenar la información sobre los libros y
préstamos en una biblioteca, crear un listado de lectores que hayan pedido al
menos dos préstamos.</p>
<p class="sol-oculta"><a class="reference download internal" download="" href="../_downloads/a7be88e3e559b19e2495c43210ca4ed8/16-biblioteca.txt.xsl"><code class="xref download docutils literal notranslate"><span class="pre">Solución</span> <span class="pre">propuesta</span></code></a></p>
</li>
<li><p>Sobre el <abbr title="eXtensible  Markup Language">XML</abbr> del ejercicio anterior, vuelva a hacer la lista de lectores,
pero ordenados por el número de préstamos que han realizado.</p>
<p class="sol-oculta"><a class="reference download internal" download="" href="../_downloads/678e04897edb0eef0d4797a084bb152c/17-biblioteca.txt.xsl"><code class="xref download docutils literal notranslate"><span class="pre">Solución</span> <span class="pre">propuesta</span></code></a></p>
</li>
<li><p>Partiendo del <abbr title="eXtensible  Markup Language">XML</abbr> anterior, devuelva un listado de libros ordenados por año
de edición y en el que se indique el número de ejemplares de los que se
dispone en la biblioteca.</p>
<ul class="sol-oculta simple">
<li><p><a class="reference download internal" download="" href="../_downloads/172d3c7bc17c2428f44c7a2104805580/18-biblioteca.txt.xsl"><code class="xref download docutils literal notranslate"><span class="pre">Solución</span> <span class="pre">propuesta</span></code></a>
suponiendo que disponible significa que es propiedad de la biblioteca.</p></li>
<li><p><a class="reference download internal" download="" href="../_downloads/a0804b665ac8c5ef4d8d32bc4225f166/18b-biblioteca.txt.xsl"><code class="xref download docutils literal notranslate"><span class="pre">Solución</span> <span class="pre">propuesta</span></code></a>
suponiendo que disponible significa que está físicamente en la biblioteca y no en la casa
de un lector.</p></li>
</ul>
</li>
<li><p>A partir del mismo <abbr title="eXtensible  Markup Language">XML</abbr>, genere una lista de libros que incluya cuántas
veces se ha prestado y que desglose para cada uno de ellos a quién se le
prestó:</p>
<div class="highlight-xslt notranslate"><div class="highlight"><pre><span></span>-<span class="w"> </span>Don<span class="w"> </span>Quijote<span class="w"> </span>de<span class="w"> </span>la<span class="w"> </span>Mancha:<span class="w"> </span>2<span class="w"> </span>préstamos
<span class="w">   </span>1.<span class="w"> </span>Lector<span class="w"> </span>1.
<span class="w">   </span>2.<span class="w"> </span>Lector<span class="w"> </span>2.

-<span class="w"> </span>Tirante<span class="w"> </span>el<span class="w"> </span>Blanco:<span class="w"> </span>1<span class="w"> </span>préstamo
<span class="w">   </span>2.<span class="w"> </span>Lector<span class="w"> </span>2.
</pre></div>
</div>
<p>Órdene la lista del más prestado al menos prestado.</p>
<p class="sol-oculta"><a class="reference download internal" download="" href="../_downloads/138afd8089d60fb3d3f02c0cf23a9bf4/19-biblioteca.txt.xsl"><code class="xref download docutils literal notranslate"><span class="pre">Solución</span> <span class="pre">propuesta</span></code></a></p>
</li>
<li><p>Sobre el mismo <abbr title="eXtensible  Markup Language">XML</abbr>, cree una tabla <abbr title="HyperText Markup Language">HTML</abbr> que cuyas columnas sean:</p>
<ul class="simple">
<li><p>Los libros ordenados por número de prestamos.</p></li>
<li><p>Los préstamos realizados de ese libro (indíquese la fecha y el plazo).</p></li>
<li><p>El cliente que pidió el préstamo (su nombre y DNI).</p></li>
</ul>
</li>
<li><p>Dada la solución propuesta para almacenar la información sobre los coches que
vende un concesionario, presente un listado de modelos de coche ordenados
como primer criterio por marca y como segundo por potencia. De cada modelo
deberá verse nombre del modelo (nombre de la marca): potencia.</p>
<p class="sol-oculta"><a class="reference download internal" download="" href="../_downloads/a4ab8f612eb29d7c655d316199225c54/21-concesionario.txt.xsl"><code class="xref download docutils literal notranslate"><span class="pre">Solución</span> <span class="pre">propuesta</span></code></a></p>
</li>
<li><p>Sobre el <abbr title="eXtensible  Markup Language">XML</abbr> anterior, repita la lista, pero haciéndola de dos niveles: el
primero serán las marcas y el segundo los modelos (incluya también la
información sobre la potencia).</p></li>
<li><p>Dada la solución propuesta para almacenar la información sobre los parques
nacionales, devuelva el listado de parques nacionales y dentro de cada uno de
ellos dos listas más: el de la fauna en alto peligro de extinción y el de la
flora en alto peligro de extinción.</p>
<p class="sol-oculta"><a class="reference download internal" download="" href="../_downloads/686bd06fd910b6b464e45ce0cd83ba88/23-parques.txt.xsl"><code class="xref download docutils literal notranslate"><span class="pre">Solución</span> <span class="pre">propuesta</span></code></a></p>
</li>
<li><p>Sobre el <abbr title="eXtensible  Markup Language">XML</abbr> anterior, devuelva un listado con primero la flora y luego la
fauna. De cada uno de ellos habrá que indicar los parques nacionales en los
que se encuentran.</p>
<p class="sol-oculta"><a class="reference download internal" download="" href="../_downloads/8746d4cf60bb1e4e97d11214b1474f67/24-parques.txt.xsl"><code class="xref download docutils literal notranslate"><span class="pre">Solución</span> <span class="pre">propuesta</span></code></a></p>
</li>
<li><p>Del mismo <abbr title="eXtensible  Markup Language">XML</abbr>, saque un listado de animales en alto peligro de extinción en
que se indique el total ejemplares que hay de cada uno.</p>
<p class="sol-oculta"><a class="reference download internal" download="" href="../_downloads/2e107a5fed8733433419d6b7732af1d9/25-parques.txt.xsl"><code class="xref download docutils literal notranslate"><span class="pre">Solución</span> <span class="pre">propuesta</span></code></a></p>
</li>
<li><p>Soble el mismo <abbr title="eXtensible  Markup Language">XML</abbr>, obtener un listado de parques para cada uno de los cuales
se indique la cantidad de especies animales y vegetales protegidas.</p>
<p class="sol-oculta"><a class="reference download internal" download="" href="../_downloads/9264854fbf202aada694e8cb3b9e246b/26-parques.txt.xsl"><code class="xref download docutils literal notranslate"><span class="pre">Solución</span> <span class="pre">propuesta</span></code></a></p>
</li>
<li><p>Dada la solución propuesta para almacenar la información sobre los habitantes
de un municipio, muestre aquellos de los que se conoce padre y madre.</p>
<p class="sol-oculta"><a class="reference download internal" download="" href="../_downloads/feeb06043db90c7ab71a82ceb273f19d/27-ayuntamiento.txt.xsl"><code class="xref download docutils literal notranslate"><span class="pre">Solución</span> <span class="pre">propuesta</span></code></a></p>
</li>
<li><p>Sobre el mismo <abbr title="eXtensible  Markup Language">XML</abbr>, saque un listado de padres y otro de madres.</p></li>
<li><p>Sobre el mismo <abbr title="eXtensible  Markup Language">XML</abbr>, saque un listado de habitantes con algún abuelo conocido.</p></li>
<li><p>Sobre el <abbr title="eXtensible  Markup Language">XML</abbr> de facturas tratado en el ejercicio 5, haga un listado de
clientes que hayan comprado el producto Altramuces.</p></li>
<li><p>Sobre el mismo <abbr title="eXtensible  Markup Language">XML</abbr> de facturas haga un listado de facturas (incluya en ella
el indentificador y el nombre del cliente) que indique cuál ha sido el gasto en
cada producto.</p></li>
<li><p>Saque el mismo listado de facturas, pero en el que se indique cuál ha sido el
importe total de la factura, en vez de el importe en cada producto.</p></li>
</ol>
<p class="rubric">Notas al pie</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="id11" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">1</a><span class="fn-bracket">]</span></span>
<p>No es exactamente así y, de hecho, podría definir una plantilla para el
nodo <code class="code docutils literal notranslate"><span class="pre">/</span></code>, dentro del cual se encuentra <code class="code docutils literal notranslate"><span class="pre">&lt;discoteca&gt;</span></code>. A efectos,
prácticos es lo mismo, y ya responderemos por qué cuando veamos <a class="reference internal" href="#xslt-default-template"><span class="std std-ref">cuál es
la plantilla predeterminada</span></a>.</p>
</aside>
<aside class="footnote brackets" id="id12" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id3">2</a><span class="fn-bracket">]</span></span>
<p>Simplificamos la invocación eliminado <a class="reference internal" href="#xsl-sort"><span class="std std-ref">&lt;xsl:sort&gt;</span></a>, porque ahora mismo no
aporta nada a la explicación del concepto su inclusión.</p>
</aside>
<aside class="footnote brackets" id="id13" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id4">3</a><span class="fn-bracket">]</span></span>
<p>Obsérvese que esto, conceptualmente, es la ejecución de un bucle en un
lenguaje de programación estructurada.</p>
</aside>
<aside class="footnote brackets" id="id14" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id5">4</a><span class="fn-bracket">]</span></span>
<p>Obviamente en la definición deberá haber un elemento <a class="reference internal" href="#xsl-param"><span class="std std-ref">&lt;xsl:param&gt;</span></a>
correspondiente</p>
</aside>
<aside class="footnote brackets" id="id15" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id6">5</a><span class="fn-bracket">]</span></span>
<p>Bucle a medias porque la especificación no asegura el orden en que se
recorrerán los nodos.</p>
</aside>
<aside class="footnote brackets" id="id16" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id7">6</a><span class="fn-bracket">]</span></span>
<p>Si disponemos de <strong class="program">xidel</strong>, que sí soporta <em>XPath</em> <strong>2.0</strong>,
podemos probar la función así:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>xidel<span class="w"> </span>-se<span class="w"> </span><span class="s1">&#39;distinct-values(//disco/@tipo)&#39;</span><span class="w"> </span>discos.xml
<span class="go">clasica</span>
<span class="go">jazz</span>
<span class="go">rock</span>
</pre></div>
</div>
</aside>
<aside class="footnote brackets" id="id17" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id8">7</a><span class="fn-bracket">]</span></span>
<p>Podemos también ahorrarnos el espacio de nombres metiendo la función
dentro del espacio <code class="docutils literal notranslate"><span class="pre">xsl</span></code>, pero ciertamente no es algo muy pulcro.</p>
</aside>
</aside>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
        <p class="logo"><a href="../index.html" title="index">
          <img class="logo" src="../_static/logo.png" alt="Logo"/>
        </a></p><div class="sphinx-toc sphinxlocaltoc">
    <h3><a href="../index.html">Page contents</a></h3>
    <ul>
<li><a class="reference internal" href="#"><abbr title="eXtensible Stylesheet Language Transformations">XSLT</abbr></a><ul>
<li><a class="reference internal" href="#introduccion">Introducción</a><ul>
<li><a class="reference internal" href="#que-es-xslt">¿Qué es <abbr title="eXtensible Stylesheet Language Transformations">XSLT</abbr>?</a></li>
<li><a class="reference internal" href="#ejemplo-introductorio">Ejemplo introductorio</a></li>
</ul>
</li>
<li><a class="reference internal" href="#expresiones">Expresiones</a></li>
<li><a class="reference internal" href="#elementos">Elementos</a><ul>
<li><a class="reference internal" href="#cabecera">Cabecera</a></li>
<li><a class="reference internal" href="#plantillas">Plantillas</a><ul>
<li><a class="reference internal" href="#definicion">Definición</a></li>
<li><a class="reference internal" href="#invocacion">Invocación</a></li>
</ul>
</li>
<li><a class="reference internal" href="#variables">Variables</a></li>
<li><a class="reference internal" href="#generacion-de-la-salida">Generación de la salida</a></li>
<li><a class="reference internal" href="#sentencias-condicionales">Sentencias condicionales</a><ul>
<li><a class="reference internal" href="#elemento-xsl-if">Elemento <code class="docutils literal notranslate"><span class="pre">&lt;xsl:if&gt;</span></code></a></li>
<li><a class="reference internal" href="#elemento-xsl-choose">Elemento <code class="docutils literal notranslate"><span class="pre">&lt;xsl:choose&gt;</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#bucles">Bucles</a></li>
<li><a class="reference internal" href="#otros-elementos">Otros elementos</a></li>
</ul>
</li>
<li><a class="reference internal" href="#funciones">Funciones</a></li>
<li><a class="reference internal" href="#extensiones">Extensiones</a><ul>
<li><a class="reference internal" href="#extensiones-estandar">Extensiones estándar</a></li>
<li><a class="reference internal" href="#extensiones-propias">Extensiones propias</a></li>
<li><a class="reference internal" href="#ejercicios-propuestos">Ejercicios propuestos</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div class="sphinxprev">
    <h4>Previous page</h4>
    <p class="topless"><a href="22.rnc.html"
                          title="Previous page">&larr; Relax-NG Compact</a></p>
  </div>
  <div class="sphinxnext">
    <h4>Next page</h4>
    <p class="topless"><a href="99.tools.html"
                          title="Next page">&rarr; Herramientas</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>Esta página</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/98.apendices/41.xslt.rst.txt"
            rel="nofollow">Mostrar el código</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Búsqueda rápida</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Ir a" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
    
    
        <div class="sidebar-toggle-group no-js">
            
            <button class="sidebar-toggle" id="sidebar-hide" title="Hide the sidebar menu">
                 «
                <span class="show-for-small">hide menu</span>
                
            </button>
            <button class="sidebar-toggle" id="sidebar-show" title="Show the sidebar menu">
                
                <span class="show-for-small">menu</span>
                <span class="hide-for-small">sidebar</span>
                 »
            </button>
        </div>
    
      <div class="clearer"></div>
    </div>
    <div class="relbar-bottom">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="Índice General"
             >índice</a></li>
        <li class="right" >
          <a href="99.tools.html" title="Herramientas"
             >siguiente</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="22.rnc.html" title="Relax-NG Compact"
             >anterior</a> &nbsp; &nbsp;</li>
    <li><a href="../index.html">documentación de Lenguajes de Marcas - rolling</a> &#187;</li>

        <li class="nav-item nav-item-this"><a href=""><abbr title="eXtensible Stylesheet Language Transformations">XSLT</abbr></a></li> 
      </ul>
    </div>
    </div>

    <div class="footer" role="contentinfo">
        &#169; Derechos de autor CC BY 4.0, 2023-2024, José Miguel Sánchez Alés.
      Creado usando <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
    </div>
    <!-- cloud_sptheme 1.4 -->
  </body>
</html>